{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2020/05/10/plant-check","result":{"data":{"content":{"edges":[{"node":{"id":"3284719e-393b-59c9-8697-f345ef256b1a","excerpt":"Raspberry PIを使って家のガジュマルを枯らさないようにします。 Table of Contents ガジュマル Raspberry PI Zero WH 土壌センサー DHT11 フォトレジスタ ADC083…","fields":{"slug":"2020/05/10/plant-check"},"frontmatter":{"id":null,"title":"Raspberry PIを使って植物の水やり監視システムを作る","slug":"2020/05/10/plant-check","date":"2020-05-10T06:29:01.182Z","headerImage":"https://i.imgur.com/amaoydT.jpg","tags":["電子工作","Raspberry PI"]}}}]}},"pageContext":{"id":"3284719e-393b-59c9-8697-f345ef256b1a","index":37,"repHtml":"<p>Raspberry PIを使って家のガジュマルを枯らさないようにします。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E3%82%AC%E3%82%B8%E3%83%A5%E3%83%9E%E3%83%AB\">ガジュマル</a></li>\n<li><a href=\"#raspberry-pi-zero-wh\">Raspberry PI Zero WH</a></li>\n<li><a href=\"#%E5%9C%9F%E5%A3%8C%E3%82%BB%E3%83%B3%E3%82%B5%E3%83%BC\">土壌センサー</a></li>\n<li><a href=\"#dht11\">DHT11</a></li>\n<li><a href=\"#%E3%83%95%E3%82%A9%E3%83%88%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF\">フォトレジスタ</a></li>\n<li><a href=\"#adc0832\">ADC0832</a></li>\n<li><a href=\"#%E6%A7%8B%E6%88%90\">構成</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89\">コード</a></li>\n<li><a href=\"#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\">動かしてみる</a></li>\n<li><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></li>\n</ul>\n</div>\n<h2 id=\"ガジュマル\" style=\"position:relative;\"><a href=\"#%E3%82%AC%E3%82%B8%E3%83%A5%E3%83%9E%E3%83%AB\" aria-label=\"ガジュマル permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ガジュマル</h2>\n<p>我が家には<strong>ガジュマル</strong>が観葉植物としています。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/mDq4FWO.jpg\" alt=\"img\"></p>\n<p>ガジュマルには日光がある程度必要なので窓際に置いているのですが、水やりを忘れがちです。</p>\n<p>何度も枯らしかけたので、Raspberry PIを使って水やり管理をできるようにします。</p>\n<p>ついでに余っていた温度計やフォトレジスタも組み込んで観葉植物の管理システムを作ってみようかと思います。</p>\n<h2 id=\"raspberry-pi-zero-wh\" style=\"position:relative;\"><a href=\"#raspberry-pi-zero-wh\" aria-label=\"raspberry pi zero wh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Raspberry PI Zero WH</h2>\n<p>今回は余っていたRaspberry PI Zero WHを使います。</p>\n<p>性能はそこまでよくないですが、低電力でコンパクトなのでこういった用途には向いていると思います。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/GmYDK0C.jpg\" alt=\"img\"></p>\n<p>中身はこんな感じです。</p>\n<p>インターフェースはHDMI(ちっさいの)とUSB Microと電源供給用のUSB Micro、ディスク代わりのMicroSD、カメラモジュールです。</p>\n<p>不要だと思いつつも余っていたのでヒートシンクをつけてます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/k4R1znI.jpg\" alt=\"img\"></p>\n<h2 id=\"土壌センサー\" style=\"position:relative;\"><a href=\"#%E5%9C%9F%E5%A3%8C%E3%82%BB%E3%83%B3%E3%82%B5%E3%83%BC\" aria-label=\"土壌センサー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>土壌センサー</h2>\n<p>土壌センサーはAmazonで購入しました。</p>\n<p><a href=\"https://amzn.to/2URR8D5\" target=\"_blank\" rel=\"noopener noreferrer\">HiLetgo 5個セット LM393 3.3V-5V土壌水分検出センサー土壌水分センサーArduino自動散水システムロボット用の湿度計検出ロボットスマートカー [並行輸入品]</a></p>\n<p>5個入りで￥550\nでした。安い。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/amaoydT.jpg\" alt=\"img\"></p>\n<h2 id=\"dht11\" style=\"position:relative;\"><a href=\"#dht11\" aria-label=\"dht11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DHT11</h2>\n<p>温度と湿度は<strong>DHT11</strong>を使います。電子工作の有名どころですね。</p>\n<p>デジタル接続ができるのでA/Dに通さなくていい優れものです。</p>\n<p>精度はわかりません。趣味で作るものなのであまり気にしなくていいと思います。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/JvjiUuD.jpg\" alt=\"img\"></p>\n<h2 id=\"フォトレジスタ\" style=\"position:relative;\"><a href=\"#%E3%83%95%E3%82%A9%E3%83%88%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF\" aria-label=\"フォトレジスタ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>フォトレジスタ</h2>\n<p>フォトレジスタとは光が当たると抵抗が下がるやつです。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/kSjQyey.jpg\" alt=\"img\"></p>\n<h2 id=\"adc0832\" style=\"position:relative;\"><a href=\"#adc0832\" aria-label=\"adc0832 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ADC0832</h2>\n<p>A/Dのコンバータは<strong>ADC0832</strong>を使いました。</p>\n<p>なかなかデータシートが出てこず大変でしたがこちらです。</p>\n<p><a href=\"http://www.ti.com/lit/ds/symlink/adc0832-n.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">データシート</a></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/msMkGJb.jpg\" alt=\"img\"></p>\n<p>8digitの隣にあるチップがADC0832です。</p>\n<h2 id=\"構成\" style=\"position:relative;\"><a href=\"#%E6%A7%8B%E6%88%90\" aria-label=\"構成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>構成</h2>\n<p>今回は土壌センサーとフォトレジスタと2つアナログがありますのでADC0832のチャンネルをフルに2チャンネル使う構成にしてます。</p>\n<p>また、土壌センサーはずっと電力を印加していると電気分解が起きてセンサーがボロボロに<strong>腐食</strong>してしまうため、VCCはGPIOで制御して取るようにしてます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/bwjrBtF.png\" alt=\"img\"></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/TwBitlX.jpg\" alt=\"img\"></p>\n<h2 id=\"コード\" style=\"position:relative;\"><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89\" aria-label=\"コード permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コード</h2>\n<p>今回はセンサーをAPI化して別システムからリクエストを投げることで計測を行なうシステムにしようと思うのでAPIサーバー化します。</p>\n<p>APIサーバー化には今回は<a href=\"https://falconframework.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Falcon</a>を使ってみました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> falcon\n<span class=\"token keyword\">import</span> RPi<span class=\"token punctuation\">.</span>GPIO <span class=\"token keyword\">as</span> GPIO\n<span class=\"token keyword\">from</span> time <span class=\"token keyword\">import</span> sleep\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> ADC0832\n<span class=\"token keyword\">import</span> Adafruit_DHT\n\n<span class=\"token comment\"># Excitation Voltage for sensors</span>\npin <span class=\"token operator\">=</span> <span class=\"token number\">15</span>\n\n<span class=\"token comment\"># initialize GPIO</span>\nGPIO<span class=\"token punctuation\">.</span>setwarnings<span class=\"token punctuation\">(</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># Excitation Voltage</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">output_fromGPIO</span><span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    GPIO<span class=\"token punctuation\">.</span>setmode<span class=\"token punctuation\">(</span>GPIO<span class=\"token punctuation\">.</span>BOARD<span class=\"token punctuation\">)</span>\n    GPIO<span class=\"token punctuation\">.</span>setup<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> GPIO<span class=\"token punctuation\">.</span>OUT<span class=\"token punctuation\">)</span>\n    GPIO<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span>\n    sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_temperature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        _<span class=\"token punctuation\">,</span> temperature <span class=\"token operator\">=</span> Adafruit_DHT<span class=\"token punctuation\">.</span>read_retry<span class=\"token punctuation\">(</span>Adafruit_DHT<span class=\"token punctuation\">.</span>DHT11<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> temperature\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_humidity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        humidity<span class=\"token punctuation\">,</span> _ <span class=\"token operator\">=</span> Adafruit_DHT<span class=\"token punctuation\">.</span>read_retry<span class=\"token punctuation\">(</span>Adafruit_DHT<span class=\"token punctuation\">.</span>DHT11<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> humidity\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_moisture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        ADC0832<span class=\"token punctuation\">.</span>setup<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n            moisture <span class=\"token operator\">=</span> ADC0832<span class=\"token punctuation\">.</span>getResult<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> moisture <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> moisture\n            sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n        ADC0832<span class=\"token punctuation\">.</span>destroy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_light</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        ADC0832<span class=\"token punctuation\">.</span>setup<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        light <span class=\"token operator\">=</span> ADC0832<span class=\"token punctuation\">.</span>getResult<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">80</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>light<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> light <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            light <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">return</span> light\n    <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n        ADC0832<span class=\"token punctuation\">.</span>destroy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        output_fromGPIO<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CheckHumidity</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">on_get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        msg <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"humidity\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> get_humidity<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        resp<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CheckTemperature</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">on_get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        msg <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"temperature\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> get_temperature<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        resp<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CheckMoisture</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">on_get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        msg <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"moisture\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> get_moisture<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        resp<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CheckLight</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">on_get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        msg <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"light\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> get_light<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        resp<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n\n\napp <span class=\"token operator\">=</span> falcon<span class=\"token punctuation\">.</span>API<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>add_route<span class=\"token punctuation\">(</span><span class=\"token string\">\"/humidity\"</span><span class=\"token punctuation\">,</span> CheckHumidity<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>add_route<span class=\"token punctuation\">(</span><span class=\"token string\">\"/temperature\"</span><span class=\"token punctuation\">,</span> CheckTemperature<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>add_route<span class=\"token punctuation\">(</span><span class=\"token string\">\"/moisture\"</span><span class=\"token punctuation\">,</span> CheckMoisture<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span>add_route<span class=\"token punctuation\">(</span><span class=\"token string\">\"/light\"</span><span class=\"token punctuation\">,</span> CheckLight<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">from</span> wsgiref <span class=\"token keyword\">import</span> simple_server\n    httpd <span class=\"token operator\">=</span> simple_server<span class=\"token punctuation\">.</span>make_server<span class=\"token punctuation\">(</span><span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span>\n    httpd<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>8000ポートでAPIサーバーが立ち上がり、GET APIでほしいセンサー情報にアクセスできます。</p>\n<h2 id=\"動かしてみる\" style=\"position:relative;\"><a href=\"#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"動かしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>動かしてみる</h2>\n<p>ガジュマルの植木鉢に設置してみます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/2J8rx9K.jpg\" alt=\"img\"></p>\n<p>Zabbixのexternal scriptsを使ってAPIから情報を取得し、グラフにしてみました。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/tHoBvbQ.png\" alt=\"img\"></p>\n<p>うまく取得できました。</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>ここまでのコードはZabbixのテンプレート含めGitHubに公開してます。</p>\n<p><a href=\"https://github.com/tubone24/raspi_plant_checker\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tubone24/raspi_plant_checker</a></p>\n<p>これで枯らすことなく育てることができますね！</p>","words":1310,"minutes":4}},"staticQueryHashes":["1319877725","2959249232"]}