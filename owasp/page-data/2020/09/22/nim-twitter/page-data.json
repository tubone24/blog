{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2020/09/22/nim-twitter","result":{"data":{"content":{"edges":[{"node":{"id":"08faaff2-431a-51f8-bc3a-51509f561e41","excerpt":"NimのTwitterSDKを作ってOSS兄貴になろうと思ったら、結局なれませんでした。 Table of Contents Nimとは？ どうして流行らないのか？ NimでTwitterSDK作る TwitterAPI oAuth1.0をNimで使うには？ CORDEA…","fields":{"slug":"2020/09/22/nim-twitter"},"frontmatter":{"id":null,"title":"Nim用のTwitterSDK作るついでに仕事中TwitterができるCLIを作った","slug":"2020/09/22/nim-twitter","date":"2020-09-22T11:39:58.035Z","headerImage":"https://i.imgur.com/BO7QR6p.png","tags":["Nim","Twitter"]}}}]}},"pageContext":{"id":"08faaff2-431a-51f8-bc3a-51509f561e41","index":28,"repHtml":"<p>NimのTwitterSDKを作ってOSS兄貴になろうと思ったら、結局なれませんでした。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#nim%E3%81%A8%E3%81%AF\">Nimとは？</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%A9%E3%81%86%E3%81%97%E3%81%A6%E6%B5%81%E8%A1%8C%E3%82%89%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\">どうして流行らないのか？</a></p>\n</li>\n<li>\n<p><a href=\"#nim%E3%81%A7twittersdk%E4%BD%9C%E3%82%8B\">NimでTwitterSDK作る</a></p>\n</li>\n<li>\n<p><a href=\"#twitterapi\">TwitterAPI</a></p>\n<ul>\n<li><a href=\"#oauth10%E3%82%92nim%E3%81%A7%E4%BD%BF%E3%81%86%E3%81%AB%E3%81%AF\">oAuth1.0をNimで使うには？</a></li>\n<li><a href=\"#cordeaoauth\">CORDEA/oauth</a></li>\n<li><a href=\"#%E3%83%AA%E3%83%88%E3%83%A9%E3%82%A4%E3%81%AE%E5%AE%9F%E8%A3%85\">リトライの実装</a></li>\n<li><a href=\"#nim%E3%81%A7%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\">Nimでのクラス</a></li>\n<li><a href=\"#config%E3%82%92%E6%8C%81%E3%81%9F%E3%81%9B%E3%82%8B%E3%81%AB%E3%81%AF\">Configを持たせるには?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#twittersdk%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%91%E3%81%A9%E4%BD%95%E3%81%97%E3%82%88%E3%81%86%E3%81%8B\">TwitterSDK作ったけど何しようか？</a></p>\n<ul>\n<li><a href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A7%E8%89%B2%E4%BB%98%E3%81%8D%E6%96%87%E5%AD%97%E3%82%92%E5%87%BA%E3%81%97%E3%81%9F%E3%81%84\">コマンドラインインターフェースで色付き文字を出したい！</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%91%E3%83%BC%E3%82%B5%E3%83%BC%E3%81%AF%E3%81%84%E3%81%A4%E3%82%82%E3%81%AEdocopt\">コマンドラインパーサーはいつものdocopt</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#windows%E3%81%A7%E3%82%82mac%E3%81%A7%E3%82%82ubuntu%E3%81%A7%E3%82%82%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84\">WindowsでもMacでもUbuntuでも使いたい！</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%8B%E3%82%82\">できたかも～</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"nimとは\" style=\"position:relative;\"><a href=\"#nim%E3%81%A8%E3%81%AF\" aria-label=\"nimとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nimとは？</h2>\n<p>詳しくは<a href=\"https://blog.tubone-project24.xyz/2019/11/20/docopt-nim#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82nim%E3%81%A8%E3%81%AF%EF%BC%9F\" target=\"_blank\" rel=\"noopener noreferrer\">docoptはNimでも使えたのお話\r\n</a>をご覧いただければと思いますが、<strong>静的型付なコンパイラ言語</strong>でPython, Ada, modulaなどの成熟した言語のいいとこ取りをした<strong>能率的</strong>で、<strong>表現力豊か</strong>で、<strong>エレガントな言語</strong>です。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/BbHTNwQ.png\" alt=\"img\"></p>\n<p>いわゆる別言語への<strong>トランスパイル</strong>を通して、ビルドする言語となり、通常はCを使いますが、C++、JavaScript、Javaなんかへの変換が可能です。(フロントとバックエンドと両方の言語としての覇権を狙っている!?)</p>\n<p>言語の構文もPythonのそれに近く、さらに言えば実行速度も早く、Goのように<strong>Artifactsが巨大</strong>になることもありません。</p>\n<p>ここまで聞くと、いいことことごとくめで素晴らしいのですがNimには欠点があります。</p>\n<p>それは悲しいくらい<strong>流行ってない</strong>ということです。</p>\n<p>いや、一部の熱狂的信者はいるのですが一般的か？と言われると疑問符がついてしまうのです。</p>\n<h2 id=\"どうして流行らないのか\" style=\"position:relative;\"><a href=\"#%E3%81%A9%E3%81%86%E3%81%97%E3%81%A6%E6%B5%81%E8%A1%8C%E3%82%89%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\" aria-label=\"どうして流行らないのか permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>どうして流行らないのか？</h2>\n<p>これはあくまでも私の主観なのですが、おそらく、</p>\n<p><strong>Pythonの皮を被ったC言語というのはしょせんC言語でしかない</strong>というところでしょうか？</p>\n<p>例えば新しい言語でV言語というのがありますが、あちらは<strong>Go</strong>の構文を色濃く採用しながら、Goのイケてないところを修正してます。例えばジェネリクス(Go2では採用されるらしいですが)やアクセス修飾子、ワンバイナリからlibの切り出しRustに代表されるGCを使わないメモリ管理などを組み込んでいます。</p>\n<p>V言語も流行っているわけではないが、Nimよりは周りで聞くような<strong>気</strong>もします。あくまでも気もするだけだが...。</p>\n<p>V言語はGoを参考にした構文に対し、NimはPythonを明らかに参考にしています。それだけ、書きやすいのかな？と思いつつ例えばこんなことが起きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">proc</span> <span class=\"token function\">hoge</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> int\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">fuga</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> int <span class=\"token operator\">=</span>\r\n  result <span class=\"token operator\">=</span> <span class=\"token function\">hoge</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">hoge</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> int <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token number\">2</span> <span class=\"token operator\">^</span> n</code></pre></div>\n<p>C言語に親しみのあるほうは、一行目のhoge関数はプロトタイプ宣言かと思いますが、Python書いているだけだと、こんなことわかりません。</p>\n<p><del>大学の授業でC言語やったことある人なら、プロトタイプ宣言はわかりますよね!?</del></p>\n<p>Nimを書いているとちょこちょここんなことが起きます。</p>\n<p>型は型アノテーションもあったりするので慣れ親しんだ人もいると思いますが、C言語特有の話が出てくるとちょっと混乱したりします。</p>\n<p>こういうところがPythonとデラ相性が悪いのです。(と感じるのです)</p>\n<p>というより、もうCとして考えてくださいって感じです。</p>\n<h2 id=\"nimでtwittersdk作る\" style=\"position:relative;\"><a href=\"#nim%E3%81%A7twittersdk%E4%BD%9C%E3%82%8B\" aria-label=\"nimでtwittersdk作る permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NimでTwitterSDK作る</h2>\n<p>とまぁいろいろ問題点は書きましたが、私はNimが好きなので、何か貢献しようと思いTwitterSDKを作っていこうと思います。</p>\n<p>マイナー言語は車輪の再開発の心配がなくものづくりができるのですばらしいですね。（涙）</p>\n<p>ということでまず、TwitterAPIへのアクセス方法について確認します。</p>\n<h2 id=\"twitterapi\" style=\"position:relative;\"><a href=\"#twitterapi\" aria-label=\"twitterapi permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TwitterAPI</h2>\n<p>TwitterAPIにはv2とv1.1があるのですが今回はv1.1を使って実装します。</p>\n<p><a href=\"https://developer.twitter.com/en/docs/twitter-api/v1\" target=\"_blank\" rel=\"noopener noreferrer\">https://developer.twitter.com/en/docs/twitter-api/v1</a></p>\n<p>v1.1のAPI認可方式はoAuth1.0です。</p>\n<h3 id=\"oauth10をnimで使うには\" style=\"position:relative;\"><a href=\"#oauth10%E3%82%92nim%E3%81%A7%E4%BD%BF%E3%81%86%E3%81%AB%E3%81%AF\" aria-label=\"oauth10をnimで使うには permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>oAuth1.0をNimで使うには？</h3>\n<p>APIを使うには当然HTTPリクエストができないといけないですが、Nimにはhttpclientというライブラリがあらかじめ用意されております。</p>\n<p>がしかしザンネンながら、Nimのhttpclientは<strong>oAuthには対応してない</strong>ので、処理系は自前で作らないといけません。</p>\n<p>oAuth2.0、つまりapplication keyとそのシークレットでアクセス可能なAPIであればさほど処理系は難しくなく、Basic認証としてheaderにそれぞれを設定してあげればBearer tokenが取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">import</span> httpclient\r\n\r\n<span class=\"token keyword\">const</span> authEndpoint <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.twitter.com/oauth2/token\"</span>\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">getBearerToken</span><span class=\"token punctuation\">(</span>apiKey<span class=\"token operator\">:</span>string<span class=\"token punctuation\">,</span> apiSecret<span class=\"token operator\">:</span>string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>string <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">let</span> client <span class=\"token operator\">=</span> <span class=\"token function\">newHttpClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">let</span> credentials <span class=\"token operator\">=</span> <span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>apiKey <span class=\"token operator\">&amp;</span> <span class=\"token string\">\":\"</span> <span class=\"token operator\">&amp;</span> apiSecret<span class=\"token punctuation\">)</span>\r\n  client<span class=\"token operator\">.</span>headers <span class=\"token operator\">=</span> <span class=\"token function\">newHttpHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/x-www-form-urlencoded;charset=UTF-8\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"Authorization\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Basic \"</span> <span class=\"token operator\">&amp;</span> credentials\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token string\">\"grant_type=client_credentials\"</span>\r\n  <span class=\"token keyword\">let</span> response <span class=\"token operator\">=</span> <span class=\"token function\">retryRequest</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">,</span> authEndpoint<span class=\"token punctuation\">,</span> httpMethod <span class=\"token operator\">=</span> HttpPost<span class=\"token punctuation\">,</span> body <span class=\"token operator\">=</span> body<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">let</span> bearerToken <span class=\"token operator\">=</span> <span class=\"token function\">parseJson</span><span class=\"token punctuation\">(</span>response<span class=\"token operator\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"access_token\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">return</span> bearerToken</code></pre></div>\n<p>しかしながらTwitterAPI 1.1で使う、oAuth1.0となると話は異なります。</p>\n<p><a href=\"https://oauth.net/core/1.0/\" target=\"_blank\" rel=\"noopener noreferrer\">https://oauth.net/core/1.0/</a></p>\n<p>上記サイトにもあるようにoAuth1.0によるクライアント認証には、RequestTokenのリクエストを投げ込み、レスポンスから認可エンドポイントへのRequestToken認可要求リダイレクト、受け取ったTokenを署名にしてAccessTokenリクエストからやっとAccessTokenが受け取れます。</p>\n<p>長い...。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/KrG6jYE.png\" alt=\"img\">\r\n(<a href=\"https://oauth.net/core/1.0/\" target=\"_blank\" rel=\"noopener noreferrer\">https://oauth.net/core/1.0/</a>)</p>\n<p>めんどくさいなぁーと思っていたら、便利なライブラリありました。</p>\n<h3 id=\"cordeaoauth\" style=\"position:relative;\"><a href=\"#cordeaoauth\" aria-label=\"cordeaoauth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CORDEA/oauth</h3>\n<p><a href=\"https://github.com/CORDEA/oauth\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/CORDEA/oauth</a></p>\n<p>ありがたいです。使い方もとってもかんたんで、インストール後例えばAccessTokenが取りたいときは、</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">import</span> oauth1\r\n\r\n<span class=\"token keyword\">const</span>\r\n    requestTokenUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.twitter.com/oauth/request_token\"</span>\r\n    authorizeUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.twitter.com/oauth/authorize\"</span>\r\n    accessTokenUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.twitter.com/oauth/access_token\"</span>\r\n    \r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span>apiKey<span class=\"token operator\">:</span>string<span class=\"token punctuation\">,</span> apiSecret<span class=\"token operator\">:</span>string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>Table<span class=\"token punctuation\">[</span>string<span class=\"token punctuation\">,</span> string<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">let</span>\r\n    client <span class=\"token operator\">=</span> <span class=\"token function\">newHttpClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    requestTokenResponse <span class=\"token operator\">=</span> client<span class=\"token operator\">.</span><span class=\"token function\">getOAuth1RequestToken</span><span class=\"token punctuation\">(</span>requestTokenUrl<span class=\"token punctuation\">,</span> apiKey<span class=\"token punctuation\">,</span> apiSecret<span class=\"token punctuation\">,</span> isIncludeVersionToHeader <span class=\"token operator\">=</span> true<span class=\"token punctuation\">)</span> <span class=\"token comment\"># RequestToken取得</span>\r\n    requestTokenBody <span class=\"token operator\">=</span> <span class=\"token function\">parseResponseBody</span><span class=\"token punctuation\">(</span>requestTokenResponse<span class=\"token operator\">.</span>body<span class=\"token punctuation\">)</span>\r\n    requestToken <span class=\"token operator\">=</span> requestTokenBody<span class=\"token punctuation\">[</span><span class=\"token string\">\"oauth_token\"</span><span class=\"token punctuation\">]</span>\r\n    requestTokenSecret <span class=\"token operator\">=</span> requestTokenBody<span class=\"token punctuation\">[</span><span class=\"token string\">\"oauth_token_secret\"</span><span class=\"token punctuation\">]</span>\r\n  echo <span class=\"token string\">\"Access the url, please obtain the verifier key.\"</span>\r\n  echo <span class=\"token function\">getAuthorizeUrl</span><span class=\"token punctuation\">(</span>authorizeUrl<span class=\"token punctuation\">,</span> requestToken<span class=\"token punctuation\">)</span>\r\n  echo <span class=\"token string\">\"Please enter a verifier key (PIN code).\"</span> <span class=\"token comment\"># Redirect</span>\r\n  <span class=\"token keyword\">let</span>\r\n    verifier <span class=\"token operator\">=</span> readLine stdin\r\n    accessTokenResponse <span class=\"token operator\">=</span> client<span class=\"token operator\">.</span><span class=\"token function\">getOAuth1AccessToken</span><span class=\"token punctuation\">(</span>accessTokenUrl<span class=\"token punctuation\">,</span> apiKey<span class=\"token punctuation\">,</span> apiSecret<span class=\"token punctuation\">,</span> requestToken<span class=\"token punctuation\">,</span> requestTokenSecret<span class=\"token punctuation\">,</span> verifier<span class=\"token punctuation\">,</span> isIncludeVersionToHeader <span class=\"token operator\">=</span> true<span class=\"token punctuation\">)</span> <span class=\"token comment\"># AccessToken取得</span>\r\n    accessTokenResponseBody <span class=\"token operator\">=</span> <span class=\"token function\">parseResponseBody</span><span class=\"token punctuation\">(</span>accessTokenResponse<span class=\"token operator\">.</span>body<span class=\"token punctuation\">)</span>\r\n    accessToken <span class=\"token operator\">=</span> accessTokenResponseBody<span class=\"token punctuation\">[</span><span class=\"token string\">\"oauth_token\"</span><span class=\"token punctuation\">]</span>\r\n    accessTokenSecret <span class=\"token operator\">=</span> accessTokenResponseBody<span class=\"token punctuation\">[</span><span class=\"token string\">\"oauth_token_secret\"</span><span class=\"token punctuation\">]</span>\r\n  result <span class=\"token operator\">=</span> <span class=\"token function\">initTable[string, string]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  result<span class=\"token punctuation\">[</span><span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">=</span> accessToken\r\n  result<span class=\"token punctuation\">[</span><span class=\"token string\">\"accessTokenSecret\"</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">=</span> accessTokenSecret</code></pre></div>\n<p>という具合でAccessTokenが取れてしまいます。</p>\n<p>さて、これでNimでTwitterのAPIを叩く準備ができました。</p>\n<h3 id=\"リトライの実装\" style=\"position:relative;\"><a href=\"#%E3%83%AA%E3%83%88%E3%83%A9%E3%82%A4%E3%81%AE%E5%AE%9F%E8%A3%85\" aria-label=\"リトライの実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>リトライの実装</h3>\n<p>ついでにAPIコールでリトライできるように改造しましょう。</p>\n<p>なんのことはないです。再帰で呼びつつ、リトライカウントを引数で渡しながら0になったら抜けるよくある実装です。</p>\n<p>リトライ時のSleepは<strong>Exponential BackOff</strong>つまり<strong>指数関数的バックオフ</strong>の実装にしました。</p>\n<p>もともとはネットワークの<strong>コリジョン</strong>が発生したときの待ち時間採択で使われていたアルゴリズムらしいですが、今はもっぱらAPIのリトライ制御に使っています。</p>\n<p>（今の子どもたちって、ネットワークのコリジョンとか知らないのでは？半二重通信とかなにそれおいしいの？だと思いますが、それだけ世の中が発達したということですね。）</p>\n<p>とはいっても難しいことはないです。なんのことはないです。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/lFclC4Z.png\" alt=\"img\"></p>\n<p>で算出できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\">\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">exponentialBackoff<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> int <span class=\"token operator\">=</span>\r\n   <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\r\n     <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\r\n   <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\r\n     <span class=\"token keyword\">return</span> <span class=\"token number\">2</span> <span class=\"token operator\">^</span> n <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\r\n\r\n<span class=\"token comment\"># いわゆる再帰でリトライを実施するやつ。デフォルト引数がNimでは使えるから実装かんたん</span>\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">retryoAuth1Request<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>client<span class=\"token operator\">:</span> HttpClient<span class=\"token punctuation\">,</span> url<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> apiKey<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> apiSecret<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> accessToken<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> accessTokenSecret<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> isIncludeVersionToHeader<span class=\"token operator\">:</span> bool <span class=\"token operator\">=</span> true<span class=\"token punctuation\">,</span> httpMethod<span class=\"token operator\">:</span> HttpMethod <span class=\"token operator\">=</span> HttpGet<span class=\"token punctuation\">,</span> maxRetries<span class=\"token operator\">:</span> int <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> retryCount<span class=\"token operator\">:</span> int <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Response  <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">try</span><span class=\"token operator\">:</span>\r\n    result <span class=\"token operator\">=</span> client<span class=\"token operator\">.</span><span class=\"token function\">oAuth1Request</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> apiKey<span class=\"token punctuation\">,</span> apiSecret<span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">,</span> accessTokenSecret<span class=\"token punctuation\">,</span> isIncludeVersionToHeader<span class=\"token punctuation\">,</span> httpMethod <span class=\"token operator\">=</span> httpMethod<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">except</span><span class=\"token operator\">:</span>\r\n    <span class=\"token keyword\">if</span> retryCount <span class=\"token operator\">>=</span> maxRetries<span class=\"token operator\">:</span>\r\n      <span class=\"token keyword\">raise</span>\r\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token function\">exponentialBackoff</span><span class=\"token punctuation\">(</span>retryCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    result <span class=\"token operator\">=</span> <span class=\"token function\">retryoAuth1Request</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> apiKey<span class=\"token punctuation\">,</span> apiSecret<span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">,</span> accessTokenSecret<span class=\"token punctuation\">,</span> isIncludeVersionToHeader<span class=\"token punctuation\">,</span> httpMethod <span class=\"token operator\">=</span> httpMethod<span class=\"token punctuation\">,</span> maxRetries <span class=\"token operator\">=</span> maxRetries<span class=\"token punctuation\">,</span> retryCount <span class=\"token operator\">=</span> retryCount <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n    </code></pre></div>\n<h3 id=\"nimでのクラス\" style=\"position:relative;\"><a href=\"#nim%E3%81%A7%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\" aria-label=\"nimでのクラス permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nimでのクラス</h3>\n<p>上記のoauthで取得できたAccessTokenをうまく引き継ぎながら各APIが叩きたくなると、やはりクラスを作りたくなります。</p>\n<p>が、Nimには<strong>クラスらしいクラスはありません</strong>。Type、Cでいう構造体にメソッドをprocedure(obj)の糖衣構文の形、第一引数にTypeを指定する形で代用します。(Goと同じ感じですね)</p>\n<p>さらにクラスの概念がないので当然コンストラクタもないので、自前コンストラクタを作ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token comment\"># Typeでアトリビュート(メンバ変数)を定義</span>\r\n\r\n<span class=\"token keyword\">type</span>\r\n  Twitter<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">ref</span> <span class=\"token keyword\">object</span> <span class=\"token operator\">of</span> RootObj\r\n    apiKey<span class=\"token operator\">:</span>string\r\n    apiSecret<span class=\"token operator\">:</span>string\r\n    accessToken<span class=\"token operator\">:</span>string\r\n    accessTokenSecret<span class=\"token operator\">:</span>string\r\n    bearerToken<span class=\"token operator\">*:</span> string\r\n    tweets<span class=\"token operator\">*:</span> JsonNode\r\n    searches<span class=\"token operator\">*:</span> JsonNode\r\n    trends<span class=\"token operator\">*:</span> JsonNode\r\n    lists<span class=\"token operator\">*:</span> JsonNode\r\n    sinceId<span class=\"token operator\">*:</span> string\r\n\r\n<span class=\"token comment\"># 自前コンストラクタ。Twitter Typeを返してあげる</span>\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">newTwitter<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>apiKey<span class=\"token operator\">:</span>string<span class=\"token punctuation\">,</span> apiSecret<span class=\"token operator\">:</span>string<span class=\"token punctuation\">,</span> accessToken<span class=\"token operator\">:</span>string<span class=\"token punctuation\">,</span> accessTokenSecret<span class=\"token operator\">:</span>string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>Twitter <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">let</span> tw <span class=\"token operator\">=</span> new Twitter\r\n  tw<span class=\"token operator\">.</span>apiKey <span class=\"token operator\">=</span> apiKey\r\n  tw<span class=\"token operator\">.</span>apiSecret <span class=\"token operator\">=</span> apiSecret\r\n  tw<span class=\"token operator\">.</span>accessToken <span class=\"token operator\">=</span> accessToken\r\n  tw<span class=\"token operator\">.</span>accessTokenSecret <span class=\"token operator\">=</span> accessTokenSecret\r\n  <span class=\"token keyword\">if</span> tw<span class=\"token operator\">.</span>accessToken <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">and</span> tw<span class=\"token operator\">.</span>accessTokenSecret <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token operator\">:</span>\r\n    <span class=\"token keyword\">let</span> tokens <span class=\"token operator\">=</span> <span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span>tw<span class=\"token operator\">.</span>apiKey<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>apiSecret<span class=\"token punctuation\">)</span>\r\n    tw<span class=\"token operator\">.</span>accessToken <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">[</span><span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">]</span>\r\n    tw<span class=\"token operator\">.</span>accessTokenSecret <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">[</span><span class=\"token string\">\"accessTokenSecret\"</span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token keyword\">discard</span> <span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>accessToken<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">discard</span> <span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"accessTokenSecret\"</span><span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>accessTokenSecret<span class=\"token punctuation\">)</span>\r\n  tw<span class=\"token operator\">.</span>bearerToken <span class=\"token operator\">=</span> <span class=\"token function\">getBearerToken</span><span class=\"token punctuation\">(</span>tw<span class=\"token operator\">.</span>apiKey<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>apiSecret<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">return</span> tw\r\n  \r\n<span class=\"token comment\"># 第一引数にTypeを指定するとTypeに関数がバインドされてメソッドっぽくなる</span>\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">getHomeTimeline<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>tw<span class=\"token operator\">:</span>Twitter<span class=\"token punctuation\">,</span> sinceId<span class=\"token operator\">:</span> string <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>JsonNode <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">let</span> client <span class=\"token operator\">=</span> <span class=\"token function\">newHttpClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">var</span> url<span class=\"token operator\">:</span> string\r\n  <span class=\"token keyword\">if</span> sinceId <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token operator\">:</span>\r\n    url <span class=\"token operator\">=</span> homeTimelineEndpoint\r\n  <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\r\n    url <span class=\"token operator\">=</span> homeTimelineEndpoint <span class=\"token operator\">&amp;</span> <span class=\"token string\">\"&amp;since_id=\"</span> <span class=\"token operator\">&amp;</span> sinceId\r\n  <span class=\"token keyword\">let</span> timeline <span class=\"token operator\">=</span> <span class=\"token function\">retryoAuth1Request</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>apiKey<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>apiSecret<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>accessToken<span class=\"token punctuation\">,</span> tw<span class=\"token operator\">.</span>accessTokenSecret<span class=\"token punctuation\">,</span> isIncludeVersionToHeader <span class=\"token operator\">=</span> true<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">try</span><span class=\"token operator\">:</span>\r\n    tw<span class=\"token operator\">.</span>tweets <span class=\"token operator\">=</span> <span class=\"token function\">parseJson</span><span class=\"token punctuation\">(</span>timeline<span class=\"token operator\">.</span>body<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">except</span> JsonParsingError<span class=\"token operator\">:</span>\r\n    echo timeline<span class=\"token operator\">.</span>headers\r\n    echo timeline<span class=\"token operator\">.</span>body</code></pre></div>\n<h3 id=\"configを持たせるには\" style=\"position:relative;\"><a href=\"#config%E3%82%92%E6%8C%81%E3%81%9F%E3%81%9B%E3%82%8B%E3%81%AB%E3%81%AF\" aria-label=\"configを持たせるには permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configを持たせるには?</h3>\n<p>Configをプログラムから切り離してもたせる方法はいくつかありますが、色々考えた結果今回はTextConfig形式を使うことにしました。</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">auth</span><span class=\"token punctuation\">]</span></span>\r\n<span class=\"token key attr-name\">appKey</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"<span class=\"token inner-value\">xxxxxx</span>\"</span>\r\n<span class=\"token key attr-name\">appKeySecret</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"<span class=\"token inner-value\">xxxxxxxxxxxxxxxx</span>\"</span>\r\n<span class=\"token key attr-name\">accessToken</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"<span class=\"token inner-value\">xxxxxxxxxxxxxx</span>\"</span>\r\n<span class=\"token key attr-name\">accessTokenSecret</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"<span class=\"token inner-value\">xxxxxxx</span>\"</span></code></pre></div>\n<p>Windowsでは.iniファイルとして馴染みのある形かと思いますが、name=hogeみたいなパラメータと[section]みたいなセクションから構成されるごくごく普通のコンフィグファイルの形式です。</p>\n<p>Nimではparsecfgというライブラリで読むことができ、更にうれしいのが<strong>書き込み</strong>もできるので今回はこちらを使います。</p>\n<p>自身で取得したAppKeyを使いたい場合や、AccessTokenの保存先としてsettings.cfgを指定する形で実装しております。(セキュリティ的にはAccessToken晒し上げよろしくないですが)</p>\n<p>セクション内のパラメーターを読み込むときは<strong>getSectionValue</strong>を使います。書き込みの際はsetSectionKeyでセクション、パラメータを指定しwriteConfigします。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">import</span> parsecfg<span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">,</span> secret\r\n\r\n<span class=\"token keyword\">type</span>\r\n  TwitterConfig<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">ref</span> <span class=\"token keyword\">object</span> <span class=\"token operator\">of</span> RootObj\r\n    appKey<span class=\"token operator\">*:</span> string\r\n    appKeySecret<span class=\"token operator\">*:</span> string\r\n    accessToken<span class=\"token operator\">*:</span> string\r\n    accessTokenSecret<span class=\"token operator\">*:</span> string\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">getConfig<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>TwitterConfig <span class=\"token operator\">=</span>\r\n <span class=\"token keyword\">var</span> cfg<span class=\"token operator\">:</span> Config\r\n <span class=\"token keyword\">if</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n   cfg <span class=\"token operator\">=</span> <span class=\"token function\">loadConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span>\r\n <span class=\"token keyword\">elif</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n   cfg <span class=\"token operator\">=</span> <span class=\"token function\">loadConfig</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n result <span class=\"token operator\">=</span> new TwitterConfig\r\n <span class=\"token keyword\">if</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"appKey\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">and</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"appKeySecret\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token operator\">:</span>\r\n   result<span class=\"token operator\">.</span>appKey <span class=\"token operator\">=</span> <span class=\"token function\">getDefaultAppKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n   result<span class=\"token operator\">.</span>appKeySecret <span class=\"token operator\">=</span> <span class=\"token function\">getDefaultAppKeySecret</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\r\n   <span class=\"token comment\"># sectionにあるパラメーターを取るときはgetSectionValueでとれる</span>\r\n   result<span class=\"token operator\">.</span>appKey <span class=\"token operator\">=</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"appKey\"</span><span class=\"token punctuation\">)</span>\r\n   result<span class=\"token operator\">.</span>appKeySecret <span class=\"token operator\">=</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"appKeySecret\"</span><span class=\"token punctuation\">)</span>\r\n result<span class=\"token operator\">.</span>accessToken <span class=\"token operator\">=</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"accessToken\"</span><span class=\"token punctuation\">)</span>\r\n result<span class=\"token operator\">.</span>accessTokenSecret <span class=\"token operator\">=</span> cfg<span class=\"token operator\">.</span><span class=\"token function\">getSectionValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"accessTokenSecret\"</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">setConfig<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>section<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>TwitterConfig <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">var</span> cfg<span class=\"token operator\">:</span> Config\r\n  <span class=\"token keyword\">if</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n    cfg <span class=\"token operator\">=</span> <span class=\"token function\">loadConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">elif</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n    cfg <span class=\"token operator\">=</span> <span class=\"token function\">loadConfig</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token comment\"># 書き出しをするときは、setSectionKeyをして</span>\r\n  cfg<span class=\"token operator\">.</span><span class=\"token function\">setSectionKey</span><span class=\"token punctuation\">(</span>section<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">if</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n    cfg<span class=\"token operator\">.</span><span class=\"token function\">writeConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">elif</span> os<span class=\"token operator\">.</span><span class=\"token function\">existsFile</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\r\n    <span class=\"token comment\"># writeconfigをする</span>\r\n    cfg<span class=\"token operator\">.</span><span class=\"token function\">writeConfig</span><span class=\"token punctuation\">(</span><span class=\"token function\">joinPath</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAppDir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"settings.cfg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"twittersdk作ったけど何しようか\" style=\"position:relative;\"><a href=\"#twittersdk%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%91%E3%81%A9%E4%BD%95%E3%81%97%E3%82%88%E3%81%86%E3%81%8B\" aria-label=\"twittersdk作ったけど何しようか permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TwitterSDK作ったけど何しようか？</h2>\n<p>ということで、作ったTwitterSDKを使ってなにか作ろうかと思います。</p>\n<p>仕事中にCLIを開いていることが多いのでCLI上でTwitterができるようにして仕事中でもばれずにTwitterできるツールでも作ることにします。</p>\n<p>No Twitter、No Lifeです。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/h8XZ9d2.jpg\" alt=\"ing\"></p>\n<p>さっそくCLI化する旅に出ましょう！</p>\n<h3 id=\"コマンドラインインターフェースで色付き文字を出したい\" style=\"position:relative;\"><a href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A7%E8%89%B2%E4%BB%98%E3%81%8D%E6%96%87%E5%AD%97%E3%82%92%E5%87%BA%E3%81%97%E3%81%9F%E3%81%84\" aria-label=\"コマンドラインインターフェースで色付き文字を出したい permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コマンドラインインターフェースで色付き文字を出したい！</h3>\n<p>というときに便利なライブラリがNimにはあります。</p>\n<p>terminalの<strong>styledWriteLine</strong>を使えば文字色、背景色を自在に変更できます。</p>\n<p><strong>使うときはBlock節に入れないといけないらしい。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">import</span> terminal\r\n\r\n<span class=\"token keyword\">proc</span> <span class=\"token function\">formatTweet<span class=\"token operator\">*</span></span><span class=\"token punctuation\">(</span>tweet<span class=\"token operator\">:</span> Tweet<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\r\n  <span class=\"token keyword\">block</span><span class=\"token operator\">:</span>\r\n    <span class=\"token keyword\">let</span> header <span class=\"token operator\">=</span> tweet<span class=\"token operator\">.</span>user<span class=\"token operator\">.</span>name <span class=\"token operator\">&amp;</span> <span class=\"token string\">\"(@\"</span> <span class=\"token operator\">&amp;</span> tweet<span class=\"token operator\">.</span>user<span class=\"token operator\">.</span>screenName <span class=\"token operator\">&amp;</span> <span class=\"token string\">\") at \"</span> <span class=\"token operator\">&amp;</span> <span class=\"token function\">dateFormat</span><span class=\"token punctuation\">(</span>tweet<span class=\"token operator\">.</span>createdAt<span class=\"token punctuation\">)</span>\r\n    <span class=\"token function\">styledWriteLine</span><span class=\"token punctuation\">(</span>stdout<span class=\"token punctuation\">,</span> fgBlack<span class=\"token punctuation\">,</span> bgGreen<span class=\"token punctuation\">,</span> header<span class=\"token punctuation\">,</span> resetStyle<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"コマンドラインパーサーはいつものdocopt\" style=\"position:relative;\"><a href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%91%E3%83%BC%E3%82%B5%E3%83%BC%E3%81%AF%E3%81%84%E3%81%A4%E3%82%82%E3%81%AEdocopt\" aria-label=\"コマンドラインパーサーはいつものdocopt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コマンドラインパーサーはいつものdocopt</h3>\n<p>docoptは便利なので本当に愛用しているのですが、Nimでも使えるので今回も使います。</p>\n<p>詳しい解説は過去記事<a href=\"https://blog.tubone-project24.xyz/2019/11/20/docopt-nim\" target=\"_blank\" rel=\"noopener noreferrer\">docoptはNimでも使えたのお話</a>をご確認ください。</p>\n<h2 id=\"windowsでもmacでもubuntuでも使いたい\" style=\"position:relative;\"><a href=\"#windows%E3%81%A7%E3%82%82mac%E3%81%A7%E3%82%82ubuntu%E3%81%A7%E3%82%82%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84\" aria-label=\"windowsでもmacでもubuntuでも使いたい permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WindowsでもMacでもUbuntuでも使いたい！</h2>\n<p>ということでGitHub ActionsでCIに乗っけてGitHub Releaseの打ち込みでビルドすることにしました。</p>\n<p>GitHub Releaseで反応するworkflowにしたいので、onは<strong>release.types=created</strong>にします。</p>\n<p>また、GitHub ActionsではOSの種類をそれぞれ<strong>windows-latest</strong>, <strong>macOS-latest</strong>, <strong>ubuntu-latest</strong>で指定できますのでmatrixで指定しちゃいます。</p>\n<p>それぞれのOS対応は下記のとおりです。</p>\n<table>\n<thead>\n<tr>\n<th>label</th>\n<th>OS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ubuntu-latest</td>\n<td>Ubuntu 18.04</td>\n</tr>\n<tr>\n<td>macos-latest</td>\n<td>macOS 10.15</td>\n</tr>\n<tr>\n<td>windows-latest</td>\n<td>Windows Server 2019</td>\n</tr>\n</tbody>\n</table>\n<p>さらに！</p>\n<p>Release noteをGitHub Releaseに乗っけたいので、<a href=\"https://blog.tubone-project24.xyz/2020/08/14/github-action\" target=\"_blank\" rel=\"noopener noreferrer\">前回作った</a><a href=\"https://github.com/marketplace/actions/update-github-release\" target=\"_blank\" rel=\"noopener noreferrer\">Update GitHub Release\r\n</a>を使ってます。</p>\n<p>Release noteの作成は<a href=\"https://github.com/git-chglog/git-chglog\" target=\"_blank\" rel=\"noopener noreferrer\">git-chglog</a>を使って作成します。このツールめちゃスゴ..。</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Release\r\n\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>created<span class=\"token punctuation\">]</span>\r\n\r\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">os</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n            <span class=\"token key atrule\">asset_name_suffix</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\r\n            <span class=\"token key atrule\">asset_content_type</span><span class=\"token punctuation\">:</span> application/octet<span class=\"token punctuation\">-</span>stream\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">os</span><span class=\"token punctuation\">:</span> windows<span class=\"token punctuation\">-</span>latest\r\n            <span class=\"token key atrule\">asset_name_suffix</span><span class=\"token punctuation\">:</span> .exe\r\n            <span class=\"token key atrule\">asset_content_type</span><span class=\"token punctuation\">:</span> application/octet<span class=\"token punctuation\">-</span>stream\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">os</span><span class=\"token punctuation\">:</span> macOS<span class=\"token punctuation\">-</span>latest\r\n            <span class=\"token key atrule\">asset_name_suffix</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\r\n            <span class=\"token key atrule\">asset_content_type</span><span class=\"token punctuation\">:</span> application/octet<span class=\"token punctuation\">-</span>stream\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> tubone24/setup<span class=\"token punctuation\">-</span>nim<span class=\"token punctuation\">-</span>action@v1.0.1\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set secret file\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">SECRET_FILE</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.SECRET_FILE <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          echo $SECRET_FILE > base64.txt\r\n          nim c --run scripts/createBase64ToFile.nim</span>\r\n        <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> nimble install <span class=\"token punctuation\">-</span>d <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>accept\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> nimble build <span class=\"token punctuation\">-</span>d<span class=\"token punctuation\">:</span>release\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> get version\r\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> get_version\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}</span>\r\n        <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> update release\r\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> update_release\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> tubone24/update_release@v1.0\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.token <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload Release Asset\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/upload<span class=\"token punctuation\">-</span>release<span class=\"token punctuation\">-</span>asset@v1\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.github_token <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">upload_url</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.update_release.outputs.upload_url <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">asset_path</span><span class=\"token punctuation\">:</span> ./bin/post_twitter_on_work$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.asset_name_suffix <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">asset_name</span><span class=\"token punctuation\">:</span> post_twitter_on_work_$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>_$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.get_version.outputs.VERSION <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.asset_name_suffix <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">asset_content_type</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> matrix.asset_content_type <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n  <span class=\"token key atrule\">update-release-note</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Generate Release Note\r\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> generate_release_note\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          wget https://github.com/git-chglog/git-chglog/releases/download/0.9.1/git-chglog_linux_amd64\r\n          chmod +x git-chglog_linux_amd64\r\n          mv git-chglog_linux_amd64 git-chglog\r\n          ./git-chglog --output ./changelog.md $(git describe --tags $(git rev-list --tags --max-count=1))</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Release Body\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> tubone24/update_release@v1.1.0\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.token <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">body_path</span><span class=\"token punctuation\">:</span> ./changelog.md</code></pre></div>\n<p>これで、Releaseを打ったタイミングで、各OSに対応したバイナリがArtifactsとして公開されるようになりました！</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/zhLloGo.png\" alt=\"img\"></p>\n<h2 id=\"できたかも\" style=\"position:relative;\"><a href=\"#%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%8B%E3%82%82\" aria-label=\"できたかも permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>できたかも～</h2>\n<p>ということで..。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/tMjBX5q.jpg\" alt=\"ig\"></p>\n<p>できたできたかも!!</p>\n<p>ダウンロードはこちらから!!!</p>\n<p><a href=\"https://github.com/tubone24/post_twitter_on_work/releases\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tubone24/post_twitter_on_work/releases</a></p>\n<p>使い方はdocoptのUsageをそのまま貼っておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Overview:\r\n  Get Tweets on CLI for Nim Client\r\n\r\nUsage:\r\n  post_twitter_on_work status\r\n  post_twitter_on_work home [-r|--resetToken] [-i|--interval=&lt;seconds>]\r\n  post_twitter_on_work mention [-r|--resetToken] [-i|--interval=&lt;seconds>]\r\n  post_twitter_on_work user &lt;username> [-r|--resetToken] [-i|--interval=&lt;seconds>]\r\n  post_twitter_on_work search &lt;query> [-r|--resetToken] [-i|--interval=&lt;seconds>]\r\n  post_twitter_on_work list &lt;username>\r\n  post_twitter_on_work showlist &lt;username> &lt;slugname> [-r|--resetToken] [-i|--interval=&lt;seconds>]\r\n  post_twitter_on_work post &lt;text> [-r|--resetToken]\r\n\r\nOptions:\r\n  status                      Get status\r\n  home                        Get home timeline\r\n  mention                     Get mention timeline\r\n  user                        Get user timeline\r\n  search                      Get twitter search\r\n  list                        Get twitter list\r\n  post                        Post Tweet\r\n  showlist                    Show list\r\n  &lt;username>                  Twitter username\r\n  &lt;query>                     Search query keyword\r\n  &lt;text>                      Tweet text\r\n  &lt;slugname>                  Slug name\r\n  -i, --interval=&lt;seconds>    Get tweet interval (defaults 60 second)\r\n  -r, --resetToken            Reset accessToken when change user account</code></pre></div>\n<p>というのは冗談で、例えば自分のタイムラインが見たいときは、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ post_twitter_on_work home</code></pre></div>\n<p>とやってあげればいいです。これだけです。</p>\n<p>初回アクセス、またはリセットトークンのときだけ、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./post_witter_on_work home\r\n\r\nAccess the url, please obtain the verifier key.\r\nhttps://api.twitter.com/oauth/authorize?oauth_token=xxxxxxxxxxxxxxxxxxxxxxx\r\nPlease enter a verifier key (PIN code).</code></pre></div>\n<p>とアクセストークンのリクエストのためPINの要求が入ります。</p>\n<p>URLにアクセスすれば、</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/3GwsdvT.png\" alt=\"img\"></p>\n<p>という具合でPINが出てくるのでこちらを入力してくれればアクセストークンを取ってそのままタイムラインの表示に移ります。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/VASzn6U.png\" alt=\"img\"></p>\n<p>また、返信の確認は、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">post_twitter_on_work mention</code></pre></div>\n<p>投稿は、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">post_twitter_on_work post 投稿したい文言</code></pre></div>\n<p>でできます。シンプルですね。</p>\n<p>これで仕事中でもばれずにTwitterできますね（遠い目）。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/zAFRZJQ.gif\" alt=\"img\"></p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>実は今すごい仕事が忙しいのでこんなツール作っても仕事中にTwitterなんてできません。</p>\n<p>久しぶりにリモートワークだったので、余暇を使って振り返り記事書きました。以上。</p>","words":4619,"minutes":12}},"staticQueryHashes":["1319877725","2959249232"]}