{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2020/04/24/jetson-nano","result":{"data":{"content":{"edges":[{"node":{"id":"a8beef44-4251-5992-8c65-461632eb2ed1","excerpt":"こんにちは。 Jetson nanoを使って、物体検知をしてみます。 物体検知にはtiny_yolov2_onnx_camを使います。 Table of Contents Jetson nanoへのインストール 依存パッケージを入れる Cythonを入れる tiny_yolov…","fields":{"slug":"2020/04/24/jetson-nano"},"frontmatter":{"id":null,"title":"tiny_yolov2_onnx_camを使って物体検知する","slug":"2020/04/24/jetson-nano","date":"2020-04-24T11:28:14.315Z","headerImage":"https://i.imgur.com/jzkNhR6.jpg","tags":["機械学習","物体検知"]}}}]}},"pageContext":{"id":"a8beef44-4251-5992-8c65-461632eb2ed1","index":40,"repHtml":"<p>こんにちは。</p>\n<p>Jetson nanoを使って、物体検知をしてみます。</p>\n<p>物体検知には<a href=\"https://github.com/tsutof/tiny_yolov2_onnx_cam\" target=\"_blank\" rel=\"noopener noreferrer\">tiny_yolov2_onnx_cam</a>を使います。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#jetson-nano%E3%81%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">Jetson nanoへのインストール</a></p>\n<ul>\n<li><a href=\"#%E4%BE%9D%E5%AD%98%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B\">依存パッケージを入れる</a></li>\n<li><a href=\"#cython%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B\">Cythonを入れる</a></li>\n<li><a href=\"#tiny_yolov2_onnx_cam%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">tiny_yolov2_onnx_camをインストールする</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B\">起動する</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"jetson-nanoへのインストール\" style=\"position:relative;\"><a href=\"#jetson-nano%E3%81%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"jetson nanoへのインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jetson nanoへのインストール</h2>\n<p>まず、Jetson nanoに <strong>tiny_yolov2_onnx_cam</strong> をインストールします。</p>\n<p>基本は、<a href=\"https://github.com/tsutof/tiny_yolov2_onnx_cam/blob/master/README.ja.md\" target=\"_blank\" rel=\"noopener noreferrer\">README.md</a>に従って叩くだけです。</p>\n<h3 id=\"依存パッケージを入れる\" style=\"position:relative;\"><a href=\"#%E4%BE%9D%E5%AD%98%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B\" aria-label=\"依存パッケージを入れる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>依存パッケージを入れる</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ sudo apt update\n\n$ sudo apt install python3-pip protobuf-compiler libprotoc-dev libjpeg-dev cmake</code></pre></div>\n<p>画像を扱うためのライブラリと、<a href=\"https://developers.google.com/protocol-buffers\" target=\"_blank\" rel=\"noopener noreferrer\">Protocol Buffers</a>を扱うライブラリとCMakeです。</p>\n<h3 id=\"cythonを入れる\" style=\"position:relative;\"><a href=\"#cython%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B\" aria-label=\"cythonを入れる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cythonを入れる</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip3 install --user cython</code></pre></div>\n<p>Cythonを入れます。入れないと、 pipで<strong>requirements.txt</strong>を使ってPyCudaを入れるとき、下記のような **Running cythonize failed!**が起きちゃいます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Processing scipy/cluster/_vq_rewrite.pyx\nTraceback (most recent call last):\n  File \"tools/cythonize.py\", line 172, in &lt;module>\n    main()\n  File \"tools/cythonize.py\", line 168, in main\n    find_process_files(root_dir)\n  File \"tools/cythonize.py\", line 160, in find_process_files\n    process(cur_dir, fromfile, tofile, function, hash_db)\n  File \"tools/cythonize.py\", line 137, in process\n    processor_function(fromfile, tofile)\n  File \"tools/cythonize.py\", line 66, in process_pyx\n    raise OSError('Cython needs to be installed')\nOSError: Cython needs to be installed\n\nTraceback (most recent call last):\n  File \"setup.py\", line 209, in &lt;module>\n    setup_package()\n  File \"setup.py\", line 202, in setup_package\n    generate_cython()\n  File \"setup.py\", line 147, in generate_cython\n    raise RuntimeError(\"Running cythonize failed!\")\nRuntimeError: Running cythonize failed!</code></pre></div>\n<h3 id=\"tiny_yolov2_onnx_camをインストールする\" style=\"position:relative;\"><a href=\"#tiny_yolov2_onnx_cam%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"tiny_yolov2_onnx_camをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tiny_yolov2_onnx_camをインストールする</h3>\n<p><strong>git clone</strong>でtiny_yolov2_onnx_camを落としてきます。</p>\n<p>また、Cudaにパスを通します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/tsutof/tiny_yolov2_onnx_cam\n\n$ cd tiny_yolov2_onnx_cam\n\n$ export PATH=$PATH:/usr/local/cuda-10.0.0/bin\n\n$ python3 -m pip install -r requirements.txt</code></pre></div>\n<p>合わせて、<strong>Jetsonのクロックアップ</strong>をします。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ sudo nvpmodel -m 0\n$ sudo jetson_clocks</code></pre></div>\n<h2 id=\"起動する\" style=\"position:relative;\"><a href=\"#%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B\" aria-label=\"起動する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>起動する</h2>\n<p>Raspberry PIのカメラをぶっ刺したので**--camera -1**を引数にします。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/gWqd2xb.jpg\" alt=\"img\"></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ python3 tiny_yolov2_onnx_cam.py --camera -1</code></pre></div>\n<p>ONNX形式からTensorRTに変換するので初回起動は時間かかります。</p>\n<p>しばらくするとカメラが起動し、物体検知が始まります。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/jzkNhR6.jpg\" alt=\"img\"></p>","words":621,"minutes":2}},"staticQueryHashes":["1319877725","2959249232"]}