{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2021/01/01/mqtt-nenga","result":{"data":{"content":{"edges":[{"node":{"id":"6c140dfd-7da4-5bf1-9461-175faa114fab","excerpt":"年賀書きたくないマン. Table of Contents 一年の計は元旦にあり 注意 年末年始はやってみようBOX MQTT React Hooks Tailwind CSS 電子ペーパー やらないことにしようBOX アーキテクチャー 辛かったこと Hooks…","fields":{"slug":"2021/01/01/mqtt-nenga"},"frontmatter":{"id":null,"title":"MQTTと電子ペーパーを使って年賀状を作る","slug":"2021/01/01/mqtt-nenga","date":"2021-01-01T12:58:01.960Z","headerImage":"https://i.imgur.com/tmkmoVA.png","tags":["MQTT","RaspberryPi","年賀状"]}}}]}},"pageContext":{"id":"6c140dfd-7da4-5bf1-9461-175faa114fab","index":25,"repHtml":"<p>年賀書きたくないマン.</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E4%B8%80%E5%B9%B4%E3%81%AE%E8%A8%88%E3%81%AF%E5%85%83%E6%97%A6%E3%81%AB%E3%81%82%E3%82%8A\">一年の計は元旦にあり</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%B3%A8%E6%84%8F\">注意</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%B9%B4%E6%9C%AB%E5%B9%B4%E5%A7%8B%E3%81%AF%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86box\">年末年始はやってみようBOX</a></p>\n<ul>\n<li><a href=\"#mqtt\">MQTT</a></li>\n<li><a href=\"#react-hooks\">React Hooks</a></li>\n<li><a href=\"#tailwind-css\">Tailwind CSS</a></li>\n<li><a href=\"#%E9%9B%BB%E5%AD%90%E3%83%9A%E3%83%BC%E3%83%91%E3%83%BC\">電子ペーパー</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%82%84%E3%82%89%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%81%AB%E3%81%97%E3%82%88%E3%81%86box\">やらないことにしようBOX</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%83%BC\">アーキテクチャー</a></p>\n</li>\n<li>\n<p><a href=\"#%E8%BE%9B%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\">辛かったこと</a></p>\n<ul>\n<li><a href=\"#hooks%E3%82%8F%E3%81%8B%E3%82%93%E3%81%AD%E3%81%87%E5%9E%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%A8%E3%81%8A%E3%82%89%E3%81%AD%E3%81%87\">Hooksわかんねぇ！型チェックとおらねぇ!!</a></li>\n<li><a href=\"#tailwind%E7%B5%90%E5%B1%80%E3%81%A4%E3%81%8B%E3%81%84%E3%81%93%E3%81%AA%E3%81%9B%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C\">Tailwind結局つかいこなせない問題</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E6%80%9D%E3%81%84%E9%80%9A%E3%82%8A%E9%80%B2%E3%82%93%E3%81%A0%E3%81%A8%E3%81%93%E3%82%8D\">思い通り進んだところ</a></p>\n<ul>\n<li><a href=\"#fastapi\">FastAPI</a></li>\n<li><a href=\"#mqtt-1\">MQTT</a></li>\n<li><a href=\"#mosquitto\">mosquitto</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\">できあがったもの</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%83%87%E3%83%A2\">デモ</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%94%B9%E3%82%81%E3%81%BE%E3%81%97%E3%81%A6\">改めまして</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"一年の計は元旦にあり\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E5%B9%B4%E3%81%AE%E8%A8%88%E3%81%AF%E5%85%83%E6%97%A6%E3%81%AB%E3%81%82%E3%82%8A\" aria-label=\"一年の計は元旦にあり permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一年の計は元旦にあり</h2>\n<p>**あけましておめでとうございます。**昨年は大変お世話になりました。本年もどうぞよろしくお願いします。</p>\n<p>さて、お世話になったみなさまに年賀状を送りたいのですが、私は<strong>年賀状を書くのが苦手</strong>です。</p>\n<p>というより、まず手書き文字が苦手なのと、文面を考えるのが苦手なのと、郵便局に行くのがめんどくさいのと、滅多にポストをあけないのが原因なのですが、</p>\n<p>ともあって今年も年賀状を締め切りまでに出すことができませんでした。</p>\n<p>なんというダメ人間。</p>\n<p>年賀状って以下の点が辛いんですね。</p>\n<ul>\n<li>はがきを書ってこなければ行けない</li>\n<li>専用のソフト、プリンターがないと一枚一枚手書きで辛い</li>\n<li>郵便局に出しいかないといけない</li>\n<li>宛先違うだけでたくさん刷らないといけない</li>\n<li><del>年賀ハガキクジが当たらない</del></li>\n</ul>\n<p>ということで、せっかくなのでこれらのお困りごとを解決するツールをさっそく作ってみることにしました。</p>\n<h2 id=\"注意\" style=\"position:relative;\"><a href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"注意 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>注意</h2>\n<p>今回の記事ですが、やたら<strong>～BOX</strong>というワードが出てきます。</p>\n<p>大意はないのですが、筆者が年末にみたとあるネット記事がマイブームになってしまい、使わざるを得えませんでした。</p>\n<p><a href=\"https://news.yahoo.co.jp/articles/7b0013a34e2072329b1875166dd1268bed972220\" target=\"_blank\" rel=\"noopener noreferrer\">斎藤佑樹が心境激白「考えてもしょうがないＢＯＸ」</a></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/BU7o9ke.jpg\" alt=\"img\"></p>\n<p>読み苦しい限りですがおつきあいくださいませ。</p>\n<h2 id=\"年末年始はやってみようbox\" style=\"position:relative;\"><a href=\"#%E5%B9%B4%E6%9C%AB%E5%B9%B4%E5%A7%8B%E3%81%AF%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86box\" aria-label=\"年末年始はやってみようbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>年末年始はやってみようBOX</h2>\n<p>年末年始という長期休暇は普段忙しくてできないアレコレを入れてある<strong>やってみようBOX</strong>をあける日です。</p>\n<p>仕事のことは<strong>考えてもしょうがないBOX</strong>です。</p>\n<p>ということでこちらのツールですが先に<strong>技術選定</strong>からしていきます。</p>\n<h3 id=\"mqtt\" style=\"position:relative;\"><a href=\"#mqtt\" aria-label=\"mqtt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MQTT</h3>\n<p><a href=\"https://mqtt.org/\" target=\"_blank\" rel=\"noopener noreferrer\">MQTT</a>とは<strong>M</strong>essage <strong>Q</strong>ueue <strong>T</strong>elemetry <strong>T</strong>ransportの略で、pub/subモデルという仕組みに基づいてつくられた軽量なメッセージプロトコルです。</p>\n<p>MQTTの開発元であるIBMに良記事<a href=\"https://developer.ibm.com/jp/articles/iot-mqtt-why-good-for-iot/\" target=\"_blank\" rel=\"noopener noreferrer\">MQTT の基本知識</a>がありましたので詳細は割愛しますが、</p>\n<p>ヘッダーサイズが最小2byteと<strong>軽量</strong>なプロトコルであること、同一Topicに対して<strong>多対多</strong>の通信ができること、ネットワーク品質に応じた<strong>QOS</strong>を設定できること、<strong>ペイロード制約がほぼない</strong>ことが受けて広くIoT分野で使われています。</p>\n<p>ここまでお勉強してこなかったのはIoTに知見がなさすぎたことと、AWS IoTを使ってみたいという気持ちがある一方、まずはMQTTからお勉強しないとという変なこだわりがあったためです。</p>\n<p>今回電子ペーパーを実装した端末がRaspberry Piということもあり、コア技術はMQTTで行くことにしました。</p>\n<h3 id=\"react-hooks\" style=\"position:relative;\"><a href=\"#react-hooks\" aria-label=\"react hooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Hooks</h3>\n<p><a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"noopener noreferrer\">React Hooks</a>も今更？感ありますが、Reactのお勉強はGatsby.jsでのブログ実装以来やっていないので、ちょっと動向に触れることにしました。</p>\n<p>昔、使ってみようかと少し記事も見てみましたことがあったのですが、<strong>クラスコンポーネント</strong>の何が悪いのかイマイチよくわかってないので多分クラスコンポーネントで機能がとっ散らかるくらい大規模にReactを触ってないのであまり関心事にならなかったため、使ったことがありませんでした。</p>\n<p>使わないにしても知らないと職がさすがに無くなりそうなのでお勉強することにしました。</p>\n<h3 id=\"tailwind-css\" style=\"position:relative;\"><a href=\"#tailwind-css\" aria-label=\"tailwind css permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tailwind CSS</h3>\n<p>TrySailのアルバムにTailwindというものがありましたが、<a href=\"https://tailwindcss.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Tailwind CSS</a>もよく聞くので使ってみることにします。</p>\n<iframe loading=\"lazy\" width=\"200\" height=\"113\" src=\"https://www.youtube.com/embed/5HL-OoZjIcQ?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen title=\"TrySail 『TAILWIND』-Music Video YouTube EDIT ver.-\"></iframe>\n<p>軽い、という話を最初に聞き、使ってみたいと思ってましたが、<a href=\"https://tailwindcss.com/docs/optimizing-for-production#app\" target=\"_blank\" rel=\"noopener noreferrer\">必ずしもそういったこともなく</a><strong>Utility-First</strong>に共感できるWeb開発者に受けているんだろうな〜と重い腰が上がりませんでした。</p>\n<p>が、こちらもそろそろ勉強しないといよいよ無職になるので勉強します。</p>\n<p>ちなみに、Tailwindとは<strong>追い風</strong>という意味だそうです。</p>\n<h3 id=\"電子ペーパー\" style=\"position:relative;\"><a href=\"#%E9%9B%BB%E5%AD%90%E3%83%9A%E3%83%BC%E3%83%91%E3%83%BC\" aria-label=\"電子ペーパー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>電子ペーパー</h3>\n<p>本当は<a href=\"https://m5stack.com/products/m5paper-esp32-development-kit-960x540-4-7-eink-display-235-ppi?variant=37595977908396\" target=\"_blank\" rel=\"noopener noreferrer\">M5Paper</a>とかやりたかったのですが、電子ペーパーでなにか作ろうと思ったときには<a href=\"https://www.switch-science.com/catalog/6749/\" target=\"_blank\" rel=\"noopener noreferrer\">スイッチサイエンス</a>で売り切れていたのでAmazonで買える電子ペーパーでお安かった<a href=\"https://amzn.to/3kZ97lz\" target=\"_blank\" rel=\"noopener noreferrer\">Waveshare 2.7inch E-Ink Screen Display HAT for Raspberry Pi</a>を購入することにしました。</p>\n<h2 id=\"やらないことにしようbox\" style=\"position:relative;\"><a href=\"#%E3%82%84%E3%82%89%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%81%AB%E3%81%97%E3%82%88%E3%81%86box\" aria-label=\"やらないことにしようbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>やらないことにしようBOX</h2>\n<p>色々選定時迷いましたが、一度にたくさんのことをやり過ぎるとやれなくて<strong>もやもやBOX</strong>に入ってしまうので元旦までに実装完了させるためにも、泣く泣くやらないことにしました。</p>\n<p><strong>いつかやるBOX</strong>だ。</p>\n<ul>\n<li>RustのWAF\n<ul>\n<li><del>MQTTのクライアントでRustで使えそうなものがぱっと見つからなかったため断念</del></li>\n<li>大嘘です。ありました。しかもpaho <a href=\"https://github.com/eclipse/paho.mqtt.rust\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/eclipse/paho.mqtt.rust</a></li>\n<li>BackendはPythonの<a href=\"https://fastapi.tiangolo.com/\" target=\"_blank\" rel=\"noopener noreferrer\">FastAPI</a>で実装します。</li>\n</ul>\n</li>\n<li><a href=\"https://docs.aws.amazon.com/iot/latest/developerguide/what-is-aws-iot.html\" target=\"_blank\" rel=\"noopener noreferrer\">AWS IoT</a>\n<ul>\n<li>本当は使いたかったが、<strong>金がない</strong>&#x26;MQTTブローカーを一から作ってみたかったため断念、いつかやることにしました。</li>\n</ul>\n</li>\n<li><a href=\"https://webassembly.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Wasm</a>\n<ul>\n<li>毎回少しやって挫けるので今回はスキップ。いつかやりたいきりたいですね。</li>\n</ul>\n</li>\n<li><a href=\"https://recoiljs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Recoil</a>\n<ul>\n<li><a href=\"https://qiita.com/masakinihirota/items/b16ca9a61b835d50c8ec\" target=\"_blank\" rel=\"noopener noreferrer\">流行っているのか怪しかった</a>からパス。ファーストペンギンはいつだって怖い。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"アーキテクチャー\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%83%BC\" aria-label=\"アーキテクチャー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アーキテクチャー</h2>\n<p>30秒くらい考えてこんな感じになりました。<strong>考えてもしょうがないBOX</strong>です。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/E3hyjnA.png\" alt=\"img\"></p>\n<p>フロントからAPIコールされるとバックエンドサーバーで<strong>画像生成</strong>し、<strong>ByteArray</strong>に変換後、<strong>MQTTブローカー</strong>に<strong>Publish</strong>をします。ByteArrayがMQTTのペイロードに設定できるのはHTTPと比べて魅力ですねー。</p>\n<p>MQTTブローカーでは受け取ったメッセージを同一TopicをSubscribeしている<strong>Subscriber</strong>に投げます。</p>\n<p>ここで<strong>MQTT over WebSocket</strong>などでTopicに流れるメッセージを待ち受けていれば、MQTT同様にSubscribeできます。</p>\n<p>Subscriberではメッセージを受け取るとon_messageイベントが発生するため、受け取ったByteArrayから画像を再生し、電子ペーパーの制御モジュールに渡します。</p>\n<h2 id=\"辛かったこと\" style=\"position:relative;\"><a href=\"#%E8%BE%9B%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\" aria-label=\"辛かったこと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>辛かったこと</h2>\n<h3 id=\"hooksわかんねぇ型チェックとおらねぇ\" style=\"position:relative;\"><a href=\"#hooks%E3%82%8F%E3%81%8B%E3%82%93%E3%81%AD%E3%81%87%E5%9E%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%A8%E3%81%8A%E3%82%89%E3%81%AD%E3%81%87\" aria-label=\"hooksわかんねぇ型チェックとおらねぇ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hooksわかんねぇ！型チェックとおらねぇ!!</h3>\n<p>これは考えてもしょうがないBOXなのかもしれませんが、<strong>React HooksでFileを使うの</strong>、難しくありません？たんに画像をBase64にしてaxiosでAPIコールしたいだけなのですが、</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> App<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">FC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>selectedFileName<span class=\"token punctuation\">,</span> setSelectedFileName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>とinitial stateをnullにすると、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">TS2345: Argument of type 'null' is not assignable to parameter of type 'File'.</code></pre></div>\n<p>という感じに、nullが許容できないですし、</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"file\"</span> accept<span class=\"token operator\">=</span><span class=\"token string\">\"image/jpeg\"</span>\n    className<span class=\"token operator\">=</span><span class=\"token string\">\"cursor-pointer relative block opacity-0 w-full h-full p-20 z-50\"</span>\n    onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setSelectedFile</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>肝心のinputのonChangeでset関数呼ぼうとすると、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">TS2345: Argument of type 'FileList | null' is not assignable to parameter of type 'SetStateAction&lt;File>'.   Type 'null' is not assignable to type 'SetStateAction&lt;File>'.</code></pre></div>\n<p>と言われてしまい、いざFileReaderで<strong>readAsDataURL</strong>しようとすると、</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">let</span> b64str<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> ArrayBuffer <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n        b64str <span class=\"token operator\">=</span>  e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>b64str<span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error: '</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">TS2531: Object is possibly 'null'.</code></pre></div>\n<p>という風にnull避けに苦戦しました。</p>\n<p>結局のところ、</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> App<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">FC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> initFile<span class=\"token operator\">:</span> File <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>selectedFile<span class=\"token punctuation\">,</span> setSelectedFile<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>initFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>という具合にinitial stateを空Fileオブジェクトにして、かついたるところに、</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n    b64str <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result <span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>b64str<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>という具合に三項演算子でガードする羽目になりました。クラスコンポーネントでももちろん考えないとなのですが、型厳密おじさんではないので、stateの段階で型で<strong>File | null</strong>みたいなこと平気でしてでnull許容にしてしまうマンなのでこれは痛かったですね。</p>\n<p>教えてReact博士！</p>\n<blockquote>\n<p>どうしたら、楽にHooksが使えますか？</p>\n</blockquote>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/zrdOCVi.png\" alt=\"img\"></p>\n<blockquote>\n<p>知らね。自分で考えろ</p>\n</blockquote>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/HnLNjda.png\" alt=\"img\"></p>\n<h3 id=\"tailwind結局つかいこなせない問題\" style=\"position:relative;\"><a href=\"#tailwind%E7%B5%90%E5%B1%80%E3%81%A4%E3%81%8B%E3%81%84%E3%81%93%E3%81%AA%E3%81%9B%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C\" aria-label=\"tailwind結局つかいこなせない問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tailwind結局つかいこなせない問題</h3>\n<p>Webデザインというか、そういった素養がなさすぎて、むしろ私にはMaterial UIの出来きったデザインのもと実装できるCSSフレームワークのほうが使いやすかったです。</p>\n<p>ほぼすべて、結局<a href=\"https://tailwindcomponents.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Tailwind Component</a>からコピってReact向けに直して、ちょっと修正して、で作ったのでUtility-Firstの恩恵なしで時間ばかりかかってしまいました。</p>\n<h2 id=\"思い通り進んだところ\" style=\"position:relative;\"><a href=\"#%E6%80%9D%E3%81%84%E9%80%9A%E3%82%8A%E9%80%B2%E3%82%93%E3%81%A0%E3%81%A8%E3%81%93%E3%82%8D\" aria-label=\"思い通り進んだところ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>思い通り進んだところ</h2>\n<h3 id=\"fastapi\" style=\"position:relative;\"><a href=\"#fastapi\" aria-label=\"fastapi permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FastAPI</h3>\n<p>FastAPIの実装はスムーズでした。</p>\n<p>APIを作るときもデコレーター一つで簡単実装です。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> FastAPI\n<span class=\"token keyword\">from</span> pydantic <span class=\"token keyword\">import</span> BaseModel\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span>BaseModel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    title<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    message<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    image<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span>\n\napp <span class=\"token operator\">=</span> FastAPI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/preview\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">preview</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">:</span> Message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    base64str <span class=\"token operator\">=</span> create_card_image_b64<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span>image<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">:</span> base64str<span class=\"token punctuation\">}</span></code></pre></div>\n<p>簡単なAPIを短時間で作らなければならないような<strong>ハッカソン</strong>や<strong>1dayスプリント</strong>なんかにはとてもいいのではないでしょうか？</p>\n<p>癖があるとしたらstaticsファイルのホスティングに使う<a href=\"https://fastapi.tiangolo.com/tutorial/static-files/\" target=\"_blank\" rel=\"noopener noreferrer\">StaticFiles</a>というモジュールを使うときになぜか、追加で<a href=\"https://pypi.org/project/aiofiles/\" target=\"_blank\" rel=\"noopener noreferrer\">aiofiles</a>というライブラリーが必要なことです。</p>\n<p>デフォルトでいれないんかい。</p>\n<p><del>とはいえ、しっかりエラーでModuleNotFoundエラーが出るのでそこまで困ることもないです。</del></p>\n<p>公式ドキュメントに、</p>\n<blockquote>\n<p>First you need to install aiofiles</p>\n</blockquote>\n<p>って書いてありました。すみません。</p>\n<h3 id=\"mqtt-1\" style=\"position:relative;\"><a href=\"#mqtt-1\" aria-label=\"mqtt 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MQTT</h3>\n<p>くっそ難しいのかな？と思いましたがpahoがいい感じにラップしていてくれるので、何のことはなかったです。</p>\n<h3 id=\"mosquitto\" style=\"position:relative;\"><a href=\"#mosquitto\" aria-label=\"mosquitto permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mosquitto</h3>\n<p>こちらもあっさりでした。</p>\n<p>Dockerを使ったからか、ほぼ公式通りの<a href=\"https://github.com/eclipse/mosquitto/blob/master/mosquitto.conf\" target=\"_blank\" rel=\"noopener noreferrer\">config</a>で通りました。</p>\n<h2 id=\"できあがったもの\" style=\"position:relative;\"><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\" aria-label=\"できあがったもの permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>できあがったもの</h2>\n<p>できあがったものの、ソースコードはこちらにあります。</p>\n<p><a href=\"https://github.com/tubone24/mqtt-nenga\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tubone24/mqtt-nenga</a></p>\n<p>一応<a href=\"https://aws.amazon.com/jp/eks/\" target=\"_blank\" rel=\"noopener noreferrer\">EKS</a>にのっけて公開しようかと悩みTerraformまで作ったのですが、誰もサービス使わないで年賀状が一通もこないのも悲しいので、Terraformの検証が終わったら壊しました。</p>\n<p>というかEKSに載っけるなら最初からAWS IoTにすればよかったですね。</p>\n<p>考えてもしょうがないBOXに入れておいて、自分のやるべきことをやるように考えていますね。</p>\n<h2 id=\"デモ\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%A2\" aria-label=\"デモ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デモ</h2>\n<p>環境構築方法は<a href=\"https://github.com/tubone24/mqtt-nenga/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">README</a>をご参照くださいませ。</p>\n<p>使い方としては、まずWebページに行きますと次のような入力フォームがあります。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/k4Ti9nI.png\" alt=\"img\"></p>\n<p><strong>名前</strong>、<strong>タイトル</strong>、<strong>メッセージ</strong>と<strong>画像</strong>を入力フォームに入れていきます。Previewボタンを押すと相手に送信する年賀状の<strong>プレビュー</strong>ができます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/lEjbh7L.png\" alt=\"img\"></p>\n<p>問題なければ、<strong>Submit</strong>します。</p>\n<p>相手がTopicをSubscribeしていれば、このように電子ペーパーに年賀状が描画されます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/LXEcbLD.gif\" alt=\"img\"></p>\n<h2 id=\"改めまして\" style=\"position:relative;\"><a href=\"#%E6%94%B9%E3%82%81%E3%81%BE%E3%81%97%E3%81%A6\" aria-label=\"改めまして permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>改めまして</h2>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/WJnsQlT.png\" alt=\"img\"></p>","words":4176,"minutes":11}},"staticQueryHashes":["1319877725","2959249232"]}