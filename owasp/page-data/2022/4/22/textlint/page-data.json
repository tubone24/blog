{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2022/4/22/textlint","result":{"data":{"content":{"edges":[{"node":{"id":"f22d4492-aa79-5987-9f69-c2b9d2a1516c","excerpt":"日本語って難しいですね。 Table of Contents textlint CIに乗せる 追加の改善 結論 textlint…","fields":{"slug":"2022/4/22/textlint"},"frontmatter":{"id":null,"title":"ブログのプレビューデプロイ時にtextlintを導入してみた","slug":"2022/4/22/textlint","date":"2022-04-21T16:30:53.413Z","headerImage":"https://i.imgur.com/ZRXcbaO.png","tags":["textlint","GithubActions"]}}}]}},"pageContext":{"id":"f22d4492-aa79-5987-9f69-c2b9d2a1516c","index":2,"repHtml":"<p>日本語って難しいですね。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#textlint\">textlint</a></li>\n<li><a href=\"#ci%E3%81%AB%E4%B9%97%E3%81%9B%E3%82%8B\">CIに乗せる</a></li>\n<li><a href=\"#%E8%BF%BD%E5%8A%A0%E3%81%AE%E6%94%B9%E5%96%84\">追加の改善</a></li>\n<li><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></li>\n</ul>\n</div>\n<h2 id=\"textlint\" style=\"position:relative;\"><a href=\"#textlint\" aria-label=\"textlint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>textlint</h2>\n<p>今までこのブログは日本語として伝わりにくい表現や表記揺れをあまり意識してなかったのですが、色々あってちゃんとした技術情報の発信のためには正しい日本語を使うことも大切なんだなと感じたこの頃です。</p>\n<p>ただ、私は日本語をいい加減に学んでしまっているため自分の書いた文章が正しいのかどうかわからないのである程度自動で校正してくれるツールを探したところtextlintというツールがあることを知りました。</p>\n<p>textlintとは、JavaScriptで書かれたオープンソースのテキスト改行ユーティリティで文章をあらかじめ定義したルールに基づいて校正してくれます。</p>\n<p>このブログはTypeScript製なのでnpmでtextlintを入れてしまえば良さそうです。</p>\n<p>SmartHRさんが<a href=\"https://shanaiho.smarthr.co.jp/n/n881866630eda\" target=\"_blank\" rel=\"noopener noreferrer\">プリセットを公開</a>していて、これがかなり便利なので基本的にばこちらを使っていきます。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>npm</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev textlint textlint-filter-rule-allowlist textlint-filter-rule-comments textlint-rule-aws-spellcheck textlint-rule-preset-smarthr textlint-rule-prh textlint-rule-terminology textlint-rule-no-hoso-kinshi-yogo textlint-rule-ja-no-inappropriate-words textlint-rule-no-mixed-zenkaku-and-hankaku-alphabet textlint-rule-no-start-duplicated-conjunction</code></pre></div>\n<p>textlintの設定は <strong>.textlintrc</strong>で設定します。</p>\n<p>次のような設定にしました。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>.textlintrc</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"preset-smarthr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"sentence-length\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"ja-no-mixed-period\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"periodMark\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"。\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"allowPeriodMarks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"、\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"↓\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"？\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"・\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"`\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"…\"</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"allowEmojiAtEnd\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prh\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"rulePaths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"dict/prh_tubone_blog.yml\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-start-duplicated-conjunction\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"interval\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-mixed-zenkaku-and-hankaku-alphabet\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-hoso-kinshi-yogo\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ja-no-inappropriate-words\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"terminology\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"defaultTerms\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"skip\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Blockquote\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@textlint-rule/no-duplicate-abbr\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"filters\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"comments\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"allowlist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"allowlistConfigPaths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./textlint-allow-list.yml\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>基本的にはtextlint-rule-preset-smarthrをベースに校正を実施します。</p>\n<p>ただし本ブログの構成上、<strong>文章途中</strong>→<strong>コード</strong>→<strong>文章文末まで</strong>という構成が多いため<strong>ja-no-mixed-period</strong>の<strong>allowPeriodMarks</strong>に「、」や「↓」を追加してます。</p>\n<p>また、可愛らしい表現を心がけるため<strong>allowEmojiAtEnd</strong>を許可にして💦のような絵文字で文末を締めくくることができるようにしてます。(よって<a href=\"https://github.com/lostandfound/textlint-rule-no-surrogate-pair\" target=\"_blank\" rel=\"noopener noreferrer\">サロゲートペアの未使用チェックのtextlint</a>は使用してません。クレームが来たら使用することにします。)</p>\n<p>そのほか細かいルールとしては、</p>\n<!-- textlint-disable -->\n<ul>\n<li>prhを使って表記揺れをチェックします。基本はSmartHRのプリセットで押さえてますが、独自の表記揺れをYAMLで定義し設定してます。</li>\n<li>no-start-duplicated-conjunctionを使って、接続語の連続をチェックします。「また〜また〜」みたいなやつです。</li>\n<li>no-mixed-zenkaku-and-hankaku-alphabetを使って全角のアルファベットを禁止にしてます。</li>\n<li>no-hoso-kinshi-yogoを使って放送禁止用語をチェックしてます。結構引っ掛かりますので、allowlistと組み合わせて使ってます。</li>\n<li>ja-no-inappropriate-wordsを使って不適切表現をチェックしてます。</li>\n<li>terminologyを使って技術用語の表記ミスを防いでます。(Node.jsと書くべきところをnode.jsと書いている、など。)</li>\n<li>@textlint-rule/no-duplicate-abbrを使って同じ意味の重複語をチェックしてます。頭痛が痛い、みたいなやつです。</li>\n</ul>\n<p>を使ってます。</p>\n<!-- textlint-enable -->\n<p>また、filterを利用していて、</p>\n<ul>\n<li>コメントでルールの無効化を許可。</li>\n<li>allowlistで（主に放送禁止用語の）許可をしてます。 <a href=\"https://github.com/tubone24/blog/blob/master/textlint-allow-list.yml\" target=\"_blank\" rel=\"noopener noreferrer\">許可リストはこちら、</a>品がないですね。</li>\n</ul>\n<p>npm scriptへ次のようなスクリプトを仕込んであげれば簡単に校正ができるようになります。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>package.json</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"textlint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npx textlint \\\"src/content/*.md\\\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"textlint:fix\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npx textlint --fix \\\"src/content/*.md\\\"\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h2 id=\"ciに乗せる\" style=\"position:relative;\"><a href=\"#ci%E3%81%AB%E4%B9%97%E3%81%9B%E3%82%8B\" aria-label=\"ciに乗せる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CIに乗せる</h2>\n<p>CIに乗せるときに便利なのがreviewdogです。</p>\n<p>ほぼ<a href=\"https://blog.chick-p.work/github-actions-reviewdog-textlint/\" target=\"_blank\" rel=\"noopener noreferrer\">こちらのブログ</a>を参考にパイプラインを作りました。ありがとうございます。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>previewDeploy.yml</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">textlint</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> textlint\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> reviewdog/action<span class=\"token punctuation\">-</span>setup@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">reviewdog_version</span><span class=\"token punctuation\">:</span> latest\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ~/.cache\n            ~/.npm\n            node_modules\n            .cache\n            public</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>build<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> env.cache<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/package-lock.json')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.os }}-build-${{ env.cache-version }}-${{ hashFiles('**/package-lock.json') }}\n            ${{ runner.os }}-build-\n            ${{ runner.os }}-</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install dependencies\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Execute textlint for article\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npx textlint <span class=\"token punctuation\">-</span>f checkstyle \"src/content/<span class=\"token important\">*.md\"</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> .textlint.log\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run reviewdog\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> failure()\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">REVIEWDOG_GITHUB_API_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cat .textlint.log | reviewdog -f=checkstyle -name=\"textlint\" -reporter=\"github-pr-review\"</span></code></pre></div>\n<p>これで、ブログ記事を書いてPRを出すことでPRコメントで校正を実施してくれるようになりました。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/ZRXcbaO.png\" alt=\"校正コメント\"></p>\n<h2 id=\"追加の改善\" style=\"position:relative;\"><a href=\"#%E8%BF%BD%E5%8A%A0%E3%81%AE%E6%94%B9%E5%96%84\" aria-label=\"追加の改善 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>追加の改善</h2>\n<p>GitHub Actionsでno-hoso-kinshi-yogoを使うと、辞書ファイルを提供している<a href=\"http://monoroch.net/kinshi/\" target=\"_blank\" rel=\"noopener noreferrer\">http://monoroch.net/kinshi/</a>へのアクセスが同一IPから集中するためか504 BadGatewayが出て正しく辞書ファイルを読み込むことができなくなってましたので<a href=\"https://github.com/tubone24/textlint-rule-no-hoso-kinshi-yogo\" target=\"_blank\" rel=\"noopener noreferrer\">forkして参照先URLを変更のうえ</a>利用してます。</p>\n<p>辞書ファイルをレポジトリ内に抱えてしまう実装なのでちょっと微妙な実装ですが、権利帰属をREADMEに明記したので良しとしました...🙏</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>textlintを使って良いブログライフを！</p>","words":1751,"minutes":5}},"staticQueryHashes":["1319877725","2959249232"]}