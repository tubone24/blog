{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2022/01/10/colorjs","result":{"data":{"content":{"edges":[{"node":{"id":"37024474-c984-54ec-a1d9-c478faca0863","excerpt":"Table of Contents びっくり。 colors.js 対処法 OSSのあり方とは colors.js @babel/coreのバージョンアップでCI…","fields":{"slug":"2022/01/10/colorjs"},"frontmatter":{"id":null,"title":"CI回してたら変な星条旗おじさんが出てきて動かなくなってしまったので直しつつOSSのあり方を考える","slug":"2022/01/10/colorjs","date":"2022-01-10T06:40:48.381Z","headerImage":"https://i.imgur.com/QjbL6ih.png","tags":["color.js","oss"]}}}]}},"pageContext":{"id":"37024474-c984-54ec-a1d9-c478faca0863","index":8,"repHtml":"<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<p>びっくり。</p>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#colorsjs\">colors.js</a></li>\n<li><a href=\"#%E5%AF%BE%E5%87%A6%E6%B3%95\">対処法</a></li>\n<li><a href=\"#oss%E3%81%AE%E3%81%82%E3%82%8A%E6%96%B9%E3%81%A8%E3%81%AF\">OSSのあり方とは</a></li>\n</ul>\n</div>\n<h2 id=\"colorsjs\" style=\"position:relative;\"><a href=\"#colorsjs\" aria-label=\"colorsjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>colors.js</h2>\n<p>@babel/coreのバージョンアップでCIを動かしていたところ謎のアスキーアート的なログが出たままヒープメモリを食いつぶして落ちてしまう事象が昨日の夜中に発生しました。</p>\n<p><a href=\"https://github.com/tubone24/portfolio/runs/4755929687?check_suite_focus=true\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tubone24/portfolio/runs/4755929687?check_suite_focus=true</a></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/QjbL6ih.png\" alt=\"img\"></p>\n<p>CIのジョブ的にはUIcheckのpercyを動かすところでクリティカルではなく、更新内容的にも急いで更新するような重要なアップデートではなかったので機能時点ではスルーしてましたが、今朝colors.jsの問題で本事象が発生することを下記の記事から気が付きました。</p>\n<p><a href=\"https://www.bleepingcomputer.com/news/security/dev-corrupts-npm-libs-colors-and-faker-breaking-thousands-of-apps/\" target=\"_blank\" rel=\"noopener noreferrer\">Dev corrupts npm libs 'colors' and 'faker' breaking thousands of apps</a></p>\n<p>記事を追っていくと実際のコミットも見つけることができ、作者が意図的に星条旗おじさん(名前は<a href=\"https://astrobiology.nasa.gov/nai/directory/pilcher-carl/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Carl Pilcher</a>ですかね...?ちょっとわからなかったです。)を表示させ、無限ループを発生させるようなコードを仕込んでいることがわかります。</p>\n<p><a href=\"https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified</a></p>\n<p>この汚染が仕込まれたのが <a href=\"mailto:colors@1.4.44-liberty-2\" target=\"_blank\" rel=\"noopener noreferrer\">colors@1.4.44-liberty-2</a>のバージョンであることから^1.4.0を利用していたライブラリはsemantic versioningでpatchアップデートにかかってしまったため、思いがけずアップデートされてしまったものと思われます。</p>\n<p>また、ローカルで動かしてみたものの同様に事象が発生してしまっております。すごいMacのファンが回ってしまって怖いです。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/d6EyJpJ.gif\" alt=\"img\"></p>\n<h2 id=\"対処法\" style=\"position:relative;\"><a href=\"#%E5%AF%BE%E5%87%A6%E6%B3%95\" aria-label=\"対処法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>対処法</h2>\n<p>取り急ぎpackage.jsonのresoltionsに安全な<a href=\"mailto:colors@1.4.0\" target=\"_blank\" rel=\"noopener noreferrer\">colors@1.4.0</a>を設定してを実施して事象の回復ができました。</p>\n<p><a href=\"https://github.com/tubone24/portfolio/pull/351/files\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tubone24/portfolio/pull/351/files</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  \"resolutions\": {\n    \"@graphql-codegen/visitor-plugin-common\": \"1.22.0\",\n    \"colors\": \"1.4.0\"\n  }</code></pre></div>\n<h2 id=\"ossのあり方とは\" style=\"position:relative;\"><a href=\"#oss%E3%81%AE%E3%81%82%E3%82%8A%E6%96%B9%E3%81%A8%E3%81%AF\" aria-label=\"ossのあり方とは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OSSのあり方とは</h2>\n<p>こればっかりは難しい問題なので今回結論を出すことはないですが、イチ開発者としては素敵なOSS活動を続けている皆さんを少しでもサポートしたい気持ちではいます。どんな形での貢献ができるかは不明ですが。</p>\n<p>原因のコミットには多くのコントリビューターから賛否両論のコメントが投稿されてました。</p>\n<blockquote>\n<p>oh man. whatever is going on. i will not judge, since iam a very average dev, the sense of this, nor your reasons. but: take a step back. have some holydays. this is clearly not going anywhere good. stay strong and healthy my dear. best regards from far europe.</p>\n<p>私はごく普通の開発者なので、その感覚や理由を判断することはできませんが、しかし、一歩下がって、休日を過ごしてください。これは明らかに良い方向には向かっていません。遠く離れたヨーロッパから、よろしくお願いします。</p>\n<p>引用 <a href=\"https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified#commitcomment-63144380\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified#commitcomment-63144380</a></p>\n</blockquote>\n<p>もちろん、開発者のMarak氏の言い分もわかりますしOSS活動を続けていくモチベーションが落ちるようなことはあってはならないとは思いつつも、彼が犯した行動がすべて容認されうるものではないこともまた事実です。</p>\n<p>なのでまず休んで。一息ついて考えて！というメッセージは痛いほどわかります。</p>\n<blockquote>\n<p>F500 companies that care about security already patched out all Marak's stuff months ago. He's been a malicious supply chain issue for a while.</p>\n<p>At this point the main people he's hurting are small folks who don't check their packages as much as big company appsec teams do.</p>\n<p>セキュリティに気を配るF500企業は、数ヶ月前にすでにマラクのものをすべてパッチで除去しています。彼はしばらくの間、悪意のあるサプライチェーンの問題だった。</p>\n<p>この時点で、彼が傷つけているのは、大企業のセキュリティチームほどには自分のパッケージをチェックしない、小さな人々なのです。</p>\n<p>引用 <a href=\"https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified#commitcomment-63196620\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/Marak/colors.js/commit/074a0f8ed0c31c35d13d28632bd8a049ff136fb6?diff=unified#commitcomment-63196620</a></p>\n</blockquote>\n<p>これもその通りだなぁと思います。誰も得しない...。とはいえ彼がもっとひどい不具合、たとえばOS自体を破壊しまくるものを仕込んでいたら。。被害は考えるだけでも恐ろしいですね。</p>\n<p>これからもOSSが発展するように自分にできることは何か模索していきたいと思います。</p>","words":2271,"minutes":6}},"staticQueryHashes":["1319877725","2959249232"]}