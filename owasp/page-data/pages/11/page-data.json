{"componentChunkName":"component---src-templates-index-tsx","path":"/pages/11","result":{"pageContext":{"totalCount":110,"group":[{"node":{"id":"e9543aa8-2b6e-5727-9bef-715820ddbbb4","html":"<p>ZabbixでElasticsearchのクラスタを監視したい、したくない？</p>\n<p>Elasticsearchのノードを先日1つ追加しましたので、ちょい傾向とかを確認しようと思いZabbixで監視できるテンプレートとかを作ってみました。</p>\n<p><a href=\"https://github.com/tubone24/Elastic_zab\" target=\"_blank\" rel=\"noopener noreferrer\">Elastic_zab</a></p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\">使い方</a></li>\n<li><a href=\"#zabbix%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">Zabbixにテンプレートをインストールする</a></li>\n<li><a href=\"#elasticsearch%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%BD%93%E3%81%A6%E3%82%8B\">Elasticsearchのノードにテンプレートを当てる</a></li>\n<li><a href=\"#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\">監視する</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-zabbix%E3%81%AE%E4%BA%88%E6%B8%AC%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\">おまけ Zabbixの予測関数を使ってみた</a></li>\n</ul>\n</div>\n<h2 id=\"使い方\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\" aria-label=\"使い方 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使い方</h2>\n<p>Elastic_zabに同梱しているelastic.shをZabbixサーバーのexternalscriptsディレクトリに配置します。実行権限もZabbixユーザーにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/tubone24/Elastic_zab\n\n$  cp -p Elastic_zab/elastic.sh /usr/lib/zabbix/externalscripts/\n\n$ chown zabbix. /usr/lib/zabbix/externalscripts/elastic.sh\n\n$ chmod 751 /usr/lib/zabbix/externalscripts/elastic.sh</code></pre></div>\n<h2 id=\"zabbixにテンプレートをインストールする\" style=\"position:relative;\"><a href=\"#zabbix%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"zabbixにテンプレートをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Zabbixにテンプレートをインストールする</h2>\n<p>Zabbix画面の設定のテンプレートから<a href=\"https://github.com/tubone24/Elastic_zab/blob/master/elasticsearch_zab.xml\" target=\"_blank\" rel=\"noopener noreferrer\">elasticsearch_zab.xml</a>をインポートします。</p>\n<p><img src=\"https://i.imgur.com/cTG62da.png\" alt=\"img\"></p>\n<p>うまくインストールできれば、テンプレート一覧にElastic clusterが出現します。</p>\n<p><img src=\"https://i.imgur.com/mzeLWwv.png\" alt=\"img\"></p>\n<h2 id=\"elasticsearchのノードにテンプレートを当てる\" style=\"position:relative;\"><a href=\"#elasticsearch%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%BD%93%E3%81%A6%E3%82%8B\" aria-label=\"elasticsearchのノードにテンプレートを当てる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elasticsearchのノードにテンプレートを当てる</h2>\n<p>Elasticsearchのノードにテンプレートを当てます。</p>\n<p><img src=\"https://i.imgur.com/zpTarcD.png\" alt=\"img\"></p>\n<p>合わせて、ElasticsearchのIPとポートをマクロで設定しておきます。</p>\n<p><img src=\"https://i.imgur.com/Vw5bbsA.png\" alt=\"img\"></p>\n<p>設定するマクロは以下の2つです。</p>\n<ul>\n<li><strong>{$ESIP}</strong> = ElasticsearchのIPもしくはDNSネームを設定します。</li>\n<li><strong>{$ESPORT}</strong> = Elasticsearchのポートを設定します。</li>\n</ul>\n<h2 id=\"監視する\" style=\"position:relative;\"><a href=\"#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\" aria-label=\"監視する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>監視する</h2>\n<p>うまく監視できるとこんなグラフができます。</p>\n<p><img src=\"https://i.imgur.com/tE9cC6Q.png\" alt=\"img\"></p>\n<h2 id=\"おまけ-zabbixの予測関数を使ってみた\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-zabbix%E3%81%AE%E4%BA%88%E6%B8%AC%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\" aria-label=\"おまけ zabbixの予測関数を使ってみた permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ Zabbixの予測関数を使ってみた</h2>\n<p>いくつかの監視アイテムはforecastやtimeleftといったZabbixの関数を利用しています。</p>\n<p>予測は線形としています。</p>\n<p>予測値はトリガー設定していないのでお好みでトリガーを設定するのもいいのではないでしょうか。</p>\n<p><img src=\"https://i.imgur.com/ylKkzK6.png\" alt=\"img\"></p>\n<p>こんな感じで計算アイテムで簡単に実装できるのが魅力ですね。</p>","fields":{"slug":"2017/7/23/elasticsearch-zabbix"},"frontmatter":{"tags":["Zabbix","Elasticsearch","forecast"],"templateKey":"blog-post","slug":"2017/7/23/elasticsearch-zabbix","id":null,"title":"Elasticsearchのクラスタ監視をZabbixでする","url":"2017/7/23/elasticsearch-zabbix","date":"2017-07-22T16:59:14.751Z","description":"Elasticsearchのクラスタ監視をZabbixでする(過去記事)","headerImage":"https://i.imgur.com/tE9cC6Q.png","year":"2017","month":"07"}}},{"node":{"id":"83721a31-04f1-5527-a1c4-0fdfc37b7f50","html":"<p>(過去ブログからの移転した記事です)</p>\n<p>くいなちゃんのかわいさで僕は満足です。</p>\n<p>どうも。ひなこのーと、よかったです。かわいかったです。でも、ひなこのーとを見ているとき、いろんな人からこんなことを言われました。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%A3%E3%81%A6%E3%82%A8%E3%83%AD%E3%81%84%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%98%E3%82%83%E3%81%AD\">ひなこのーとって、エロいごちうさじゃね？</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\">前提条件</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%97%E3%81%9F%E8%80%83%E5%AF%9F\">ちょっとした考察</a></p>\n<ul>\n<li><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8\">ひなこのーと</a></li>\n<li><a href=\"#%E3%81%94%E3%81%A1%E3%81%86%E3%81%95\">ごちうさ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82deep-learning%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\">「ひなこのーと」もDeep Learningやってみる</a></p>\n<ul>\n<li>\n<p><a href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\">下準備</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\">学習させる</a></p>\n<ul>\n<li><a href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\">モデル定義</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%AD%A6%E7%BF%92%E7%B5%90%E6%9E%9C\">学習結果</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%B8%BB%E8%A6%81%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AE%E5%88%86%E9%A1%9E%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B\">主要キャラの分類モデルを作成し、イラストを読み込ませて判定する</a></p>\n<ul>\n<li><a href=\"#%E5%AE%9F%E9%9A%9B%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%82%8B\">実際、読み込ませる</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A7%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AB%E5%88%86%E9%A1%9E%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\">できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する</a></p>\n<ul>\n<li><a href=\"#%E7%B5%B5%E3%81%AE%E3%82%BF%E3%83%83%E3%83%81%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\">絵のタッチを変えてみる</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%91%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%A7%E8%AA%8D%E8%AD%98%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\">おまけ１　ひなこのーともイラストで認識させてみる</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%92-%E3%81%8F%E3%81%84%E3%81%AA%E3%81%A1%E3%82%83%E3%82%93%E6%9F%90%E3%82%AA%E3%82%BF%E3%82%AF%E5%B0%91%E5%A5%B3%E3%81%AB%E4%BC%BC%E3%81%A6%E3%81%84%E3%82%8B%E8%AA%AC%E3%82%92%E7%A2%BA%E3%81%8B%E3%82%81%E3%82%8B\">おまけ２ くいなちゃん、某オタク少女に似ている説を確かめる。</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"ひなこのーとってエロいごちうさじゃね\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%A3%E3%81%A6%E3%82%A8%E3%83%AD%E3%81%84%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%98%E3%82%83%E3%81%AD\" aria-label=\"ひなこのーとってエロいごちうさじゃね permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ひなこのーとって、エロいごちうさじゃね？</h2>\n<p>はぁああああああん!?</p>\n<p>可愛いという共通点は認めるし、ごちうさは女神の生まれ変わりだと思っているが、ひなこのーとはごちうさとは違うすばらしさがある！ということで、Deep Learningを使って以下のことをやってみたいと思います。</p>\n<ol>\n<li>\n<p><a href=\"http://showyou.hatenablog.com/entry/2015/05/24/174621\" target=\"_blank\" rel=\"noopener noreferrer\">きんいろDeepLearning</a>や<a href=\"http://kivantium.hateblo.jp/entry/2015/02/20/214909\" target=\"_blank\" rel=\"noopener noreferrer\">ご注文はDeep Learningですか？</a>　など、可愛いアニメは必ずDeep Learningの餌食になると思うので、「ひなこのーと」もDeep Learningやってみる。</p>\n</li>\n<li>\n<p>アニメひなこのーとの可愛い動画を読み込ませて、主要キャラの分類モデルを作成し、イラストを読み込ませて判定する。</p>\n</li>\n<li>\n<p>できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する。</p>\n</li>\n</ol>\n<h2 id=\"前提条件\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\" aria-label=\"前提条件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前提条件</h2>\n<ul>\n<li>Python2.7(Anaconda3で仮想環境作成)</li>\n<li>Windows 7</li>\n<li>CPUオンリー</li>\n</ul>\n<h2 id=\"ちょっとした考察\" style=\"position:relative;\"><a href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%97%E3%81%9F%E8%80%83%E5%AF%9F\" aria-label=\"ちょっとした考察 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ちょっとした考察</h2>\n<p>本当にひなこのーとと、ごちうさは似ているのか、雰囲気だけではないか、よく考えて欲しい。</p>\n<h3 id=\"ひなこのーと\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8\" aria-label=\"ひなこのーと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ひなこのーと</h3>\n<p><img src=\"https://i.imgur.com/dIY5jEJ.jpg\" alt=\"img\"></p>\n<h3 id=\"ごちうさ\" style=\"position:relative;\"><a href=\"#%E3%81%94%E3%81%A1%E3%81%86%E3%81%95\" aria-label=\"ごちうさ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ごちうさ</h3>\n<p><img src=\"https://i.imgur.com/E6l9miS.jpg\" alt=\"img\"></p>\n<h2 id=\"ひなこのーともdeep-learningやってみる\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82deep-learning%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"ひなこのーともdeep learningやってみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>「ひなこのーと」もDeep Learningやってみる</h2>\n<h3 id=\"下準備\" style=\"position:relative;\"><a href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\" aria-label=\"下準備 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>下準備</h3>\n<p>Deep Learningの難しいところは、とにかく大量のトレーニングデータが必要になるところであります。</p>\n<p>途方に暮れていたところ、すばらしいスクリプトがあったので使わせていただきます。</p>\n<p><a href=\"https://torina.top/detail/331/\" target=\"_blank\" rel=\"noopener noreferrer\">Python、OpenCVで顔の検出（アニメ）\n</a></p>\n<p>こちらのスクリプトをそのまま使ってひなこのーとの1～12話から顔という顔を切り抜こう！</p>\n<p>その際、<a href=\"http://ultraist.hatenablog.com/entry/20110718/1310965532\" target=\"_blank\" rel=\"noopener noreferrer\">OpenCVによるアニメ顔検出ならlbpcascade_animeface.xml</a>のすばらしい設定ファイルを活用します。</p>\n<p>このXMLは後々使いますので、その際また。</p>\n<p>そして、切り抜いた顔をそれぞれのキャラごとにフォルダに移します。（手作業）</p>\n<p>こんな感じ。 50×50の可愛い画像がたくさん！</p>\n<p>データセットはそれぞれ</p>\n<ul>\n<li>ひなこ1164枚</li>\n<li>くいな678枚</li>\n<li>まゆき563枚</li>\n<li>ゆあ541枚</li>\n<li>ちあき536枚</li>\n<li>その他5493枚</li>\n</ul>\n<p>です。少ない。。。</p>\n<p><img src=\"https://i.imgur.com/qfwNwpQ.png\" alt=\"img\"></p>\n<h3 id=\"学習させる\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\" aria-label=\"学習させる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習させる</h3>\n<p>ご注文はDeep Learningですか？は、Caffeを使っていますが、自分はChainerの方がなじみあるので、Chainerを使っていきます。</p>\n<p>と言ってももうすでに化物語で同じことをやっていた人がいたので、モデル定義と学習、予測のコードをお借りしました。</p>\n<p><a href=\"https://www.mathgram.xyz/entry/chainer/bake/part5.5_1\" target=\"_blank\" rel=\"noopener noreferrer\">python: chainerを使って化物語キャラを認識させるよ！ 〜part5.5 主要キャラで多値分類(改良編)〜</a></p>\n<p>今回は、ひなこ・くいな・まゆき・ゆあ・ちあき・その他の計6つの分類になりますので、モデル定義などのパラメータのみ変更しています。</p>\n<h4 id=\"モデル定義\" style=\"position:relative;\"><a href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\" aria-label=\"モデル定義 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>モデル定義</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#coding:utf-8</span>\n\n<span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>links <span class=\"token keyword\">as</span> L\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">clf_hinako</span><span class=\"token punctuation\">(</span>chainer<span class=\"token punctuation\">.</span>Chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>clf_hinako<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span>\n            conv1 <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Convolution2D<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> pad<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            conv2 <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Convolution2D<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> pad<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            l3    <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">6272</span><span class=\"token punctuation\">,</span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            l4    <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#ここを6にしました</span>\n        <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>loss <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n        self<span class=\"token punctuation\">.</span>accuracy <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> X_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>clear<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        X_data <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>X_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token keyword\">not</span> train<span class=\"token punctuation\">)</span>\n        y_data <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token keyword\">not</span> train<span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv1<span class=\"token punctuation\">(</span>X_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv2<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>dropout<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l3<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span>train<span class=\"token punctuation\">)</span>\n        y <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>l4<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> F<span class=\"token punctuation\">.</span>softmax_cross_entropy<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> F<span class=\"token punctuation\">.</span>accuracy<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">)</span></code></pre></div>\n<p>モデル定義に合わせて分類の数を変更し、画像の枚数に合わせて学習用、テスト用画像の枚数などを調整しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#coding: utf-8</span>\n\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> six\n<span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>links <span class=\"token keyword\">as</span> L\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n<span class=\"token keyword\">from</span> clf_hinako_model <span class=\"token keyword\">import</span> clf_hinako\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">getDataSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_train <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nX_test <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ny_train <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ny_test <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\npath <span class=\"token operator\">=</span> “dataset<span class=\"token operator\">/</span>”\n<span class=\"token keyword\">if</span> i <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">5493</span> <span class=\"token comment\"># その他の画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">5393</span> <span class=\"token comment\"># 内100枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">1164</span> <span class=\"token comment\"># ひなこの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">1139</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">678</span> <span class=\"token comment\"># くいなの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">653</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">563</span> <span class=\"token comment\"># まゆきの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">538</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">541</span> <span class=\"token comment\"># ゆあの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">516</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">536</span> <span class=\"token comment\"># ちあきの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">511</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\nimgList <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nimgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>imgList<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>cutNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\nimgSrc <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>path<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>”<span class=\"token operator\">/</span>”<span class=\"token operator\">+</span>imgList<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> imgSrc <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">continue</span>\n<span class=\"token keyword\">if</span> j <span class=\"token operator\">&lt;</span> cutNum2<span class=\"token punctuation\">:</span>\nX_train<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>imgSrc<span class=\"token punctuation\">)</span>\ny_train<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\nX_test<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>imgSrc<span class=\"token punctuation\">)</span>\ny_test<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">return</span> X_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">,</span>X_test<span class=\"token punctuation\">,</span>y_test\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">train</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">,</span>X_test<span class=\"token punctuation\">,</span>y_test <span class=\"token operator\">=</span> getDataSet<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nX_train <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\ny_train <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>int32<span class=\"token punctuation\">)</span>\nX_test <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\ny_test <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>int32<span class=\"token punctuation\">)</span>\n\nmodel <span class=\"token operator\">=</span> clf_hinako<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer <span class=\"token operator\">=</span> optimizers<span class=\"token punctuation\">.</span>Adam<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer<span class=\"token punctuation\">.</span>setup<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span>\n\nepochNum <span class=\"token operator\">=</span> <span class=\"token number\">30</span>\nbatchNum <span class=\"token operator\">=</span> <span class=\"token number\">50</span>\nepoch <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">while</span> epoch <span class=\"token operator\">&lt;=</span> epochNum<span class=\"token punctuation\">:</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>“epoch<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>”<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>epoch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ntrainImgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">)</span>\ntestImgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">)</span>\n\nsumAcr <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nsumLoss <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\nperm <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>permutation<span class=\"token punctuation\">(</span>trainImgNum<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> six<span class=\"token punctuation\">.</span>moves<span class=\"token punctuation\">.</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> trainImgNum<span class=\"token punctuation\">,</span> batchNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_batch <span class=\"token operator\">=</span> X_train<span class=\"token punctuation\">[</span>perm<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\ny_batch <span class=\"token operator\">=</span> y_train<span class=\"token punctuation\">[</span>perm<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\noptimizer<span class=\"token punctuation\">.</span>zero_grads<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nloss<span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>X_batch<span class=\"token punctuation\">,</span> y_batch<span class=\"token punctuation\">)</span>\nloss<span class=\"token punctuation\">.</span>backward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nsumLoss <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\nsumAcr <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>‘train mean loss<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> accuracy<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>’<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>sumLoss <span class=\"token operator\">/</span> trainImgNum<span class=\"token punctuation\">,</span> sumAcr <span class=\"token operator\">/</span> trainImgNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nsumAcr <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nsumLoss <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> six<span class=\"token punctuation\">.</span>moves<span class=\"token punctuation\">.</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> testImgNum<span class=\"token punctuation\">,</span> batchNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\nX_batch <span class=\"token operator\">=</span> X_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span>\ny_batch <span class=\"token operator\">=</span> y_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span>\nloss<span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>X_batch<span class=\"token punctuation\">,</span> y_batch<span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\nsumLoss <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\nsumAcr <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>‘test mean loss<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> accuracy<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>’<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\nsumLoss <span class=\"token operator\">/</span> testImgNum<span class=\"token punctuation\">,</span> sumAcr <span class=\"token operator\">/</span> testImgNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nepoch <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\nS<span class=\"token punctuation\">.</span>save_hdf5<span class=\"token punctuation\">(</span>‘model’<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>epoch<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"学習結果\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E7%B5%90%E6%9E%9C\" aria-label=\"学習結果 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習結果</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>py27con<span class=\"token punctuation\">)</span> C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>tubone<span class=\"token punctuation\">\\</span>PycharmProjects<span class=\"token punctuation\">\\</span>anime-learn<span class=\"token operator\">></span>python train.py\nepoch: <span class=\"token number\">1</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:40:03.060000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">1.16183573621</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.619771432281</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">1.05560781558</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.506666666104</span>\nepoch: <span class=\"token number\">2</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:42:13.192000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.800489272901</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.69348571573</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.871727473206</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.577777779765</span>\nepoch: <span class=\"token number\">3</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:44:23.290000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.698785139833</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.743085714408</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.780110951927</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.631111116873</span>\nepoch: <span class=\"token number\">4</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:46:33.502000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.597107084649</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.786971424307</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.548737568988</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.83111111323</span>\nepoch: <span class=\"token number\">5</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:48:44.037000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.500077148761</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.82479999406</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.480820135938</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.857777780957</span>\nepoch: <span class=\"token number\">6</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:50:57.706000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.451180534618</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.841257137571</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.448005066978</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87555554178</span>\nepoch: <span class=\"token number\">7</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:53:09.992000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.405994535514</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.861028568063</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.472903796368</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.835555553436</span>\nepoch: <span class=\"token number\">8</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:55:22.262000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.358310819779</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87851428066</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.306394663122</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.911111103164</span>\nepoch: <span class=\"token number\">9</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:57:34.985000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.337241342791</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.880799995831</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.308397501707</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.902222216129</span>\nepoch: <span class=\"token number\">10</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:59:47.595000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.324274266022</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.886742852415</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.323723706934</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.871111101574</span>\nepoch: <span class=\"token number\">11</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:01:59.865000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.296059874466</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.897142853737</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.390861597326</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.848888880677</span>\nepoch: <span class=\"token number\">12</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:04:12.384000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.28229231613</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.900799994469</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.381249505613</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.888888888889</span>\nepoch: <span class=\"token number\">13</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:06:25.189000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.242525527115</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.915771426473</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.304150695602</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666656335</span>\nepoch: <span class=\"token number\">14</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:08:37.995000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.231497560718</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919314283303</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.275258473224</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666662958</span>\nepoch: <span class=\"token number\">15</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:10:50.532000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.219778511652</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.923199997629</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.354618171851</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.91555554337</span>\nepoch: <span class=\"token number\">16</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:13:02.623000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.218345963359</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.926285712378</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.36049440172</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.897777775923</span>\nepoch: <span class=\"token number\">17</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:15:15.105000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.199432469181</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.933599996226</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.403067363633</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87555554178</span>\nepoch: <span class=\"token number\">18</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:17:27.614000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.188562800608</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.936114283289</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.316384883391</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.911111109787</span>\nepoch: <span class=\"token number\">19</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:19:40.506000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.187215176012</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.933028570243</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.360161377324</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666676203</span>\nepoch: <span class=\"token number\">20</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:21:53.107000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.165474589265</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.94388571058</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.282101011939</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">21</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:24:05.521000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.153822022751</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.947999996117</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.33798650321</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">22</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:26:18.048000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.140677581344</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.952228568281</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.309250995517</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.924444450272</span>\nepoch: <span class=\"token number\">23</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:28:30.608000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.138967069973</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.951314284801</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.488151417838</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.871111101574</span>\nepoch: <span class=\"token number\">24</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:30:43.540000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.150780805051</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.945828568935</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.305154048734</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.924444450272</span>\nepoch: <span class=\"token number\">25</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:32:55.811000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.133075305953</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.952799998692</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.421937998798</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666662958</span>\nepoch: <span class=\"token number\">26</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:35:08.076000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.119467954348</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.954514285156</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.384507967366</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.902222222752</span>\nepoch: <span class=\"token number\">27</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:37:20.527000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.138162662153</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.949028568949</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.317712697718</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.928888883856</span>\nepoch: <span class=\"token number\">28</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:39:32.964000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.114523774907</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.961485714912</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.39709764719</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">29</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:41:45.211000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.120365411943</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.958171426228</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.379737239745</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.93333334393</span>\nepoch: <span class=\"token number\">30</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:43:57.336000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.110197391031</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.958742856298</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.401306927204</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.920000010067</span></code></pre></div>\n<p>計32エポックで学習終了です。</p>\n<h2 id=\"主要キャラの分類モデルを作成しイラストを読み込ませて判定する\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E8%A6%81%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AE%E5%88%86%E9%A1%9E%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B\" aria-label=\"主要キャラの分類モデルを作成しイラストを読み込ませて判定する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主要キャラの分類モデルを作成し、イラストを読み込ませて判定する</h2>\n<p>予測用のコードも以下からお借りしています。</p>\n<p><a href=\"https://www.mathgram.xyz/entry/chainer/bake/part5.5_1\" target=\"_blank\" rel=\"noopener noreferrer\">python: chainerを使って化物語キャラを認識させるよ！ 〜part5.5 主要キャラで多値分類(改良編)〜</a></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token keyword\">import</span> sys\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> six\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> os\n\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> computational_graph <span class=\"token keyword\">as</span> c\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n\n<span class=\"token keyword\">from</span> clf_hinako_model <span class=\"token keyword\">import</span> clf_hinako\n\n\nmodel <span class=\"token operator\">=</span> clf_hinako<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nS<span class=\"token punctuation\">.</span>load_hdf5<span class=\"token punctuation\">(</span><span class=\"token string\">'./model32'</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 32モデルだったので。</span>\n<span class=\"token comment\">#model = pickle.load(open('model30','rb'))</span>\n\nchara_name <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hinako\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Kuina\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Mayuki\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Yua\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Chiaki\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    x <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>conv1<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>conv2<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>dropout<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>l3<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    y <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>l4<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> y\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">detect</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cascade_file <span class=\"token operator\">=</span> <span class=\"token string\">\"./lbpcascade_animeface.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># アニメ顔抽出時使ったXMLを指定</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isfile<span class=\"token punctuation\">(</span>cascade_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> RuntimeError<span class=\"token punctuation\">(</span><span class=\"token string\">\"%s: not found\"</span> <span class=\"token operator\">%</span> cascade_file<span class=\"token punctuation\">)</span>\n\n    cascade <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>CascadeClassifier<span class=\"token punctuation\">(</span>cascade_file<span class=\"token punctuation\">)</span>\n    gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n    gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>equalizeHist<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">)</span>\n\n    faces <span class=\"token operator\">=</span> cascade<span class=\"token punctuation\">.</span>detectMultiScale<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span>\n                                     scaleFactor <span class=\"token operator\">=</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span>\n                                     minNeighbors <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                                     minSize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>faces<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> faces\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognition</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    face_images <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> faces<span class=\"token punctuation\">:</span>\n        dst <span class=\"token operator\">=</span> image<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">]</span>\n        dst <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>dst<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        face_images<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>dst<span class=\"token punctuation\">)</span>\n\n    face_images <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\n\n    <span class=\"token comment\">#face_images = cuda.to_gpu(face_images)</span>\n\n    <span class=\"token keyword\">return</span> forward<span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span> image\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">draw_result</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> faces<span class=\"token punctuation\">:</span>\n        classNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        result_data <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span>\n        classNum <span class=\"token operator\">=</span> result_data<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        recognized_class <span class=\"token operator\">=</span> chara_name<span class=\"token punctuation\">[</span>result_data<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        font <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_TRIPLEX <span class=\"token comment\"># 名前を入れたいので、OpenCVのFont機能を使います。</span>\n        font_size <span class=\"token operator\">=</span> <span class=\"token number\">1.1</span>\n        <span class=\"token keyword\">if</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 重ねたい画像を選択し、フォントサイズ等を指定</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        count<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n\n    <span class=\"token keyword\">return</span> image\n\n<span class=\"token comment\">#ファイル読み込み</span>\nimg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">\"test.jpg\"</span><span class=\"token punctuation\">)</span>\n\nfaces <span class=\"token operator\">=</span> detect<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span>\n\nresult<span class=\"token punctuation\">,</span> image <span class=\"token operator\">=</span> recognition<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">)</span>\n\nimage <span class=\"token operator\">=</span> draw_result<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span><span class=\"token string\">'out.png'</span><span class=\"token punctuation\">,</span>image<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"実際読み込ませる\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E9%9A%9B%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%82%8B\" aria-label=\"実際読み込ませる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実際、読み込ませる</h3>\n<p>実際読み込ませてみたものがこちら。</p>\n<ul>\n<li>水色はUnknown</li>\n<li>赤がひなこ</li>\n<li>青がくいな</li>\n<li>白がまゆき</li>\n<li>紫がゆあ</li>\n<li>オレンジがちあき</li>\n</ul>\n<p>です。</p>\n<p><img src=\"https://i.imgur.com/1tudTrI.png\" alt=\"img\"></p>\n<p>大家さんだけがUnknownとなってしまいました。。。</p>\n<p>データ量が少なかったためでしょうね。</p>\n<h2 id=\"できあがったモデルでごちうさの画像を読み込ませてひなこのーとのキャラに分類されないことを確認する\" style=\"position:relative;\"><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A7%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AB%E5%88%86%E9%A1%9E%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\" aria-label=\"できあがったモデルでごちうさの画像を読み込ませてひなこのーとのキャラに分類されないことを確認する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する</h2>\n<p>いよいよオーラスです。これをやるためにつくったモデルです。</p>\n<p>さっそく読み込ませて見ます。</p>\n<p><img src=\"https://i.imgur.com/N909ILj.png\" alt=\"img\"></p>\n<p>むむっ。ココアさんがひなこに、シャロちゃんがまゆちゃんと認識されているではないか。</p>\n<p>ココアさんとひなこ、なんか似ているように感じなくもなくもない????？</p>\n<p>フルール・ド・ラパンの制服と、まゆちゃんの私服が似ているというのはあるが、髪色で判断しているわけではないよな??</p>\n<p>金髪で判断しているという可能性がぬぐいきれないので。これでもくらえ！きんモザ＆ごちうさのコラボじゃあああ。</p>\n<p><img src=\"https://i.imgur.com/mWRGXtm.png\" alt=\"img\"></p>\n<p><img src=\"https://i.imgur.com/KLiwNQR.png\" alt=\"img\"></p>\n<p>金髪で判断しているというわけではなかった。</p>\n<p>それにしてもココアさん＝ひなこは覆らないな。</p>\n<h3 id=\"絵のタッチを変えてみる\" style=\"position:relative;\"><a href=\"#%E7%B5%B5%E3%81%AE%E3%82%BF%E3%83%83%E3%83%81%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"絵のタッチを変えてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>絵のタッチを変えてみる</h3>\n<p>こうなったら徹底討論じゃあ。絵のタッチを変えてどうなるか試してみましょう。</p>\n<p><img src=\"https://i.imgur.com/GwUtdtM.png\" alt=\"img\"></p>\n<p><span style=\"font-size: 200%\">ココア、お前だったのか!!（結論）</span></p>\n<h3 id=\"おまけ１ひなこのーともイラストで認識させてみる\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%91%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%A7%E8%AA%8D%E8%AD%98%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"おまけ１ひなこのーともイラストで認識させてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ１　ひなこのーともイラストで認識させてみる</h3>\n<p><img src=\"https://i.imgur.com/85nBHnf.png\" alt=\"img\"></p>\n<p><img src=\"https://i.imgur.com/YQrn166.png\" alt=\"img\"></p>\n<p>どうやら、くいなちゃんの認識率が一番いい。くいなちゃんかわいいからね。</p>\n<h3 id=\"おまけ２-くいなちゃん某オタク少女に似ている説を確かめる\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%92-%E3%81%8F%E3%81%84%E3%81%AA%E3%81%A1%E3%82%83%E3%82%93%E6%9F%90%E3%82%AA%E3%82%BF%E3%82%AF%E5%B0%91%E5%A5%B3%E3%81%AB%E4%BC%BC%E3%81%A6%E3%81%84%E3%82%8B%E8%AA%AC%E3%82%92%E7%A2%BA%E3%81%8B%E3%82%81%E3%82%8B\" aria-label=\"おまけ２ くいなちゃん某オタク少女に似ている説を確かめる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ２ くいなちゃん、某オタク少女に似ている説を確かめる。</h3>\n<p><img src=\"https://i.imgur.com/DCkFvv2.png\" alt=\"img\"></p>\n<p>大丈夫でした!!!</p>","fields":{"slug":"2017/07/17/hinako-chainer"},"frontmatter":{"tags":["Python","Chainer","ひなこのーと","Deep Learing","OpenCV","機械学習","CNN","分類学習","顔認識"],"templateKey":"blog-post","slug":"2017/07/17/hinako-chainer","id":null,"title":"大きく吸ってせーの！ で・ぃ・ぷ・ら・ん・に・ん・ぐ！　～ひなこのーと×Deep Learning～","url":"2017/07/17/hinako-chainer","date":"2017-07-17T07:58:03.868Z","description":"ひなこのーと×Deep Learningで天下を取りたい","headerImage":"https://i.imgur.com/1tudTrI.png","year":"2017","month":"07"}}},{"node":{"id":"70e9cd18-f719-530e-a041-85aebca9cbdb","html":"<p><strong>機械学習で彼女を作ろうとかふまじめなことはやめよう！</strong></p>\n<p>どうも。最近暑くてどうにもやる気がでませんが、そんなとき、めんどくさいことを機械がやってくれればなと思うわけです。</p>\n<p>最近（とは言ってもだいぶ成熟した分野ですが）流行の機械学習を勉強することによって、明るい未来を作ろうということを考えるわけです。</p>\n<p><a href=\"https://blog.tubone-project24.xyz/2017/06/04/chainer-chieri-bot\" target=\"_blank\" rel=\"noopener noreferrer\">前回</a>はおしゃべり彼女を作りましたので、今回はまじめにセキュリティ系のネタをやっていこうかと思います。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%82%88%E3%81%86\">データセットを用意しよう</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%9F%E3%81%BE%E3%81%AB%E3%81%AFr%E8%A8%80%E8%AA%9E%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\">たまにはR言語を使ってみよう</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%88%86%E9%A1%9E%E3%81%AB%E3%81%AF%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%83%99%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%9E%E3%82%B7%E3%83%B3svm\">分類にはサポートベクターマシン（SVM）</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9Fc-svm\">実際にやってみた(C-SVM)</a></p>\n<ul>\n<li><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80\">データを読み込む</a></li>\n<li><a href=\"#svm%E3%81%A7%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\">SVMで学習させる</a></li>\n<li><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\">評価する</a></li>\n<li><a href=\"#%E8%A1%A8%E3%81%A7%E3%81%BE%E3%81%A8%E3%82%81%E3%81%BE%E3%81%99\">表でまとめます</a></li>\n<li><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9Fc-svm%E3%81%A7%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%90%E3%83%AA%E3%83%87%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\">実際にやってみた(C-SVMでクロスバリデーション)</a></li>\n<li><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8Bc-svm-closs3\">学習させる(C-SVM closs=3)</a></li>\n<li><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B-1\">評価する</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%83%8B%E3%83%A5%E3%83%BC%E3%83%A9%E3%83%AB%E3%83%8D%E3%83%83%E3%83%88%E3%81%A7%E3%82%82%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%99nnet\">ニューラルネットでもやってみます(nnet)</a></p>\n<ul>\n<li><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8Bnnnet\">学習させる(nnnet)</a></li>\n<li><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B-2\">評価する</a></li>\n<li><a href=\"#%E8%A1%A8%E3%81%A7%E3%81%BE%E3%81%A8%E3%82%81%E3%81%BE%E3%81%99-1\">表でまとめます</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E9%87%8D%E3%81%BF%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\">おまけ それぞれのノードの重みを確認する</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></p>\n<ul>\n<li><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\">参考文献</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"データセットを用意しよう\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%82%88%E3%81%86\" aria-label=\"データセットを用意しよう permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>データセットを用意しよう</h2>\n<p>データセットは以下のものを使います。</p>\n<p><a href=\"http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html\" target=\"_blank\" rel=\"noopener noreferrer\">KDD Cup 1999 Data</a></p>\n<p>国際会議SIGKDDの1999年のデータマイニングコンペデータだそうで、そのときの侵入検知データはセキュリティ界隈ではかなり有名だそうです。私は最近まで知りませんでした。恥ずかしい。</p>\n<p>このデータはかなり膨大なので、今回はフルデータを10%抽出したkddcup.data_10_percentをさらに学習データと評価データにわけて実験します。</p>\n<p>今回は通常の通信と、いくつかの攻撃手法とを分類します。</p>\n<h2 id=\"たまにはr言語を使ってみよう\" style=\"position:relative;\"><a href=\"#%E3%81%9F%E3%81%BE%E3%81%AB%E3%81%AFr%E8%A8%80%E8%AA%9E%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\" aria-label=\"たまにはr言語を使ってみよう permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>たまにはR言語を使ってみよう</h2>\n<p>R言語と聞くとじんま疹が出る生物系の学生も多いと思いますが、きちんとPythonとかでプログラミングするよりは簡単だと思います。無料だし。まぁSPSSとかの方がずっと簡単ですが。</p>\n<h2 id=\"分類にはサポートベクターマシンsvm\" style=\"position:relative;\"><a href=\"#%E5%88%86%E9%A1%9E%E3%81%AB%E3%81%AF%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%83%99%E3%82%AF%E3%82%BF%E3%83%BC%E3%83%9E%E3%82%B7%E3%83%B3svm\" aria-label=\"分類にはサポートベクターマシンsvm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>分類にはサポートベクターマシン（SVM）</h2>\n<p>機械学習のパターン認識（分類）にはサポートベクターマシン(SVM)がいいと言われています。SVM自体は比較的古い手法ですが、汎化性能を高める工夫がしっかりしている点で非常に未学習データの認識が優れていると言われています。</p>\n<p>R言語ではKernlabというパッケージにSVMがあります。</p>\n<h2 id=\"実際にやってみたc-svm\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9Fc-svm\" aria-label=\"実際にやってみたc svm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実際にやってみた(C-SVM)</h2>\n<h3 id=\"データを読み込む\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80\" aria-label=\"データを読み込む permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>データを読み込む</h3>\n<p>CSV形式のデータですのでReadCSVで読み込み、データ型を再定義した後、攻撃手法をざっくりとした分類に分けます。</p>\n<p>最後のカラムのLabelが攻撃手法を定義したものですが、量が多いので、<a href=\"http://archive.ics.uci.edu/ml/databases/kddcup99/task.html\" target=\"_blank\" rel=\"noopener noreferrer\">ここ</a>を参考に4つの攻撃手法に分けておきます。5クラス分類問題となります。</p>\n<ul>\n<li>DOS</li>\n<li>R2L(リモートからの不正ログイン試み)</li>\n<li>U2R(Root権限奪取)</li>\n<li>Probe(調査)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># CSVとして読み込み\n\n> kddcup &lt;- read_csv(\"~/Downloads/kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent\", header=F)\n\n# ヘッダーをつける\n\n> colnames(kddcup)&lt;-c(\"duration\",\"protocol_type\",\"service\",\"flag\",\"src_bytes\",\"dst_bytes\",\"land\",\"wrong_fragment\",\"urgent\",\"hot\",\"num_failed_logins\",\"logged_in\",\"num_compromised\",\"root_shell\",\"su_attempted\",\"num_root\",\"num_file_creations\",\"num_shells\",\"num_access_files\",\"num_outbound_cmds\",\"is_host_login\",\"is_guest_login\",\"count\",\"srv_count\",\"serror_rate\",\"srv_serror_rate\",\"rerror_rate\",\"srv_rerror_rate\",\"same_srv_rate\",\"diff_srv_rate\",\"srv_diff_host_rate\",\"dst_host_count\",\"dst_host_srv_count\",\"dst_host_same_srv_rate\",\"dst_host_diff_srv_rate\",\"dst_host_same_src_port_rate\",\"dst_host_srv_diff_host_rate\",\"dst_host_serror_rate\",\"dst_host_srv_serror_rate\",\"dst_host_rerror_rate\",\"dst_host_srv_rerror_rate\",\"label\")\n\n# データを整える\n\n> kddcup$duration = as.numeric(as.character(kddcup$duration))\n> kddcup$protocol_type = factor(kddcup$protocol_type)\n> kddcup$service = factor(kddcup$service)\n> kddcup$flag = factor(kddcup$flag)\n> kddcup$src_bytes = as.numeric(as.character(kddcup$src_bytes))\n> kddcup$dst_bytes = as.numeric(as.character(kddcup$dst_bytes))\n> kddcup$land = factor(kddcup$land)\n> kddcup$wrong_fragment = as.numeric(as.character(kddcup$wrong_fragment))\n> kddcup$urgent = as.numeric(as.character(kddcup$urgent))\n> kddcup$hot = as.numeric(as.character(kddcup$hot))\n> kddcup$num_failed_logins = as.numeric(as.character(kddcup$num_failed_logins))\n> kddcup$logged_in = factor(kddcup$logged_in)\n> kddcup$num_compromised = as.numeric(as.character(kddcup$num_compromised))\n> kddcup$root_shell = factor(kddcup$root_shell)\n> kddcup$su_attempted = factor(kddcup$su_attempted)\n> kddcup$num_root = as.numeric(as.character(kddcup$num_root))\n> kddcup$num_file_creations = as.numeric(as.character(kddcup$num_file_creations))\n> kddcup$num_shells = as.numeric(as.character(kddcup$num_shells))\n> kddcup$num_access_files = as.numeric(as.character(kddcup$num_access_files))\n> kddcup$is_guest_login = factor(kddcup$is_guest_login)\n> kddcup$count = as.numeric(as.character(kddcup$count))\n> kddcup$srv_count = as.numeric(as.character(kddcup$srv_count))\n> kddcup$serror_rate = as.numeric(as.character(kddcup$serror_rate))\n> kddcup$srv_serror_rate = as.numeric(as.character(kddcup$srv_serror_rate))\n> kddcup$rerror_rate = as.numeric(as.character(kddcup$rerror_rate))\n> kddcup$srv_rerror_rate = as.numeric(as.character(kddcup$srv_rerror_rate))\n> kddcup$same_srv_rate = as.numeric(as.character(kddcup$same_srv_rate))\n> kddcup$diff_srv_rate = as.numeric(as.character(kddcup$diff_srv_rate))\n> kddcup$srv_diff_host_rate = as.numeric(as.character(kddcup$srv_diff_host_rate))\n> kddcup$dst_host_count = as.numeric(as.character(kddcup$dst_host_count))\n> kddcup$dst_host_srv_count = as.numeric(as.character(kddcup$dst_host_srv_count))\n> kddcup$dst_host_same_srv_rate = as.numeric(as.character(kddcup$dst_host_same_srv_rate))\n> kddcup$dst_host_diff_srv_rate = as.numeric(as.character(kddcup$dst_host_diff_srv_rate))\n> kddcup$dst_host_same_src_port_rate = as.numeric(as.character(kddcup$dst_host_same_src_port_rate))\n> kddcup$dst_host_srv_diff_host_rate = as.numeric(as.character(kddcup$dst_host_srv_diff_host_rate))\n> kddcup$dst_host_serror_rate = as.numeric(as.character(kddcup$dst_host_serror_rate))\n> kddcup$dst_host_srv_serror_rate = as.numeric(as.character(kddcup$dst_host_srv_serror_rate))\n> kddcup$dst_host_rerror_rate = as.numeric(as.character(kddcup$dst_host_rerror_rate))\n> kddcup$dst_host_srv_rerror_rate = as.numeric(as.character(kddcup$dst_host_srv_rerror_rate))\n> kddcup$label = as.character(kddcup$label)\n\n# 攻撃手法をまとめる\n\n> kddcup$label[kddcup$label == \"ipsweep.\"] = \"probe\"\n> kddcup$label[kddcup$label == \"portsweep.\"] = \"probe\"\n> kddcup$label[kddcup$label == \"nmap.\"] = \"probe\"\n> kddcup$label[kddcup$label == \"satan.\"] = \"probe\"\n> kddcup$label[kddcup$label == \"buffer_overflow.\"] = \"u2r\"\n> kddcup$label[kddcup$label == \"loadmodule.\"] = \"u2r\"\n> kddcup$label[kddcup$label == \"perl.\"] = \"u2r\"\n> kddcup$label[kddcup$label == \"rootkit.\"] = \"u2r\"\n> kddcup$label[kddcup$label == \"back.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"land.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"neptune.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"pod.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"smurf.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"teardrop.\"] = \"dos\"\n> kddcup$label[kddcup$label == \"ftp_write.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"guess_passwd.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"imap.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"multihop.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"phf.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"spy.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"warezclient.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"warezmaster.\"] = \"r2l\"\n> kddcup$label[kddcup$label == \"normal.\"] = \"normal\"\n> kddcup$label = as.factor(kddcup$label)\n\n# 学習データと評価データを分ける(7:3)\n\n> rowdata&lt;-nrow(kddcup)\n> random_ids&lt;-sample(rowdata,rowdata*0.7)\n> kddcup_train&lt;-kddcup[random_ids, ]\n> kddcup_pre&lt;-kddcup[-random_ids, ]</code></pre></div>\n<h3 id=\"svmで学習させる\" style=\"position:relative;\"><a href=\"#svm%E3%81%A7%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\" aria-label=\"svmで学習させる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SVMで学習させる</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 学習\n\n> kddcup_svm&lt;-ksvm(label ~., data=kddcup_train)\n\n> kddcup_svm\n\n# 結果\n\nSupport Vector Machine object of class \"ksvm\"\n\nSV type: C-svc (classification)\nparameter : cost C = 1\n\nGaussian Radial Basis kernel function.\nHyperparameter : sigma = 0.000103739702263078\n\nNumber of Support Vectors : 8239\n\nObjective Function Value : -329.9296 -738.1392 -65.7569 -28.2657 -670.0012 -175.8475 -32.3014 -70.8226 -27.5727 -27.7096\nTraining error : 0.001939</code></pre></div>\n<p>Training errorを確認すると、まずまず学習できているみたいです。さすが。</p>\n<h3 id=\"評価する\" style=\"position:relative;\"><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B\" aria-label=\"評価する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>評価する</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> result_predict&lt;-predict(kddcup_svm, kddcup_pre)\n> table(result_predict,kddcup_pre$label)\n\nresult_predict dos normal probe r2l u2r\ndos 195344 22 160 0 0\nnormal 108 48781 141 40 28\nprobe 96 40 1724 0 0\nr2l 0 13 0 511 0\nu2r 0 0 0 0 3</code></pre></div>\n<h3 id=\"表でまとめます\" style=\"position:relative;\"><a href=\"#%E8%A1%A8%E3%81%A7%E3%81%BE%E3%81%A8%E3%82%81%E3%81%BE%E3%81%99\" aria-label=\"表でまとめます permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>表でまとめます</h3>\n<table>\n<thead>\n<tr>\n<th>result_prediction</th>\n<th>dos</th>\n<th>normal</th>\n<th>probe</th>\n<th>r2l</th>\n<th>u2r</th>\n<th>適合率</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dos</td>\n<td>195344</td>\n<td>22</td>\n<td>160</td>\n<td>0</td>\n<td>0</td>\n<td>99.9%</td>\n</tr>\n<tr>\n<td>normal</td>\n<td>108</td>\n<td>48781</td>\n<td>141</td>\n<td>40</td>\n<td>28</td>\n<td>99.3%</td>\n</tr>\n<tr>\n<td>probe</td>\n<td>96</td>\n<td>40</td>\n<td>1724</td>\n<td>0</td>\n<td>0</td>\n<td>92.7%</td>\n</tr>\n<tr>\n<td>r2l</td>\n<td>0</td>\n<td>13</td>\n<td>0</td>\n<td>511</td>\n<td>0</td>\n<td>97.5%</td>\n</tr>\n<tr>\n<td>u2r</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>3</td>\n<td>100%</td>\n</tr>\n<tr>\n<td>再現率</td>\n<td>99.9%</td>\n<td>99.8%</td>\n<td>85.1%</td>\n<td>92.7%</td>\n<td>9.7%</td>\n<td>99.7%</td>\n</tr>\n</tbody>\n</table>\n<p>縦が予測結果で、横が実際のラベルです。総じて上手くいきました。</p>\n<p>ただ、U2Rの精度が低いことが気になります。そもそもデータが少なく学習があまり上手くいっていないのでしょうか。</p>\n<h3 id=\"実際にやってみたc-svmでクロスバリデーション\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9Fc-svm%E3%81%A7%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%90%E3%83%AA%E3%83%87%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\" aria-label=\"実際にやってみたc svmでクロスバリデーション permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実際にやってみた(C-SVMでクロスバリデーション)</h3>\n<p>クロスバリデーション（交差検証）は学習データをいくつかのデータに分け、1つの塊を評価用にそれ以外を学習用としすべての場合を尽くすように学習を進め、汎化性能を上げる手法です。例えば、</p>\n<ol>\n<li>全データをA・B・Cの3つに分けます。</li>\n<li>A・Bを学習データとして学習し、Cを用いて評価します。</li>\n<li>次にB・Cを学習データとし、Aを用いて評価します。</li>\n<li>次にC・Aを学習データとし、Bを用いて評価します。</li>\n<li>それぞれの結果からもっともよい結果をモデルとして採用します。</li>\n</ol>\n<p>こうすることで少ないデータでも汎化性能を上げることができるというものです。当然、分割したデータでそれぞれ学習させるので時間はかかります。</p>\n<p>今回はデータ量も多いので3つに分割して実施します。(K-folds法)　通常は10分割にすることが一般的で、データ量が少ない場合はleave-one-out交差検証とかも使われます。</p>\n<h3 id=\"学習させるc-svm-closs3\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8Bc-svm-closs3\" aria-label=\"学習させるc svm closs3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習させる(C-SVM closs=3)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># closs=3で3つに分割して学習\n\n> kddcup_svm&lt;-ksvm(label ~., data=kddcup_train, cross=3)\n\n> kddcup_svm\n\nSupport Vector Machine object of class \"ksvm\"\n\nSV type: C-svc (classification)\nparameter : cost C = 1\n\nGaussian Radial Basis kernel function.\nHyperparameter : sigma = 9.3825289054228e-05\n\nNumber of Support Vectors : 9664\n\nObjective Function Value : -435.7988 -1029.419 -65.9252 -38.3732 -854.7929 -212.3627 -49.4105 -74.7773 -37.6926 -34.5452\nTraining error : 0.001888\nCross validation error : 0.002689</code></pre></div>\n<p>Cross validation errorは上がってしまいました。ただし、クロスバリデーションを用いないときと比べ学習に用いるデータが少ないため、学習の収束は低くでてしまうのは仕方ありません。</p>\n<p>むしろ、収束しきらないところでも高精度を叩きだすことが目的でもありますし。</p>\n<h3 id=\"評価する-1\" style=\"position:relative;\"><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B-1\" aria-label=\"評価する 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>評価する</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> result_predict&lt;-predict(kddcup_svm, kddcup_pre)\n> table(result_predict,kddcup_pre$label)\n\nresult_predict dos normal probe r2l u2r\ndos 117643 7 85 0 0\nnormal 58 28821 95 23 12\nprobe 53 19 1058 0 0\nr2l 0 6 0 324 0\nu2r 0 0 0 0 3\n\n# 誤差率を計算してみる\n\n> 1-sum(diag(kddcup_table))/sum(kddcup_table)\n[1] 0.00241554</code></pre></div>\n<table>\n<thead>\n<tr>\n<th>result_prediction</th>\n<th>dos</th>\n<th>normal</th>\n<th>probe</th>\n<th>r2l</th>\n<th>u2r</th>\n<th>適合率</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dos</td>\n<td>117643</td>\n<td>7</td>\n<td>85</td>\n<td>0</td>\n<td>0</td>\n<td>99.9%</td>\n</tr>\n<tr>\n<td>normal</td>\n<td>58</td>\n<td>28821</td>\n<td>95</td>\n<td>23</td>\n<td>12</td>\n<td>99.4%</td>\n</tr>\n<tr>\n<td>probe</td>\n<td>53</td>\n<td>19</td>\n<td>1058</td>\n<td>0</td>\n<td>0</td>\n<td>93.6%</td>\n</tr>\n<tr>\n<td>r2l</td>\n<td>0</td>\n<td>6</td>\n<td>0</td>\n<td>324</td>\n<td>0</td>\n<td>98.2%</td>\n</tr>\n<tr>\n<td>u2r</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>0</td>\n<td>3</td>\n<td>100%</td>\n</tr>\n<tr>\n<td>再現率</td>\n<td>99.9%</td>\n<td>99.9%</td>\n<td>85.5%</td>\n<td>93.4%</td>\n<td>20%</td>\n<td>99.8%</td>\n</tr>\n</tbody>\n</table>\n<p>ほんの少しですが精度が上がった気がします。</p>\n<h2 id=\"ニューラルネットでもやってみますnnet\" style=\"position:relative;\"><a href=\"#%E3%83%8B%E3%83%A5%E3%83%BC%E3%83%A9%E3%83%AB%E3%83%8D%E3%83%83%E3%83%88%E3%81%A7%E3%82%82%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%99nnet\" aria-label=\"ニューラルネットでもやってみますnnet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ニューラルネットでもやってみます(nnet)</h2>\n<p>比較のためにニューラルネットでもやってみます。R言語ではnnetというパッケージでニューラルネットが使えます。</p>\n<p>隠れ層のユニット数は出力結果のラベル数を考慮し、5としてます。(3で実施したら、ラベルが全部でませんでした。)</p>\n<h3 id=\"学習させるnnnet\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8Bnnnet\" aria-label=\"学習させるnnnet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習させる(nnnet)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># パッケージインストール＆適応\n\n> install.packages( \"nnet\" )\n\n> library( nnet )\n\n# 隠れ層のユニット数5、ランダム値範囲-0.1～0.1、減衰5e-4で実施\n\n> kddcup_nnet &lt;- nnet(label~., size=5, data=kddcup_train, rang = .1, decay = 5e-4, maxit = 3000)\n# weights: 615\ninitial value 575217.442435\niter 10 value 74350.753004\niter 20 value 39017.507761\niter 30 value 33989.403391\niter 40 value 30099.250316\niter 50 value 27641.918258\niter 60 value 24688.366217\niter 70 value 23909.225741\niter 80 value 22006.056620\niter 90 value 21385.374653\niter 100 value 20640.355978\niter 110 value 19443.652176\niter 120 value 17966.682333\niter 130 value 17561.847075\niter 140 value 17298.101203\niter 150 value 16746.291929\niter 160 value 16219.714301\niter 170 value 15885.755704\niter 180 value 14769.847387\niter 190 value 14277.103879\niter 200 value 13651.371989\niter 210 value 12878.412456\niter 220 value 12637.064141\niter 230 value 11873.795106\niter 240 value 10919.945647\niter 250 value 9574.787432\niter 260 value 8064.989190\niter 270 value 7261.795869\niter 280 value 5941.270340\niter 290 value 4788.910803\niter 300 value 4263.836429\niter 310 value 4077.903774\niter 320 value 4035.943916\niter 330 value 3953.874037\niter 340 value 3927.603041\niter 350 value 3850.554389\niter 360 value 3690.449366\niter 370 value 3679.445537\niter 380 value 3660.072147\niter 390 value 3654.366314\niter 400 value 3649.497562\niter 410 value 3613.612850\niter 420 value 3546.881873\niter 430 value 3466.460679\niter 440 value 3332.472239\niter 450 value 3202.713314\niter 460 value 3192.588930\niter 470 value 3169.223153\niter 480 value 3097.055361\niter 490 value 2897.312752\niter 500 value 2595.342208\niter 510 value 2323.495624\niter 520 value 2160.486970\niter 530 value 2068.124473\niter 540 value 1986.553216\niter 550 value 1917.448970\niter 560 value 1848.341606\niter 570 value 1826.934175\niter 580 value 1817.437531\niter 590 value 1783.570324\niter 600 value 1749.888183\niter 610 value 1727.915109\niter 620 value 1724.945680\niter 630 value 1712.222157\niter 640 value 1709.191769\niter 650 value 1702.575583\niter 660 value 1689.403803\niter 670 value 1687.694131\niter 680 value 1685.270318\niter 690 value 1684.377098\niter 700 value 1684.111195\niter 710 value 1682.717637\niter 720 value 1682.526618\niter 720 value 1682.526604\niter 730 value 1682.082587\niter 730 value 1682.082587\nfinal value 1682.081493\nconverged</code></pre></div>\n<h3 id=\"評価する-2\" style=\"position:relative;\"><a href=\"#%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B-2\" aria-label=\"評価する 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>評価する</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># TypeはClassで\n\n> kddcup_nnet_pre &lt;- predict(kddcup_nnet, kddcup_pre, type=\"class\")\n> table(kddcup_nnet_pre,kddcup_pre$label)\n\nkddcup_nnet_pre dos normal probe r2l u2r\ndos 117326 7 3 4 3\nnormal 3 29315 11 57 7\nprobe 2 0 1164 0 0\nr2l 1 11 0 289 1\nu2r 0 1 0 0 2\n\n# 誤差率を評価する\n> kddcup_table_pre &lt;- table(kddcup_nnet_pre,kddcup_pre$label)\n> 1-sum(diag(kddcup_table_pre))/sum(kddcup_table_pre)\n[1] 0.0007489525</code></pre></div>\n<h3 id=\"表でまとめます-1\" style=\"position:relative;\"><a href=\"#%E8%A1%A8%E3%81%A7%E3%81%BE%E3%81%A8%E3%82%81%E3%81%BE%E3%81%99-1\" aria-label=\"表でまとめます 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>表でまとめます</h3>\n<table>\n<thead>\n<tr>\n<th>result_prediction</th>\n<th>dos</th>\n<th>normal</th>\n<th>probe</th>\n<th>r2l</th>\n<th>u2r</th>\n<th>適合率</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dos</td>\n<td>117326</td>\n<td>7</td>\n<td>3</td>\n<td>4</td>\n<td>3</td>\n<td>99.99...%</td>\n</tr>\n<tr>\n<td>normal</td>\n<td>3</td>\n<td>29315</td>\n<td>11</td>\n<td>57</td>\n<td>7</td>\n<td>99.7%</td>\n</tr>\n<tr>\n<td>probe</td>\n<td>2</td>\n<td>0</td>\n<td>1164</td>\n<td>0</td>\n<td>0</td>\n<td>99.8%</td>\n</tr>\n<tr>\n<td>r2l</td>\n<td>1</td>\n<td>11</td>\n<td>0</td>\n<td>289</td>\n<td>1</td>\n<td>95.7%</td>\n</tr>\n<tr>\n<td>u2r</td>\n<td>0</td>\n<td>1</td>\n<td>0</td>\n<td>0</td>\n<td>2</td>\n<td>66.7%</td>\n</tr>\n<tr>\n<td>再現率</td>\n<td>99.99...%</td>\n<td>99.9%</td>\n<td>98.8%</td>\n<td>82.6%</td>\n<td>15.4%</td>\n<td>99.9%</td>\n</tr>\n</tbody>\n</table>\n<p>精度はクロスバリデーションを用いたC-SVMより上がりました?</p>\n<p>過学習っぽい。</p>\n<h3 id=\"おまけ-それぞれのノードの重みを確認する\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E9%87%8D%E3%81%BF%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\" aria-label=\"おまけ それぞれのノードの重みを確認する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ それぞれのノードの重みを確認する</h3>\n<p><a href=\"http://hosho.ees.hokudai.ac.jp/~kubo/ce/NeuralNetwork.html\" target=\"_blank\" rel=\"noopener noreferrer\">生態学のデータ解析 - ニューラルネット</a> を参考にニューラルネットのノードを可視化してみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">source(\"http://hosho.ees.hokudai.ac.jp/~kubo/log/2007/img07/plot.nn.txt\")\n> plot.nn(kddcup_nnet)</code></pre></div>\n<p><img src=\"https://i.imgur.com/Ylygrrb.png\" alt=\":\"></p>\n<p>おお～。可視化するとすごいっすね。</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>パターン認識にはやはり古典的ではありますが、SVMは単純なパラメータでもかなりの精度を叩きだしました。さらに学習データが十分だと思ってもクロスバリデーションでほんの少し精度を向上できました。</p>\n<p>それ以上に精度を出せたのはニューラルネットとなりました。(過学習気味ですが)ある程度データ量があれば、強力な分類精度を叩きだしますね。</p>\n<h3 id=\"参考文献\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-label=\"参考文献 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考文献</h3>\n<p><a href=\"http://qiita.com/kokumura/items/64eefc8594995b1d0713\" target=\"_blank\" rel=\"noopener noreferrer\">SVMで天気予報</a></p>\n<p><a href=\"https://fisproject.jp/2014/09/%E3%80%90caret%E3%80%91r%E3%81%A7svm%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E5%AD%A6%E3%81%B6%E3%80%90grid-search%E3%80%91/\" target=\"_blank\" rel=\"noopener noreferrer\">【caret】R で SVM を学ぶ【Grid-Search】</a></p>\n<p><a href=\"http://d.hatena.ne.jp/kj-ki/20120124/p1\" target=\"_blank\" rel=\"noopener noreferrer\">Rでnnetを試してみる</a></p>\n<p><a href=\"http://www1.doshisha.ac.jp/~mjin/R/Chap_23/23.html\" target=\"_blank\" rel=\"noopener noreferrer\">ＲとＷＥＫＡによるニューラルネットワーク</a></p>\n<p><a href=\"http://hosho.ees.hokudai.ac.jp/~kubo/ce/NeuralNetwork.html\" target=\"_blank\" rel=\"noopener noreferrer\">生態学のデータ解析 - ニューラルネット</a></p>","fields":{"slug":"2017/07/11/rlang"},"frontmatter":{"tags":["R言語","機械学習","kddcup99"],"templateKey":"blog-post","slug":"2017/07/11/rlang","id":null,"title":"R言語を使って、サポートベクターとかニューラルネットとかを比較してみる（kddcup99編）","url":"2017/07/11/rlang","date":"2017-07-10T16:29:15.245Z","description":"R言語を使って、サポートベクターとかニューラルネットとかを比較してみる（kddcup99編）","headerImage":"https://i.imgur.com/Ylygrrb.png","year":"2017","month":"07"}}},{"node":{"id":"6ca093ca-1f38-5e85-b5dc-fe1e709531d8","html":"<p>ランサムウェアとか怖いですよね。</p>\n<p>多くの企業で大変問題になっているランサムウェアですが、最近は一般男性を語るランサムウェアもあり…　もうやめにしませんか。</p>\n<p><img src=\"https://i.imgur.com/BdLL0YX.jpg\" alt=\"img\"></p>\n<p>そんなことを言ってもやめてくれるような相手ではないのは、一般男性含め周知の事実ですので対策しましょう。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E5%A4%9A%E3%81%8F%E3%81%AE%E4%BC%9A%E7%A4%BE%E3%81%A7%E5%B0%8E%E5%85%A5%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E4%BB%AE%E6%83%B3%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6\">多くの会社で導入されている仮想セキュリティブラウザ</a></li>\n<li><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AF%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98%E3%81%A7%E3%81%99\">実際はこんな感じです。</a></li>\n</ul>\n</div>\n<h2 id=\"多くの会社で導入されている仮想セキュリティブラウザ\" style=\"position:relative;\"><a href=\"#%E5%A4%9A%E3%81%8F%E3%81%AE%E4%BC%9A%E7%A4%BE%E3%81%A7%E5%B0%8E%E5%85%A5%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E4%BB%AE%E6%83%B3%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6\" aria-label=\"多くの会社で導入されている仮想セキュリティブラウザ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>多くの会社で導入されている仮想セキュリティブラウザ</h2>\n<p>仮想セキュリティブラウザとは、ローカルのブラウザを使わずに、仮想マシン上のブラウザを利用し、そこへリモートで画面転送し、万が一ウイルスに感染しても、</p>\n<p>ローカルPCもしくはLANに影響を与えないようにするものです。</p>\n<p><img src=\"https://i.imgur.com/Xi9UYsL.png\" alt=\"img\"></p>\n<p>イメージはこんな感じです。</p>\n<ol>\n<li>\n<p>仮想マシンが動く基盤をLAN内に設置</p>\n</li>\n<li>\n<p>DMZ用のVLANを作成する</p>\n</li>\n<li>\n<p>LAN内に入れないところ(DMZ)に仮想マシンを設置し、ウィンドウシステムとブラウザを入れる</p>\n</li>\n<li>\n<p>仮想マシンの画面をSpiceなどでアクセスすることで転送する。</p>\n</li>\n</ol>\n<p>我が家では仮想化基盤はKVMを使っています。KVMだと、各仮想マシンの画面を転送する方法として、Spiceを使うことができます。</p>\n<p>Spiceでは仮想マシン自体にリモデするわけではなく、基盤そばにアクセスすることで画面転送を実現できますので、たとえばネットワークから分離した仮想マシンの画面も転送できるわけです。</p>\n<p>（基盤へネットワークアクセスさえできればいい）</p>\n<p>この機能を応用してあらかじめ仮想マシンに別のVLANを割り当て、LAN内にアクセスできないようにしておきます。また、</p>\n<p>仮想マシン自体がインターネットにアクセスできるようにインターネットへの抜け道は設定しておきます。</p>\n<h2 id=\"実際はこんな感じです\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AF%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98%E3%81%A7%E3%81%99\" aria-label=\"実際はこんな感じです permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実際はこんな感じです。</h2>\n<p><img src=\"https://i.imgur.com/XLKBlIG.png\" alt=\"inm\"></p>\n<p>このようにSpiceの画面転送を見るRemoteViewerを利用しネットができます。</p>\n<p>最悪ウイルスに感染したとしてもLAN内には感染が広がりませんし、仮想マシンの削除だけで対処できます。</p>\n<p>画面の解像度等調整しないと転送コストで遅くなってしまいストレスに感じるかもなのでそこは工夫しましょう！</p>","fields":{"slug":"2017/07/09/virtual-browser"},"frontmatter":{"tags":["仮想化","仮想ブラウザ","KVM"],"templateKey":"blog-post","slug":"2017/07/09/virtual-browser","id":null,"title":"仮想セキュリティブラウザというものを作った","url":"2017/07/09/virtual-browser","date":"2017-07-09T04:26:08.214Z","description":"仮想セキュリティブラウザというものを作った","headerImage":"https://i.imgur.com/Xi9UYsL.png","year":"2017","month":"07"}}},{"node":{"id":"98b0e413-25a2-5bc0-85e9-b41671017490","html":"<p>どうも。GrafanaのUIは結構かっこいいことで有名で、自身もZabbix APIを活用してZabbixのメトリックをGrafanaで見れるようにしております。</p>\n<p><img src=\"https://i.imgur.com/N2pDM5D.png\" alt=\"img\"></p>\n<p>こんな感じ。Zabbixのスクリーンと全く同じ内容ですが、妙に「監視している感」がありますね。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#zabbix%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AFzabbix%E3%81%A7%E8%A6%8B%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\">ZabbixのデータはZabbixで見ればいいのでは？</a></li>\n<li><a href=\"#grafana%E3%81%AEworld-ping%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\">GrafanaのWorld Pingを使ってみよう</a></li>\n<li><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\">インストールしてみる</a></li>\n<li><a href=\"#grafananet-api%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97world-ping%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">Grafana.net APIを取得しWorld Pingが利用できるようにする</a></li>\n<li><a href=\"#%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\">エンドポイントを追加する</a></li>\n<li><a href=\"#%E7%94%BB%E9%9D%A2%E3%82%92%E8%A6%8B%E3%82%8B\">画面を見る</a></li>\n</ul>\n</div>\n<h2 id=\"zabbixのデータはzabbixで見ればいいのでは\" style=\"position:relative;\"><a href=\"#zabbix%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AFzabbix%E3%81%A7%E8%A6%8B%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\" aria-label=\"zabbixのデータはzabbixで見ればいいのでは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZabbixのデータはZabbixで見ればいいのでは？</h2>\n<p>はい。おっしゃるとおりです。そもそもそんな監視するほど重要なものがあるかと言われると。。</p>\n<p>でも、Grafanaにはもっと手軽にかっこいい画面を見る方法があります。</p>\n<h2 id=\"grafanaのworld-pingを使ってみよう\" style=\"position:relative;\"><a href=\"#grafana%E3%81%AEworld-ping%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\" aria-label=\"grafanaのworld pingを使ってみよう permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GrafanaのWorld Pingを使ってみよう</h2>\n<p>Grafanaの優秀な点はPlugin機能で簡単にデータソースやパネルを追加できる点です。</p>\n<p>もともと、GrafanaはInfluxDBの可視化用みたいな位置づけっぽいですが、データソースプラグインを追加することで、例えばElasticsearch・Graphiteや、CloudWatch、さらにはkubernetesやDatadogなどのコンテナの監視までできるという優れものです。</p>\n<p>また、データソースではないですが、World Pingという世界中のエンドポイントからPing・DNS・HTTPなどの死活監視を提供するサービスと連携させることで、簡単にかっちょいい画面を作ることができます。</p>\n<p><img src=\"https://i.imgur.com/4puZFgk.png\" alt=\"img\"></p>\n<p>こんな感じで好きなプラグインをコマンド一発でインストールできます。</p>\n<h2 id=\"インストールしてみる\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"インストールしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>インストールしてみる</h2>\n<p>まず、Grafanaの入ったサーバーでrootユーザーで、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">grafana-cli plugins install raintank-worldping-app</code></pre></div>\n<p>こうすることで、簡単にプラグインが導入されます。</p>\n<h2 id=\"grafananet-apiを取得しworld-pingが利用できるようにする\" style=\"position:relative;\"><a href=\"#grafananet-api%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97world-ping%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"grafananet apiを取得しworld pingが利用できるようにする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Grafana.net APIを取得しWorld Pingが利用できるようにする</h2>\n<p><img src=\"https://i.imgur.com/3jpOIzC.png\" alt=\"img\"></p>\n<p>Grafana Web画面の左側のメニューに「World Ping」が表示されていると思いますのでPlugin Configから、Grafana.netのAPIを発行しましょう。</p>\n<p>こうすることでWorld Pingが利用できます。無茶な監視をしない限り、無料版で事足りると思います。</p>\n<h2 id=\"エンドポイントを追加する\" style=\"position:relative;\"><a href=\"#%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\" aria-label=\"エンドポイントを追加する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>エンドポイントを追加する</h2>\n<p>監視対象のIPまたはドメイン名をエンドポイントと呼んでますが、エンドポイントを設定していきます。</p>\n<p>同じく、Grafana Web画面の左側のメニューに「World Ping」⇒「Endpoints」と進みます。</p>\n<p>エンドポイントは無料版だと最大3つです。</p>\n<p><img src=\"https://i.imgur.com/JVyAD6w.png\" alt=\"img\"></p>\n<p>このようにEndpointにドメイン名を設定し、監視したいサービスを選びConfigureを押します。</p>\n<p><img src=\"https://i.imgur.com/XCXFfBk.png\" alt=\"img\"></p>\n<p>細かい設定等でてきますから、設定していきます。</p>\n<p>監視間隔、死活監視を投げるインスタンスの国、ポート、HTTPメソッドなど細かく設定できます。</p>\n<p>また、閾値を超えた場合に決められたメールに通知できます。(あらかじめメールサーバーの設定をGrafana.iniでしておきます。)</p>\n<p>一応、無料版だと600万回/月しか監視できないようなので無茶な設定はやめましょう。</p>\n<p>アップデートボタンを押せば、設定が完了します。</p>\n<h2 id=\"画面を見る\" style=\"position:relative;\"><a href=\"#%E7%94%BB%E9%9D%A2%E3%82%92%E8%A6%8B%E3%82%8B\" aria-label=\"画面を見る permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>画面を見る</h2>\n<p>World Pingがすごいのは、あらかじめGrafana画面を提供している点で、設定さえすればすぐ可視化できることです。</p>\n<p>同じく、Grafana Web画面の左側のメニューに「World Ping」⇒「World Ping Home」と進むと、設定したエンドポイントが表示されますので、</p>\n<p>エンドポイント名もしくはハートマークのサービス名をクリックすると画面が表示されます。</p>\n<p><img src=\"https://i.imgur.com/iLyWtZb.png\" alt=\"img\"></p>\n<p>かっちょええ。</p>","fields":{"slug":"2017/06/16/grafana"},"frontmatter":{"tags":["監視","Grafana","World Ping"],"templateKey":"blog-post","slug":"2017/06/16/grafana","id":null,"title":"Grafana&World Ping を活用して簡単な死活監視をしてみよう","url":"2017/06/16/grafana","date":"2017-06-15T22:53:28.047Z","description":"Grafana&World Ping を活用して簡単な死活監視をしてみよう","headerImage":"https://i.imgur.com/iLyWtZb.png","year":"2017","month":"06"}}},{"node":{"id":"2107d1b1-60df-5088-93c2-26b1dd27586e","html":"<p>(過去ブログからの移転した記事です)</p>\n<p>なるべくコードはかかない。</p>\n<p>何の気なしに機械学習とかの仕事はないものかと、ネットの海をさまよっていたら、</p>\n<p><a href=\"https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/\" target=\"_blank\" rel=\"noopener noreferrer\">LSTMで自然な受け答えができるボットをつくった</a> という記事を見つけ、何となく読んで、やってみようかなと思ってやってみましたが、Chianer周りとか色々上手くいかなかった。というのがそもそもの始まりです。</p>\n<p><strong>Chainer周りで日本語の受け答えができますよ</strong>、的な記事は<strong>2015年頃</strong>のものが多く、Chainerがバージョンアップしたため、色々動かないことがありましたので、少しそちらに修正を加えて<strong>Chainer 1.6.1</strong>でもまともに動くように修正していこうと思います。</p>\n<p>自分でコードを一から書くのは嫌なので、<strong>あくまでもコードは書かない。</strong></p>\n<p>微修正にとどめるをモットーにがんばるぞい。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%84%E3%82%B5%E3%82%A4%E3%83%88\">参考にさせていただいたコードやサイト</a></li>\n<li><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\">サーバーを用意する</a></li>\n<li><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AApython%E7%92%B0%E5%A2%83%E3%81%A8%E3%82%B3%E3%83%BC%E3%83%91%E3%82%B9%E3%82%92%E6%95%B4%E3%81%88%E3%82%8B\">学習に必要なPython環境とコーパスを整える</a></li>\n<li><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\">学習させる</a></li>\n<li><a href=\"#api%E3%81%A7%E8%A9%B1%E3%81%99\">APIで話す</a></li>\n<li><a href=\"#%E4%BB%98%E5%B1%9E%E3%81%AEhubot-script%E3%81%A7%E9%81%8A%E3%82%93%E3%81%A7%E3%81%BF%E3%82%88%E3%81%86\">付属のHubot Scriptで遊んでみよう！</a></li>\n</ul>\n</div>\n<h2 id=\"参考にさせていただいたコードやサイト\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%84%E3%82%B5%E3%82%A4%E3%83%88\" aria-label=\"参考にさせていただいたコードやサイト permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考にさせていただいたコードやサイト</h2>\n<ul>\n<li>\n<p><a href=\"https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/\" target=\"_blank\" rel=\"noopener noreferrer\">LSTMで自然な受け答えができるボットをつくった</a></p>\n<ul>\n<li>このコードを元にあらかじめ作成したChainerモデルでおしゃべりBotに命を吹き込みます。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/yusuketomoto/chainer-char-rnn\" target=\"_blank\" rel=\"noopener noreferrer\">yusuketomoto/chainer-char-rnn</a>　</p>\n<ul>\n<li>Chainer・日本語界隈では知らない人はいないだろうChainerの言語モデル作成コード。こちらを用いてChainerモデルを作成していきます。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://qiita.com/GushiSnow/items/79ca7deeb976f50126d7\" target=\"_blank\" rel=\"noopener noreferrer\">Chainerで学習した対話用のボットをSlackで使用+Twitterから学習データを取得してファインチューニング</a></p>\n<ul>\n<li>学習に必要なコーパスを取得するために一部のスクリプトを使用します。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"サーバーを用意する\" style=\"position:relative;\"><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\" aria-label=\"サーバーを用意する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>サーバーを用意する</h2>\n<p>学習にも、会話にも自宅サーバーを用います。</p>\n<p>ああ、電気代。</p>\n<h2 id=\"学習に必要なpython環境とコーパスを整える\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AApython%E7%92%B0%E5%A2%83%E3%81%A8%E3%82%B3%E3%83%BC%E3%83%91%E3%82%B9%E3%82%92%E6%95%B4%E3%81%88%E3%82%8B\" aria-label=\"学習に必要なpython環境とコーパスを整える permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習に必要なPython環境とコーパスを整える</h2>\n<p>Chainer界隈のコードはなぜかPython2が多く、Python3は少ないので、直接Python2をインストールしてもいいのですが…。</p>\n<p>なんかOS環境を変に汚したくないので今回は<strong>PyenvとVirtualenv</strong>を使って実施していきます。</p>\n<p>学習用のコーパスをダウンロードするスクリプトはどうやら<strong>Python 3.4.1</strong>で実装されているようなので <strong>Python 3.4.1</strong> と <strong>Python2.7</strong> の2種類の環境を作っていきたいと思います。</p>\n<p>そして、3.4.1の環境にて学習用のコーパスをダウンロードします。</p>\n<p>PyenvとVirtualenvはあらかじめインストール済みとしてすすめます。</p>\n<p>PyenvとVirtualenvのインストール方法はこちらの記事が参考になると思います。<a href=\"https://qiita.com/Kodaira_/items/feadfef9add468e3a85b\" target=\"_blank\" rel=\"noopener noreferrer\">（pyenvとvirtualenvで環境構築）\n</a></p>\n<p>まず、Pythonの環境を作ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ pyenv <span class=\"token function\">install</span> <span class=\"token number\">3.4</span>.1\n\n$ pyenv <span class=\"token function\">install</span> <span class=\"token number\">2.7</span>\n\n$ pyenv rehash\n\n$ virtualenv -p ~/.pyenv/versions/3.4.1/bin/python3.4 my_env3.4.1\n\n$ virtualenv -p ~/.pyenv/versions/2.7/bin/python2.7 my_env2.7</code></pre></div>\n<p>続いてコーパスをダウンロードします。</p>\n<p>今回は<a href=\"https://qiita.com/GushiSnow/items/79ca7deeb976f50126d7\" target=\"_blank\" rel=\"noopener noreferrer\">Chainerで学習した対話用のボットをSlackで使用+Twitterから学習データを取得してファインチューニング</a>を参考にダウンロードします。</p>\n<p>コーパスデータはたぶん二次配布とかNGだと思うので、何とか自分でダウンロードしてください。</p>\n<p><a href=\"https://sites.google.com/site/dialoguebreakdowndetection/\" target=\"_blank\" rel=\"noopener noreferrer\">対話破綻検出チャレンジ</a></p>\n<p>ダウンロードしたあとは展開したJSONデータ全部、devフォルダを作成してその中に入れて、listファイル(JSONファイルのパスを記載したやつ)をdata_load.pyと同じところに作っておきます。</p>\n<p>こんな感じでlistファイルを作ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">../dev/1404365812.log.json\n../dev/1407143708.log.json\n../dev/1407143981.log.json\n../dev/1407149923.log.json\n../dev/1407208809.log.json\n../dev/1407209083.log.json\n…… </code></pre></div>\n<p>Linuxのコマンド(bash)で</p>\n<p><code class=\"language-text\">ls -1 ../dev > list</code></p>\n<p>で作成できるはず。</p>\n<p>学習データを作っていきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">source</span> my_env3.4.1/bin/activate\n\n$ <span class=\"token function\">git</span> clone https://github.com/SnowMasaya/Chainer-Slack-Twitter-Dialogue.git\n\n$ <span class=\"token builtin class-name\">cd</span> chainer-slack-twitter/utils\n\n$ python data_load.py</code></pre></div>\n<p>player_1.txt , player_2.txtというテキストファイルができます。</p>\n<p>統合する前にmecabを使って分かち書きをしておきます。</p>\n<p>分かち書きに<strong>mecab-ipadic-NEologd</strong>を使うと学習が進むそうですので入れてないほうは導入しましょう。</p>\n<p>めんどくさい人はただの<strong>MeCab</strong>でも大丈夫だと思います。</p>\n<p>さて、分かち書きします。今回は <strong>mecab-ipadic-NEologd</strong> を利用します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mecab –Owakati –d /usr/local/lib/mecab/dic/mecab–ipadic–neologd player_1.txt <span class=\"token operator\">></span> player_1_wakati.txt\n\nmecab –Owakati –d /usr/local/lib/mecab/dic/mecab–ipadic–neologd player_2.txt <span class=\"token operator\">></span> player_2_wakati.txt</code></pre></div>\n<p>次に使うChainer-char-rnn用に一つのinput.txtに統合していきます。統合の際に、player1とplayer2の会話ごとに空行を入れておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">paste</span> -d “<span class=\"token punctuation\">\\</span>n” player_1_wakati.txt player_2_wakati.txt <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> ‘<span class=\"token punctuation\">(</span>NR%2<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token variable\">$0</span><span class=\"token operator\">=</span><span class=\"token variable\">$0</span>″<span class=\"token punctuation\">\\</span>n”<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>print<span class=\"token punctuation\">}</span>’ <span class=\"token operator\">></span> input.txt</code></pre></div>\n<p>こちらのinput.txtをコーパスデータとして利用します。</p>\n<h2 id=\"学習させる\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\" aria-label=\"学習させる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習させる</h2>\n<p>学習には<a href=\"https://github.com/yusuketomoto/chainer-char-rnn\" target=\"_blank\" rel=\"noopener noreferrer\">yusuketomoto/chainer-char-rnn</a>を使わせていただきます！</p>\n<p><strong>Chainer 1.4.1</strong> で実行しようとしたら微妙に実装が変わっていた用なので、こちらに合わせて今回の学習は、<strong>Chainer 1.6.1</strong> で実施していきます。(Chainer周りのコードを読んで修正するより、後に使うTornado周りの修正の方がまだわかるからというスキル不足によるもの)</p>\n<p>さきほど作っておいたPython 2.7用に切り替えます。PipでChainer1.6.1を入れてからChainer-char-rnnを実行していきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">source</span> my_env2.7/bin/activate\n\n$ pip <span class=\"token function\">install</span> <span class=\"token assign-left variable\">chainer</span><span class=\"token operator\">==</span>”1.6.1″\n\n$ <span class=\"token function\">git</span> clone https://github.com/yusuketomoto/chainer-char-rnn.git\n\n$ <span class=\"token builtin class-name\">cd</span> chainer-char-rnn\n\n$ <span class=\"token function\">mkdir</span> -p data/chat\n\n$ <span class=\"token function\">mkdir</span> -p cv/chat\n\n$ <span class=\"token function\">cp</span> <span class=\"token punctuation\">..</span>/chainer-slack-twitter/input.txt data/chat\n\n$ python train.py –data_dir data/chat –checkpoint_dir cv/chat –rnn_size <span class=\"token number\">1024</span></code></pre></div>\n<p>しばらく待ちます。全部が終わるのは途方もない時間がかかります。</p>\n<p>学習が進むごとにCheckpointとしてChainer modelファイルがcv/chat配下にできますので、適当なEpochのところのものを次の「APIで話す」に使ってもいいですし、学習の最新ファイルである</p>\n<p>latest.chainermodelを使ってもいいです。もちろん、最後まで待ってからlatest.chainermodelを使ってもいいです。</p>\n<p>ひとまず数時間回したところのlatest.chainermodelを使ってみます。</p>\n<h2 id=\"apiで話す\" style=\"position:relative;\"><a href=\"#api%E3%81%A7%E8%A9%B1%E3%81%99\" aria-label=\"apiで話す permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>APIで話す</h2>\n<p><a href=\"https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/\" target=\"_blank\" rel=\"noopener noreferrer\">LSTMで自然な受け答えができるボットをつくった</a>よりJapanese Talk APIを作っていきます。</p>\n<p>この回では少々コードの改変がありますのでForkしたものをGitHubにあげました。</p>\n<p><a href=\"https://github.com/tubone24/japanese_talk_api_chainer14/tree/chainer1.6.1\" target=\"_blank\" rel=\"noopener noreferrer\">japanese_talk_api_1.6.1</a></p>\n<p>こちらのmodelsディレクトリにChainer modelを投入します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> clone https://github.com/tubone24/japanese_talk_api/tree/chainer1.6.1.git\n\n$ <span class=\"token function\">mkdir</span> japanese_talk_api/tornado/models\n\n$ <span class=\"token function\">cp</span> chainer-char-rnn/cv/chat/latest.chainermodel japanese_talk_api/tornado/models</code></pre></div>\n<p>Chainerの他にTornadoも必要になるのでPipでインストールします。</p>\n<p>そしてAPIを8787ポートで起動します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ pip <span class=\"token function\">install</span> tornado\n\n$ python japanese_talk_api/tornado/app.py –port<span class=\"token operator\">=</span><span class=\"token number\">8787</span> –debug<span class=\"token operator\">=</span>True</code></pre></div>\n<p>あとは起動を待ってからcurlやブラウザなどで</p>\n<p><code class=\"language-text\">http://localhost/?q=こんにちは</code></p>\n<p>で受け取れるようにはずです。</p>\n<p>学習用input.txtにないことばとか出すとたまにエラー吐きます。</p>\n<p><del>ﾋﾞﾝﾋﾞﾝﾋﾞﾝﾋﾞﾝﾋﾞﾝﾋﾞﾝﾋﾞﾝﾋﾞﾝ… ﾁｸｯ あ・あ・あぁ・ぁああああ↑↑ アーｯ…ｲｸｯ チ～ン　問いかける言葉には気をつけよう！</del></p>\n<h2 id=\"付属のhubot-scriptで遊んでみよう\" style=\"position:relative;\"><a href=\"#%E4%BB%98%E5%B1%9E%E3%81%AEhubot-script%E3%81%A7%E9%81%8A%E3%82%93%E3%81%A7%E3%81%BF%E3%82%88%E3%81%86\" aria-label=\"付属のhubot scriptで遊んでみよう permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>付属のHubot Scriptで遊んでみよう！</h2>\n<p><a href=\"https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/\" target=\"_blank\" rel=\"noopener noreferrer\">LSTMで自然な受け答えができるボットをつくった</a>のHubotScriptをお借りして遊んでみましょう。</p>\n<p>あらかじめ比較として同じコーパスを利用しているDocomoの雑談APIをHubotに仕込んであります。</p>\n<p>発言の上が<strong>DocomoAPI</strong> 下が今回作ったAPIです。</p>\n<p>ちなみに我が家のHubotはSlack上に「智絵里ちゃん」として君臨しております。</p>\n<p><del>智絵里ちゃんマジ天使 <strong>I love you</strong></del></p>\n<p><img src=\"https://i.imgur.com/DJL1fwu.png\" alt=\"img\"></p>\n<p><strong>DocomoAPI</strong>に比べると天然というか、不思議系というか…　バカですね（直球）</p>\n<p>お借りした多くのコードや参考にさせていただいた多くのサイト・記事にあらためて感謝しつつ、智絵里ちゃんとのラブラブライフを送りますね。</p>","fields":{"slug":"2017/06/04/chainer-chieri-bot"},"frontmatter":{"tags":["Python","Chainer","RNN","LSTM","Chat BOT","アイマス","デレマス"],"templateKey":"blog-post","slug":"2017/06/04/chainer-chieri-bot","id":null,"title":"今更！！ Chainer 1.6.1 でおしゃべりBotを作ろう","url":"2017/06/04/chainer-chieri-bot","date":"2017-06-04T02:45:59.982Z","description":"緒方智恵理ちゃんボットなるものを2017年に作った過去記事の移植","headerImage":"https://i.imgur.com/DJL1fwu.png","year":"2017","month":"06"}}},{"node":{"id":"c1b267e8-0ea6-55e4-87d4-ff7afe512b87","html":"<p>Redmineで楽しくタスク管理.</p>\n<p>自宅開発サーバーのリソースが余っているので、Redmineを立てました。</p>\n<p>今後はこちらで自分のタスクを管理していきたいと思います。（三日坊主）</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3\">デザイン</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3\">プラグイン</a></p>\n<ul>\n<li>\n<p><a href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%A0%E3%81%AA%E3%81%81%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E4%B8%80%E8%A6%A7\">個人的に便利だなぁと思っているプラグイン一覧</a></p>\n</li>\n<li>\n<p><a href=\"#redmine-agile\">Redmine Agile</a></p>\n<ul>\n<li><a href=\"#redmine-github-hook\">Redmine GitHub Hook</a></li>\n<li><a href=\"#redmine-checklist\">Redmine Checklist</a></li>\n<li><a href=\"#redmine-work-time\">Redmine Work Time</a></li>\n<li><a href=\"#time-logger\">Time Logger</a></li>\n<li><a href=\"#redmine-knowledgebase\">Redmine Knowledgebase</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gitlab%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA\">GitLabとの連携</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%99%AE%E6%AE%B5%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B\">普段どうやって利用するのか。</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"デザイン\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3\" aria-label=\"デザイン permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デザイン</h2>\n<p>テーマをminimalflat2にしました。あまり仕事感がでなくて気に入っています。</p>\n<p>（職場で見るRedmineに恐怖心があるので）</p>\n<p><img src=\"https://i.imgur.com/Saix67W.png\" alt=\"img\"></p>\n<h2 id=\"プラグイン\" style=\"position:relative;\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3\" aria-label=\"プラグイン permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグイン</h2>\n<p><img src=\"https://i.imgur.com/2VuQKXY.png\" alt=\"img\"></p>\n<p>色々入れてますが、個人のタスク管理として便利なのが案外Agile系のプラグインだったりする。</p>\n<p>あと、Time Loggerはサーバーに負荷をかけるからあまり推奨されていない的な記事がありましたが、</p>\n<p>一人で使う分には問題ないみたい。</p>\n<p>参考:  <a href=\"http://qiita.com/y_hokkey/items/7c02a3af319b353136d5\" target=\"_blank\" rel=\"noopener noreferrer\">僕がredmineに入れてる便利なプラグインとデザインの格好良いテーマ</a></p>\n<h3 id=\"個人的に便利だなぁと思っているプラグイン一覧\" style=\"position:relative;\"><a href=\"#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%A0%E3%81%AA%E3%81%81%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E4%B8%80%E8%A6%A7\" aria-label=\"個人的に便利だなぁと思っているプラグイン一覧 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>個人的に便利だなぁと思っているプラグイン一覧</h3>\n<h3 id=\"redmine-agile\" style=\"position:relative;\"><a href=\"#redmine-agile\" aria-label=\"redmine agile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redmine Agile</h3>\n<p>カンバン、BurnDownチャートとか使える。</p>\n<p><a href=\"http://www.redmine.org/plugins/redmine_agile\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.redmine.org/plugins/redmine_agile</a></p>\n<h4 id=\"redmine-github-hook\" style=\"position:relative;\"><a href=\"#redmine-github-hook\" aria-label=\"redmine github hook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redmine GitHub Hook</h4>\n<p>GitLabにも使えます!! レポジトリのプッシュに応じてRedmine上のレポジトリも更新できる。</p>\n<p><a href=\"https://github.com/koppen/redmine_github_hook\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/koppen/redmine_github_hook</a></p>\n<h4 id=\"redmine-checklist\" style=\"position:relative;\"><a href=\"#redmine-checklist\" aria-label=\"redmine checklist permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redmine Checklist</h4>\n<p>チケットにチェックリストを作成可能！</p>\n<p><a href=\"http://www.redmine.org/plugins/redmine_checklists\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.redmine.org/plugins/redmine_checklists</a></p>\n<h4 id=\"redmine-work-time\" style=\"position:relative;\"><a href=\"#redmine-work-time\" aria-label=\"redmine work time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redmine Work Time</h4>\n<p>工数管理ツール。自分は今日どれくらいがんばったかわかります。</p>\n<p><a href=\"http://www.redmine.org/plugins/redmine_work_time\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.redmine.org/plugins/redmine_work_time</a></p>\n<h4 id=\"time-logger\" style=\"position:relative;\"><a href=\"#time-logger\" aria-label=\"time logger permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Time Logger</h4>\n<p>上のポチから簡単に作業時間をタイマーできます。便利。</p>\n<p><a href=\"http://www.redmine.org/plugins/time_logger\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.redmine.org/plugins/time_logger</a></p>\n<h4 id=\"redmine-knowledgebase\" style=\"position:relative;\"><a href=\"#redmine-knowledgebase\" aria-label=\"redmine knowledgebase permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redmine Knowledgebase</h4>\n<p>ナレッジベース。使っている人の多いプラグインだと思います。</p>\n<p>研修の資料とかここにあげておくと結構便利だったりする。</p>\n<p><a href=\"http://www.redmine.org/plugins/redmine_knowledgebase\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.redmine.org/plugins/redmine_knowledgebase</a></p>\n<h2 id=\"gitlabとの連携\" style=\"position:relative;\"><a href=\"#gitlab%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA\" aria-label=\"gitlabとの連携 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GitLabとの連携</h2>\n<p>Redmineの魅力はRedmine自体があまり得意でないレポジトリ管理を別のWebサービスに投げて、強力なタスク管理機能と連携させることにあります。</p>\n<p>同じサーバー内にレポジトリ管理サーバーとしてGitLabを入れていますのでそちらと連携させています。</p>\n<p>連携にはGitLabのRedmineプラグインと、RedmineのRedmine GitHub Hookを活用しています。</p>\n<h2 id=\"普段どうやって利用するのか\" style=\"position:relative;\"><a href=\"#%E6%99%AE%E6%AE%B5%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B\" aria-label=\"普段どうやって利用するのか permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>普段どうやって利用するのか。</h2>\n<p>あまりまだ運用方針が固まっていないのですが、自分の勉強スケジュールとかをとりあえず入れて、</p>\n<p>タスク管理していけばいいと思います。（適当）</p>","fields":{"slug":"2017/05/21/redmine"},"frontmatter":{"tags":["タスク管理","Redmine"],"templateKey":"blog-post","slug":"2017/05/21/redmine","id":null,"title":"自分のタスクをRedmineで管理してみる","url":"2017/05/21/redmine","date":"2017-05-21T03:29:44.717Z","description":"Redmineで楽しくタスク管理","headerImage":"https://i.imgur.com/Saix67W.png","year":"2017","month":"05"}}},{"node":{"id":"12be3655-6eea-5a4a-b565-d383c7940f33","html":"<p>安定稼働しないtuboneのサーバー周り。</p>\n<!-- textlint-disable -->\n<p>どうも。可用性に自身ニキのAWS S3の障害が話題ですが、我が家でも障害。</p>\n<p>我が家にある録画サーバーですが、かなり長い時間、障害でサービスが提供できない、という、AWSもびっくりな障害がありました。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E9%9A%9C%E5%AE%B3%E6%A4%9C%E7%9F%A5-alm%E7%99%BA%E7%94%9F\">障害検知-ALM発生</a></li>\n<li><a href=\"#%E9%9A%9C%E5%AE%B3%E5%8E%9F%E5%9B%A0%E8%AA%BF%E6%9F%BB-%E5%BE%A9%E6%97%A7\">障害原因調査-復旧</a></li>\n<li><a href=\"#%E7%89%A9%E7%90%86%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A8%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E7%9B%B8%E6%80%A7%E3%81%AE%E6%82%AA%E3%81%95\">物理デバイスと仮想マシンの相性の悪さ</a></li>\n<li><a href=\"#%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A\">振り返り</a></li>\n<li><a href=\"#%E5%AF%BE%E7%AD%96\">対策</a></li>\n</ul>\n</div>\n<h2 id=\"障害検知-alm発生\" style=\"position:relative;\"><a href=\"#%E9%9A%9C%E5%AE%B3%E6%A4%9C%E7%9F%A5-alm%E7%99%BA%E7%94%9F\" aria-label=\"障害検知 alm発生 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>障害検知-ALM発生</h2>\n<p>ALM発生は25～26夜にかけて、0バイトファイルが作成されるというALMがZABBIXから上がりました。</p>\n<p>仕組みは、録画サーバーの先にNFSで接続されているNASに0バイトファイルが一定時間以上作成されたままになると、</p>\n<p>loggerコマンドでエラーログをはく、というcronで検知するものですが、そちらのALMが発生したのですね。</p>\n<p>とりあえず、時間がなかったということと疲れていたということで録画サーバーの系切り替えを実施し、その場をしのぎました。(系切り替え自体はうまく行きました。リソースの兼ね合い上、バックアップ側での録画はワンセグ形式になるので画質は良くないです。）</p>\n<p>さて、次の土日まで、どうにも直す気力がなくて、そのままにしておりました。(NAS側の障害の可能性を当初疑っていましたが、ファイルの作成自体は、問題なくできているので本格的に原因を調査する必要があり、稼働も気力も間に合いませんでした）</p>\n<h2 id=\"障害原因調査-復旧\" style=\"position:relative;\"><a href=\"#%E9%9A%9C%E5%AE%B3%E5%8E%9F%E5%9B%A0%E8%AA%BF%E6%9F%BB-%E5%BE%A9%E6%97%A7\" aria-label=\"障害原因調査 復旧 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>障害原因調査-復旧</h2>\n<p>さて、本格的に本問題を解決する日が来ました。</p>\n<p>まずは再起動。</p>\n<p>とりあえず録画サーバーのプロセス(サービス)を再起動しました。</p>\n<p>録画サーバーでは2つのプロセスが動いています。</p>\n<p>WEB-UIを提供するchinachu-wuiと</p>\n<p>録画や録画予約処理をするchinachu-operator</p>\n<p>それぞれ再起動しましたが事象は解決せず。</p>\n<p>次にサーバー(録画サーバーはKVM上に立てられた仮想マシンです）の再起動。</p>\n<p>とりあえずrebootコマンド。</p>\n<p>解決せず。</p>\n<p>次にNASの再起動</p>\n<p>解決せず。　NASを再起動したので、NASを利用している別サーバーにも念のためログインして使えているか</p>\n<p>確認。（ここが時間かかる。）</p>\n<p>ならばハイパーバイザから仮想マシンの停止・起動だ。</p>\n<p>解決せず。</p>\n<p>ここで飯を食う。（のんきなものです）</p>\n<h2 id=\"物理デバイスと仮想マシンの相性の悪さ\" style=\"position:relative;\"><a href=\"#%E7%89%A9%E7%90%86%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A8%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E7%9B%B8%E6%80%A7%E3%81%AE%E6%82%AA%E3%81%95\" aria-label=\"物理デバイスと仮想マシンの相性の悪さ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>物理デバイスと仮想マシンの相性の悪さ</h2>\n<p>飯を食い終わったとき、ふと気になったことが。</p>\n<p>実はALMが発生した日、別の併発ALMが出ていました。</p>\n<p>録画サーバーで録画したファイルはとても大きいので順次圧縮しています。</p>\n<p>それは別ノード(余ったノートPC)で実行しているのですが、そちらが完全に</p>\n<p>機能停止するALMが上がっていました。</p>\n<p>原因は簡単で、勝手に親が部屋に入り電源周りをいじったか何かで電源が落ちたこと。</p>\n<p>もしかして、チューナ周りもいじったのでは??</p>\n<p>監視サーバー経由でハイパーバイザの仮想マシンマネージャーを確認し、USBのアタッチ状況を確認。</p>\n<p><img src=\"https://i.imgur.com/HQgjVPU.png\" alt=\"img\"></p>\n<p>我が家の仮想基盤サーバーはKVM+QEMU+libvirtと仮想マシンマネージャーというオーソドックスな</p>\n<p>Linuxの仮想基盤となっています。</p>\n<p><img src=\"https://i.imgur.com/VtLyZKK.png\" alt=\"img\"></p>\n<p>仮想マシンの設定を見る限り、USBで確実にアタッチされているみたい。仮想基盤サーバー上の</p>\n<p>USB監視も問題なし。</p>\n<p>まさか。</p>\n<p>実際に録画サーバーに入り、lsusb。</p>\n<p>あ。</p>\n<p>認識されていない。</p>\n<p>原因判明。すぐさま、仮想マシンマネージャー経由でサーバーをシャットダウン。</p>\n<p>設定を入れ直し再度起動。</p>\n<p>録画できた。お疲れ様でした。</p>\n<h2 id=\"振り返り\" style=\"position:relative;\"><a href=\"#%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A\" aria-label=\"振り返り permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>振り返り</h2>\n<p>KVMでの物理デバイスの管理はほぼほぼQEMUが行っている(という認識ですが間違っているかもしれません。たしかKVMのメインのお仕事はCPUリソースの払い出しだったと思います。)</p>\n<p>のですが、そちらの方の設定はUSBリダイレクションではなく、ホストPCのUSBのパススルーで設定しております。</p>\n<p>そちらで一時的にUSBが切り離された場合、仮想基盤側では再組み込みと再割り当てが行われますが、どうやら仮想マシンにまで再割り当てはされないもようです。</p>\n<p>リソースの割り当ては起動前、という原則に則れば、当たり前なのですが…。</p>\n<p>なので、一度切り離されたUSBは(一瞬でも)仮想マシンには戻らない、ということになります。なるほど。</p>\n<p>実はこれだけ原因の切り分けに時間がかかっていましたが、灯台もと暗し。アプリログには以下の文面が。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\n5 Mar 02:04:02 - RECORD: 2017-03-05T02:00:00+0900 [ＴＯＫＹＯ　ＭＸ２] ヒーリン\nグタイム＆ヘッドラインニュース\n5 Mar 02:04:02 - LOCK: PX-S1UD (n=0)\n5 Mar 02:04:02 - SPAWN: recdvb --dev 0 --b25 --strip --sid 23610 20 - - (pid=147\n6)\n5 Mar 02:04:02 - WRITE: /home/tubone/chinachu/data/recording.json\n5 Mar 02:04:02 - STREAM: /media/tv/[170305-0200][20]ヒーリングタイム＆ヘッドライ\nンニュース.m2ts\n5 Mar 02:04:02 - #recdvb: using device: /dev/dvb/adapter0  pid = 1476 cannot open frontend device\n5 Mar 02:04:02 - UNLOCK: PX-S1UD (n=0)\n</code></pre></div>\n<p>そうです。frontend deviceがopenできないという。(Linux特有の表現ですが、デバイスファイルが開けない＝使えないということです。)</p>\n<p>ちなみに、正常時は</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">5 Mar 22:26:55 - STREAM: /media/tv/[170305-2227][20]にゃんこデイズ.m2ts\n5 Mar 22:26:55 - #recdvb: using device: /dev/dvb/adapter0 using pid = 10294 device = /dev/dvb/adapter0/frontend0 Using DVB card \"Siano M\nobile Digital MDTV Receiver\" tuning to 515143 kHz polling..\n</code></pre></div>\n<p>と、デバイスファイルが開ける。</p>\n<p>こんな簡単なログを見落としてたのか。失格ですね。</p>\n<h2 id=\"対策\" style=\"position:relative;\"><a href=\"#%E5%AF%BE%E7%AD%96\" aria-label=\"対策 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>対策</h2>\n<p>今後、このような障害を起こさないように以下の対策をします。</p>\n<p>まず、lsusb監視を仮想サーバーそばにもつけるようにします。(今週中)</p>\n<p>アプリログについて、監視文言に<strong>cannot open frontend device</strong>を加えます。</p>\n<p>また、それ以外にも明示的にErrorと表記されないものについて見直しをし、</p>\n<p>Zabbixに挙げられるようにします。(3月中)</p>\n<p>さらに、監視サーバー上のVNCの解像度が低く、仮想マシンマネージャーの操作に難があり、</p>\n<p>一部virshコマンド等でオペレーションをしておりました。画面解像度の見直しをします。(対策済み)</p>\n<p>サービスを守る。という使命感が乏しかったので、今後はサーバー優先の生活をするように担当者(自分)に言い聞かせました。</p>\n<p>以上。</p>\n<!-- textlint-enable -->","fields":{"slug":"2017/03/05/disaster"},"frontmatter":{"tags":["仮想化","Chinachu","KVM"],"templateKey":"blog-post","slug":"2017/03/05/disaster","id":null,"title":"大障害再び","url":"2017/03/05/disaster","date":"2017-03-04T16:28:27.180Z","description":"安定稼働しないtuboneのサーバ周り","headerImage":"https://i.imgur.com/HQgjVPU.png","year":"2017","month":"03"}}},{"node":{"id":"592ebc96-2958-511f-81ed-96fe26d586da","html":"<p>どうも。</p>\n<p>今のメインギターですが、とても満足してます。 使用機材はこちらを見てください。</p>\n<p>満足すぎて頭おかしなるくらい満足です。音は。</p>\n<p>唯一あかんところがあるとしたらフロイドローズってところです。</p>\n<p>こいつのせいで、チューニングがおっくうになり、気軽にチューニングドロップさせた曲を弾こうとも思わなくなってしまったわけです。</p>\n<p>さらに、今のギターは弦高をレギュラーチューニングでべたべたにしてますから、</p>\n<p>そこら辺の調整とかも面倒なわけですわ。</p>\n<p>そこで思ったわけです。</p>\n<p><strong>2下げまで許容できるギターを買おうと</strong></p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88\">基本コンセプト</a></li>\n<li><a href=\"#%E6%86%A7%E3%82%8C%E3%81%AEdellinger%E6%8C%81%E3%81%A1%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F\">憧れのDellinger持ちになりました。</a></li>\n<li><a href=\"#%E8%B2%B7%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%A3%E3%81%9F%E3%82%88dellinger%E3%82%92\">買ってしまったよ、Dellingerを</a></li>\n<li><a href=\"#%E6%8E%A1%E7%82%B9\">採点</a></li>\n<li><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\">終わりに</a></li>\n</ul>\n</div>\n<h2 id=\"基本コンセプト\" style=\"position:relative;\"><a href=\"#%E5%9F%BA%E6%9C%AC%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88\" aria-label=\"基本コンセプト permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>基本コンセプト</h2>\n<p>こんなギターがほしい。</p>\n<ul>\n<li>\n<p>チューニングが安定しているもの</p>\n</li>\n<li>\n<p>2下げまで許容できるタイプ</p>\n</li>\n<li>\n<p>メタル系かアニソンしか弾かないので、歪ませても粒がたつもの</p>\n</li>\n<li>\n<p>今のメインギターと趣向が異なるもの</p>\n</li>\n</ul>\n<p>探しました。ありました。</p>\n<p>というよりは、偶然の出会いでした。</p>\n<h2 id=\"憧れのdellinger持ちになりました\" style=\"position:relative;\"><a href=\"#%E6%86%A7%E3%82%8C%E3%81%AEdellinger%E6%8C%81%E3%81%A1%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F\" aria-label=\"憧れのdellinger持ちになりました permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>憧れのDellinger持ちになりました。</h2>\n<p>YouTube、ニコ動で「まくまく」さんって方が昔演奏していて、</p>\n<p>見事なテクニックとかわいさで当時の僕をくぎ付けにしていました。</p>\n<p>もう本当にかわいくて、はっきり言ってドタイプなんですが、（性別の話はNG）</p>\n<p>ギターサウンドも大好きでした。</p>\n<iframe loading=\"lazy\" width=\"200\" height=\"113\" src=\"https://www.youtube.com/embed/6WtUMZwVq8o?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen title=\"【まくまく】future　gazer　を弾いてみた【とある科学の超電磁砲】\"></iframe>\n<p>この人です。かわいいでしょ。</p>\n<p>憧れの人を見つけると人間は不思議なものです。その人の身に着けているものが、</p>\n<p>ほしくなったりします。</p>\n<p>当時の僕は、大金を叩いてまくまくさん使用機材を買いあさります。参考文献は彼女（？）の<a href=\"http://ameblo.jp/makotosound/entry-10325835408.html\" target=\"_blank\" rel=\"noopener noreferrer\">ブログ</a></p>\n<p>今考えると機材にハマりだしたのもこの頃からだと思います。</p>\n<p>また、まくまくさんのおかげでマティアス・エルクンドにはまるということも経験しました。</p>\n<p>プラグインのギターアンプシミュレータである「Guitar Rig5 pro」</p>\n<p>ギターシンセの「GR-55」とか、とにかく買いまくりました。</p>\n<p>Guitar rig5 proはいまだに使い続けてますし、「GR-55」もたまにライブで使うので、</p>\n<p>買って正解だったと思いますが、肝心の「まくまく」さん使用ギターである、</p>\n<p>「Caparison Dellinger」の購入については、金が底をつきたことで諦めてしまいました。</p>\n<p><del>当時は若くてお金が必要でした。</del></p>\n<p>そのうちに、今のメインギターとの出会いや、萌え豚化などの影響で、</p>\n<p>その夢はすっかり忘れてしまいました。</p>\n<h2 id=\"買ってしまったよdellingerを\" style=\"position:relative;\"><a href=\"#%E8%B2%B7%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%A3%E3%81%9F%E3%82%88dellinger%E3%82%92\" aria-label=\"買ってしまったよdellingerを permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>買ってしまったよ、Dellingerを</h2>\n<p>何と言いますか。憧れの、大好きなあの子と街で偶然会って、</p>\n<p>その瞬間なぜか、街の雑音が消え、二人だけに焦点が合い、</p>\n<p>冬のソナタ的なBGMが流れる…　あの感じです。</p>\n<p>あ、まくまくさん。好きでした！ずっと好きでした!!</p>\n<p><img src=\"https://i.imgur.com/WUQxt7v.jpg\" alt=\"inmg\"></p>\n<p>買ってしまいました。Dellinger.</p>\n<p><strong>Caparison Dellinger Ⅱ FX-BKM CL-ML50 Natural Matt</strong></p>\n<p>あこがれのCustom Lineです！吸うと有毒らしい材を使っているとか使っていないとか。（そこら辺はパドゥーク材でググってみよう）</p>\n<p><img src=\"https://i.imgur.com/2gMQqhx.jpg\" alt=\"img\"></p>\n<p>材とかそこら辺のうんちくは嫌われるのでここまでにしておいて、</p>\n<p>まくまくさんが我が家にやってきたと言うわけです。（やってきてはいない）</p>\n<p>ただまくまくさんが利用しているDellingerに比べ、音のこしは少ない気がします。（材の影響）</p>\n<p>Dellingerがメタラー向けギターと形容されるならその特徴をよく表したギターですが、</p>\n<p>まくまくさんのそれとは少し違う気がします。まぁ材が違うので当たり前なのですが。</p>\n<p>その代わりに、音の粒立ちが異常なくらいよくて、ハイゲインにも耐えられるというよりメタラー向けな構造となっています。</p>\n<p>また、Dellingerらしい、まくまくさん曰くトンガリヘッドもかわいらしいですね。</p>\n<p><img src=\"https://i.imgur.com/ljGZ2IQ.jpg\" alt=\"img\"></p>\n<p>キャパリソン、カスタムラインと入ってますね。</p>\n<h2 id=\"採点\" style=\"position:relative;\"><a href=\"#%E6%8E%A1%E7%82%B9\" aria-label=\"採点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>採点</h2>\n<ul>\n<li>\n<p>チューニングが安定しているもの ⇒◎　がっちりロック！アームなんてものはなかった。</p>\n</li>\n<li>\n<p>2下げまで許容できるタイプ ⇒◎　基本2下げで使う設計らしい。あと低音もパコーンと出るので音の輪郭がはっきり聞こえるのでドロップ向け</p>\n</li>\n<li>\n<p>メタル系かアニソンしか弾かないので、歪ませても粒がたつもの ⇒○　粒立ちが最大の魅力。　一方トラディショナルな音はかなり苦手っぽい。</p>\n</li>\n<li>\n<p>今のメインギターと趣向が異なるもの ⇒○　メインギターは基本同じような歪みに対して輪郭が出るタイプだけど、中音域の粘りが特徴一方これは中音域の粘りを犠牲にして粒立ちを優先したようなコンセプト。</p>\n</li>\n</ul>\n<p>弱点もあります。</p>\n<p>それはソロに弱いと言うこと。（中音域に粘りが全くない）</p>\n<p>まぁそこはメインギターが得意なところなので気にしていませんが。</p>\n<p>ライブでは工夫が必要かも知れないな。</p>\n<h2 id=\"終わりに\" style=\"position:relative;\"><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\" aria-label=\"終わりに permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>終わりに</h2>\n<p>まくまくさん、動画あげてください!</p>","fields":{"slug":"2017/01/15/new-my-gear"},"frontmatter":{"tags":["音楽","ギター"],"templateKey":"blog-post","slug":"2017/01/15/new-my-gear","id":null,"title":"New my gear...","url":"2017/01/15/new-my-gear","date":"2017-01-14T15:44:46.720Z","description":"New my gear...","headerImage":"https://i.imgur.com/WUQxt7v.jpg","year":"2017","month":"01"}}},{"node":{"id":"d4d54896-0e1f-56c2-932c-f4d7e7533c97","html":"<h1 id=\"test投稿\" style=\"position:relative;\"><a href=\"#test%E6%8A%95%E7%A8%BF\" aria-label=\"test投稿 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test投稿</h1>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E6%96%87%E7%AB%A0\">文章</a></p>\n<ul>\n<li>\n<p><a href=\"#%E3%83%9D%E3%83%A9%E3%83%BC%E3%83%8E%E3%81%AE%E5%BA%83%E5%A0%B4\">ポラーノの広場</a></p>\n<ul>\n<li><a href=\"#%E5%AE%AE%E6%B2%A2%E8%B3%A2%E6%B2%BB\">宮沢賢治</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%BC%95%E7%94%A8\">引用</a></p>\n<ul>\n<li><a href=\"#%E5%90%BE%E8%BC%A9%E3%81%AF%E7%8C%AB%E3%81%A7%E3%81%82%E3%82%8B\">吾輩は猫である</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#oembed\">oEmbed</a></p>\n<ul>\n<li><a href=\"#youtube\">YouTube</a></li>\n<li><a href=\"#twitter\">Twitter</a></li>\n<li><a href=\"#soundcloud\">SoundCloud</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#code\">Code</a></p>\n</li>\n<li>\n<p><a href=\"#footnote\">footnote</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"文章\" style=\"position:relative;\"><a href=\"#%E6%96%87%E7%AB%A0\" aria-label=\"文章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文章</h2>\n<h3 id=\"ポラーノの広場\" style=\"position:relative;\"><a href=\"#%E3%83%9D%E3%83%A9%E3%83%BC%E3%83%8E%E3%81%AE%E5%BA%83%E5%A0%B4\" aria-label=\"ポラーノの広場 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ポラーノの広場</h3>\n<h4 id=\"宮沢賢治\" style=\"position:relative;\"><a href=\"#%E5%AE%AE%E6%B2%A2%E8%B3%A2%E6%B2%BB\" aria-label=\"宮沢賢治 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>宮沢賢治</h4>\n<p>あのイーハトーヴォのすきとおった風、夏でも底に冷たさをもつ青いそら、うつくしい森で飾られたモリーオ市、郊外のぎらぎらひかる草の波。</p>\n<p>またそのなかでいっしょになったたくさんのひとたち、ファゼーロとロザーロ、羊飼のミーロや、顔の赤いこどもたち、地主のテーモ、山猫博士のボーガント・デストゥパーゴなど、いまこの暗い巨きな石の建物のなかで考えていると、みんなむかし風のなつかしい青い幻燈のように思われます。では、わたくしはいつかの小さなみだしをつけながら、しずかにあの年のイーハトーヴォの五月から十月までを書きつけましょう。</p>\n<h3 id=\"引用\" style=\"position:relative;\"><a href=\"#%E5%BC%95%E7%94%A8\" aria-label=\"引用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>引用</h3>\n<h4 id=\"吾輩は猫である\" style=\"position:relative;\"><a href=\"#%E5%90%BE%E8%BC%A9%E3%81%AF%E7%8C%AB%E3%81%A7%E3%81%82%E3%82%8B\" aria-label=\"吾輩は猫である permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>吾輩は猫である</h4>\n<blockquote>\n<p>　吾輩わがはいは猫である。名前はまだ無い。</p>\n<p>どこで生れたかとんと見当けんとうがつかぬ。</p>\n<p>何でも薄暗いじめじめしたところでニャーニャー泣いていた事だけは記憶している。</p>\n<p>吾輩はここで始めて人間というものを見た。しかもあとで聞くとそれは書生という人間中で一番獰悪どうあくな種族であったそうだ。この書生というのは時々我々を捕つかまえて煮にて食うという話である。</p>\n<p>しかしその当時は何という考もなかったから別段恐しいとも思わなかった。ただ彼の掌てのひらに載せられてスーと持ち上げられたとき何だかフワフワした感じがあったばかりである。掌の上で少し落ちついて書生の顔を見たのがいわゆる人間というものの見始みはじめであろう。</p>\n<p>この時妙なものだと思った感じが今でも残っている。第一毛をもって装飾されべきはずの顔がつるつるしてまるで薬缶やかんだ。その後ご猫にもだいぶ逢あったがこんな片輪かたわには一度も出会でくわしたことがない。のみならず顔の真中があまりに突起している。</p>\n<p>そうしてその穴の中から時々ぷうぷうと煙けむりを吹く。どうも咽むせぽくて実に弱った。これが人間の飲む煙草たばこというものであることはようやくこの頃知った。</p>\n</blockquote>\n<h3 id=\"oembed\" style=\"position:relative;\"><a href=\"#oembed\" aria-label=\"oembed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>oEmbed</h3>\n<h4 id=\"youtube\" style=\"position:relative;\"><a href=\"#youtube\" aria-label=\"youtube permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>YouTube</h4>\n<iframe loading=\"lazy\" width=\"200\" height=\"113\" src=\"https://www.youtube.com/embed/Clxd5ZxRGM0?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen title=\"絶望の淵から @ フリーBGM DOVA-SYNDROME OFFICIAL YouTube CHANNEL\"></iframe>\n<h4 id=\"twitter\" style=\"position:relative;\"><a href=\"#twitter\" aria-label=\"twitter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Twitter</h4>\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">【デレステ4周年カウントダウン】<br>4周年まであと「2日」です！<br>本日は杏仁豆腐先生より、黒埼ちとせちゃん、白雪千夜ちゃん、久川凪ちゃん、久川颯ちゃん、辻野あかりちゃん、砂塚あきらちゃん、夢見りあむちゃんのイラストをいただきました！<a href=\"https://twitter.com/hashtag/%E3%83%87%E3%83%AC%E3%82%B9%E3%83%86?src=hash&amp;ref_src=twsrc%5Etfw\">#デレステ</a> <a href=\"https://twitter.com/hashtag/%E3%83%87%E3%83%AC%E3%82%B9%E3%83%864%E5%91%A8%E5%B9%B4?src=hash&amp;ref_src=twsrc%5Etfw\">#デレステ4周年</a> <a href=\"https://t.co/Y9G7uOB6PV\">pic.twitter.com/Y9G7uOB6PV</a></p>&mdash; スターライトステージ (@imascg_stage) <a href=\"https://twitter.com/imascg_stage/status/1167814328797450241?ref_src=twsrc%5Etfw\">August 31, 2019</a></blockquote>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<h4 id=\"soundcloud\" style=\"position:relative;\"><a href=\"#soundcloud\" aria-label=\"soundcloud permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SoundCloud</h4>\n<iframe loading=\"lazy\" width=\"100%\" height=\"400\" scrolling=\"no\" frameborder=\"no\" src=\"https://w.soundcloud.com/player/?visual=true&url=https%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F250107568&show_artwork=true\"></iframe>\n<h3 id=\"code\" style=\"position:relative;\"><a href=\"#code\" aria-label=\"code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code</h3>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 4\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// In your gatsby-config.js</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></span>  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-prismjs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber 0\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link<span class=\"token punctuation\">,</span> withPrefix <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> Tag <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/components/Tag\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> parseImgur<span class=\"token punctuation\">,</span> SizeMapping <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/utils/images\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> style <span class=\"token keyword\">from</span> <span class=\"token string\">\"./index.module.scss\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CardHeader</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n  url<span class=\"token punctuation\">,</span>\n  image<span class=\"token punctuation\">,</span>\n  title<span class=\"token punctuation\">,</span>\n  index<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">image</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>visually-hidden<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n          <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>wrapper <span class=\"token operator\">+</span> <span class=\"token string\">\" lozad\"</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">data-background-image</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">parseImgur</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> SizeMapping<span class=\"token punctuation\">.</span>large<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">aria-hidden</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>visually-hidden<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n        <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>wrapper<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">backgroundImage</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> url(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">parseImgur</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> SizeMapping<span class=\"token punctuation\">.</span>large<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">aria-hidden</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Card</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n  title<span class=\"token punctuation\">,</span>\n  date<span class=\"token punctuation\">,</span>\n  url<span class=\"token punctuation\">,</span>\n  headerImage<span class=\"token punctuation\">,</span>\n  description<span class=\"token punctuation\">,</span>\n  tags <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  index<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">headerImage</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">tags</span><span class=\"token operator\">:</span> <span class=\"token function\">readonly</span> <span class=\"token punctuation\">(</span>string <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-sm-12 pb-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>customCard<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>headerImage <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardHeader</span></span>\n          <span class=\"token attr-name\">url</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">withPrefix</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">image</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>headerImage<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">index</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>dataContent<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>stats<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>date<span class=\"token operator\">?.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"T\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span>tags<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n              <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tag</span></span> <span class=\"token attr-name\">name</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>name <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">withPrefix</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>description<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">withPrefix</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">....Read more....</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Card<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=alice data-host=dev.localhost></span></span><span class=\"token function\">npm</span> run build</code></pre></div>\n<h3 id=\"footnote\" style=\"position:relative;\"><a href=\"#footnote\" aria-label=\"footnote permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>footnote</h3>\n<p>This is normal body copy.<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> It includes a couple footnotes.<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">This is a footnote.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">This is another footnote.<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/2011/08/30"},"frontmatter":{"tags":["test"],"templateKey":"blog-post","slug":"/2011/08/30","id":"test site","title":"このBlogテンプレートのテスト用投稿","url":"/2011/08/30","date":"2011-08-30T03:48:03.125Z","description":"テスト投稿","headerImage":"https://i.imgur.com/6B7WC7D.jpg","year":"2011","month":"08"}}}],"pathPrefix":"pages","first":false,"last":true,"index":11,"pageCount":11,"additionalContext":{"totalCount":110}}},"staticQueryHashes":["2959249232"]}