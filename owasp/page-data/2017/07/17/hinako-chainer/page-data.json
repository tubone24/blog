{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2017/07/17/hinako-chainer","result":{"data":{"content":{"edges":[{"node":{"id":"83721a31-04f1-5527-a1c4-0fdfc37b7f50","excerpt":"(過去ブログからの移転した記事です) くいなちゃんのかわいさで僕は満足です。 どうも。ひなこのーと、よかったです。かわいかったです。でも、ひなこのーとを見ているとき、いろんな人からこんなことを言われました。 Table of Contents…","fields":{"slug":"2017/07/17/hinako-chainer"},"frontmatter":{"id":null,"title":"大きく吸ってせーの！ で・ぃ・ぷ・ら・ん・に・ん・ぐ！　～ひなこのーと×Deep Learning～","slug":"2017/07/17/hinako-chainer","date":"2017-07-17T07:58:03.868Z","headerImage":"https://i.imgur.com/1tudTrI.png","tags":["Python","Chainer","ひなこのーと","Deep Learing","OpenCV","機械学習","CNN","分類学習","顔認識"]}}}]}},"pageContext":{"id":"83721a31-04f1-5527-a1c4-0fdfc37b7f50","index":101,"repHtml":"<p>(過去ブログからの移転した記事です)</p>\n<p>くいなちゃんのかわいさで僕は満足です。</p>\n<p>どうも。ひなこのーと、よかったです。かわいかったです。でも、ひなこのーとを見ているとき、いろんな人からこんなことを言われました。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%A3%E3%81%A6%E3%82%A8%E3%83%AD%E3%81%84%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%98%E3%82%83%E3%81%AD\">ひなこのーとって、エロいごちうさじゃね？</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\">前提条件</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%97%E3%81%9F%E8%80%83%E5%AF%9F\">ちょっとした考察</a></p>\n<ul>\n<li><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8\">ひなこのーと</a></li>\n<li><a href=\"#%E3%81%94%E3%81%A1%E3%81%86%E3%81%95\">ごちうさ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82deep-learning%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\">「ひなこのーと」もDeep Learningやってみる</a></p>\n<ul>\n<li>\n<p><a href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\">下準備</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\">学習させる</a></p>\n<ul>\n<li><a href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\">モデル定義</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%AD%A6%E7%BF%92%E7%B5%90%E6%9E%9C\">学習結果</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%B8%BB%E8%A6%81%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AE%E5%88%86%E9%A1%9E%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B\">主要キャラの分類モデルを作成し、イラストを読み込ませて判定する</a></p>\n<ul>\n<li><a href=\"#%E5%AE%9F%E9%9A%9B%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%82%8B\">実際、読み込ませる</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A7%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AB%E5%88%86%E9%A1%9E%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\">できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する</a></p>\n<ul>\n<li><a href=\"#%E7%B5%B5%E3%81%AE%E3%82%BF%E3%83%83%E3%83%81%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\">絵のタッチを変えてみる</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%91%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%A7%E8%AA%8D%E8%AD%98%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\">おまけ１　ひなこのーともイラストで認識させてみる</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%92-%E3%81%8F%E3%81%84%E3%81%AA%E3%81%A1%E3%82%83%E3%82%93%E6%9F%90%E3%82%AA%E3%82%BF%E3%82%AF%E5%B0%91%E5%A5%B3%E3%81%AB%E4%BC%BC%E3%81%A6%E3%81%84%E3%82%8B%E8%AA%AC%E3%82%92%E7%A2%BA%E3%81%8B%E3%82%81%E3%82%8B\">おまけ２ くいなちゃん、某オタク少女に似ている説を確かめる。</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"ひなこのーとってエロいごちうさじゃね\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%A3%E3%81%A6%E3%82%A8%E3%83%AD%E3%81%84%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%98%E3%82%83%E3%81%AD\" aria-label=\"ひなこのーとってエロいごちうさじゃね permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ひなこのーとって、エロいごちうさじゃね？</h2>\n<p>はぁああああああん!?</p>\n<p>可愛いという共通点は認めるし、ごちうさは女神の生まれ変わりだと思っているが、ひなこのーとはごちうさとは違うすばらしさがある！ということで、Deep Learningを使って以下のことをやってみたいと思います。</p>\n<ol>\n<li>\n<p><a href=\"http://showyou.hatenablog.com/entry/2015/05/24/174621\" target=\"_blank\" rel=\"noopener noreferrer\">きんいろDeepLearning</a>や<a href=\"http://kivantium.hateblo.jp/entry/2015/02/20/214909\" target=\"_blank\" rel=\"noopener noreferrer\">ご注文はDeep Learningですか？</a>　など、可愛いアニメは必ずDeep Learningの餌食になると思うので、「ひなこのーと」もDeep Learningやってみる。</p>\n</li>\n<li>\n<p>アニメひなこのーとの可愛い動画を読み込ませて、主要キャラの分類モデルを作成し、イラストを読み込ませて判定する。</p>\n</li>\n<li>\n<p>できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する。</p>\n</li>\n</ol>\n<h2 id=\"前提条件\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\" aria-label=\"前提条件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前提条件</h2>\n<ul>\n<li>Python2.7(Anaconda3で仮想環境作成)</li>\n<li>Windows 7</li>\n<li>CPUオンリー</li>\n</ul>\n<h2 id=\"ちょっとした考察\" style=\"position:relative;\"><a href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%97%E3%81%9F%E8%80%83%E5%AF%9F\" aria-label=\"ちょっとした考察 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ちょっとした考察</h2>\n<p>本当にひなこのーとと、ごちうさは似ているのか、雰囲気だけではないか、よく考えて欲しい。</p>\n<h3 id=\"ひなこのーと\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8\" aria-label=\"ひなこのーと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ひなこのーと</h3>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/dIY5jEJ.jpg\" alt=\"img\"></p>\n<h3 id=\"ごちうさ\" style=\"position:relative;\"><a href=\"#%E3%81%94%E3%81%A1%E3%81%86%E3%81%95\" aria-label=\"ごちうさ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ごちうさ</h3>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/E6l9miS.jpg\" alt=\"img\"></p>\n<h2 id=\"ひなこのーともdeep-learningやってみる\" style=\"position:relative;\"><a href=\"#%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82deep-learning%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"ひなこのーともdeep learningやってみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>「ひなこのーと」もDeep Learningやってみる</h2>\n<h3 id=\"下準備\" style=\"position:relative;\"><a href=\"#%E4%B8%8B%E6%BA%96%E5%82%99\" aria-label=\"下準備 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>下準備</h3>\n<p>Deep Learningの難しいところは、とにかく大量のトレーニングデータが必要になるところであります。</p>\n<p>途方に暮れていたところ、すばらしいスクリプトがあったので使わせていただきます。</p>\n<p><a href=\"https://torina.top/detail/331/\" target=\"_blank\" rel=\"noopener noreferrer\">Python、OpenCVで顔の検出（アニメ）\n</a></p>\n<p>こちらのスクリプトをそのまま使ってひなこのーとの1～12話から顔という顔を切り抜こう！</p>\n<p>その際、<a href=\"http://ultraist.hatenablog.com/entry/20110718/1310965532\" target=\"_blank\" rel=\"noopener noreferrer\">OpenCVによるアニメ顔検出ならlbpcascade_animeface.xml</a>のすばらしい設定ファイルを活用します。</p>\n<p>このXMLは後々使いますので、その際また。</p>\n<p>そして、切り抜いた顔をそれぞれのキャラごとにフォルダに移します。（手作業）</p>\n<p>こんな感じ。 50×50の可愛い画像がたくさん！</p>\n<p>データセットはそれぞれ</p>\n<ul>\n<li>ひなこ1164枚</li>\n<li>くいな678枚</li>\n<li>まゆき563枚</li>\n<li>ゆあ541枚</li>\n<li>ちあき536枚</li>\n<li>その他5493枚</li>\n</ul>\n<p>です。少ない。。。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/qfwNwpQ.png\" alt=\"img\"></p>\n<h3 id=\"学習させる\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E3%81%95%E3%81%9B%E3%82%8B\" aria-label=\"学習させる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習させる</h3>\n<p>ご注文はDeep Learningですか？は、Caffeを使っていますが、自分はChainerの方がなじみあるので、Chainerを使っていきます。</p>\n<p>と言ってももうすでに化物語で同じことをやっていた人がいたので、モデル定義と学習、予測のコードをお借りしました。</p>\n<p><a href=\"https://www.mathgram.xyz/entry/chainer/bake/part5.5_1\" target=\"_blank\" rel=\"noopener noreferrer\">python: chainerを使って化物語キャラを認識させるよ！ 〜part5.5 主要キャラで多値分類(改良編)〜</a></p>\n<p>今回は、ひなこ・くいな・まゆき・ゆあ・ちあき・その他の計6つの分類になりますので、モデル定義などのパラメータのみ変更しています。</p>\n<h4 id=\"モデル定義\" style=\"position:relative;\"><a href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\" aria-label=\"モデル定義 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>モデル定義</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#coding:utf-8</span>\n\n<span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>links <span class=\"token keyword\">as</span> L\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">clf_hinako</span><span class=\"token punctuation\">(</span>chainer<span class=\"token punctuation\">.</span>Chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>clf_hinako<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span>\n            conv1 <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Convolution2D<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> pad<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            conv2 <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Convolution2D<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> pad<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            l3    <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">6272</span><span class=\"token punctuation\">,</span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            l4    <span class=\"token operator\">=</span>  F<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#ここを6にしました</span>\n        <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>loss <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n        self<span class=\"token punctuation\">.</span>accuracy <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> X_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>clear<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        X_data <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>X_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token keyword\">not</span> train<span class=\"token punctuation\">)</span>\n        y_data <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token keyword\">not</span> train<span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv1<span class=\"token punctuation\">(</span>X_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv2<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>dropout<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l3<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span>train<span class=\"token punctuation\">)</span>\n        y <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>l4<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> F<span class=\"token punctuation\">.</span>softmax_cross_entropy<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> F<span class=\"token punctuation\">.</span>accuracy<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">)</span></code></pre></div>\n<p>モデル定義に合わせて分類の数を変更し、画像の枚数に合わせて学習用、テスト用画像の枚数などを調整しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#coding: utf-8</span>\n\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> six\n<span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>links <span class=\"token keyword\">as</span> L\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n<span class=\"token keyword\">from</span> clf_hinako_model <span class=\"token keyword\">import</span> clf_hinako\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">getDataSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_train <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nX_test <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ny_train <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ny_test <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\npath <span class=\"token operator\">=</span> “dataset<span class=\"token operator\">/</span>”\n<span class=\"token keyword\">if</span> i <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">5493</span> <span class=\"token comment\"># その他の画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">5393</span> <span class=\"token comment\"># 内100枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">1164</span> <span class=\"token comment\"># ひなこの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">1139</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">678</span> <span class=\"token comment\"># くいなの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">653</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">563</span> <span class=\"token comment\"># まゆきの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">538</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">541</span> <span class=\"token comment\"># ゆあの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">516</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\n<span class=\"token keyword\">elif</span> i <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\ncutNum <span class=\"token operator\">=</span> <span class=\"token number\">536</span> <span class=\"token comment\"># ちあきの画像数です。</span>\ncutNum2 <span class=\"token operator\">=</span> <span class=\"token number\">511</span> <span class=\"token comment\"># 内25枚をテスト用にします。</span>\n\nimgList <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>path<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nimgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>imgList<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>cutNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\nimgSrc <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>path<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>”<span class=\"token operator\">/</span>”<span class=\"token operator\">+</span>imgList<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> imgSrc <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">continue</span>\n<span class=\"token keyword\">if</span> j <span class=\"token operator\">&lt;</span> cutNum2<span class=\"token punctuation\">:</span>\nX_train<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>imgSrc<span class=\"token punctuation\">)</span>\ny_train<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\nX_test<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>imgSrc<span class=\"token punctuation\">)</span>\ny_test<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">return</span> X_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">,</span>X_test<span class=\"token punctuation\">,</span>y_test\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">train</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">,</span>X_test<span class=\"token punctuation\">,</span>y_test <span class=\"token operator\">=</span> getDataSet<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nX_train <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\ny_train <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>int32<span class=\"token punctuation\">)</span>\nX_test <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\ny_test <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>int32<span class=\"token punctuation\">)</span>\n\nmodel <span class=\"token operator\">=</span> clf_hinako<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer <span class=\"token operator\">=</span> optimizers<span class=\"token punctuation\">.</span>Adam<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer<span class=\"token punctuation\">.</span>setup<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span>\n\nepochNum <span class=\"token operator\">=</span> <span class=\"token number\">30</span>\nbatchNum <span class=\"token operator\">=</span> <span class=\"token number\">50</span>\nepoch <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">while</span> epoch <span class=\"token operator\">&lt;=</span> epochNum<span class=\"token punctuation\">:</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>“epoch<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>”<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>epoch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ntrainImgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">)</span>\ntestImgNum <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">)</span>\n\nsumAcr <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nsumLoss <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\nperm <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>permutation<span class=\"token punctuation\">(</span>trainImgNum<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> six<span class=\"token punctuation\">.</span>moves<span class=\"token punctuation\">.</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> trainImgNum<span class=\"token punctuation\">,</span> batchNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\nX_batch <span class=\"token operator\">=</span> X_train<span class=\"token punctuation\">[</span>perm<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\ny_batch <span class=\"token operator\">=</span> y_train<span class=\"token punctuation\">[</span>perm<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\noptimizer<span class=\"token punctuation\">.</span>zero_grads<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nloss<span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>X_batch<span class=\"token punctuation\">,</span> y_batch<span class=\"token punctuation\">)</span>\nloss<span class=\"token punctuation\">.</span>backward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noptimizer<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nsumLoss <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\nsumAcr <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>‘train mean loss<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> accuracy<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>’<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>sumLoss <span class=\"token operator\">/</span> trainImgNum<span class=\"token punctuation\">,</span> sumAcr <span class=\"token operator\">/</span> trainImgNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nsumAcr <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nsumLoss <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> six<span class=\"token punctuation\">.</span>moves<span class=\"token punctuation\">.</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> testImgNum<span class=\"token punctuation\">,</span> batchNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\nX_batch <span class=\"token operator\">=</span> X_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span>\ny_batch <span class=\"token operator\">=</span> y_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i<span class=\"token operator\">+</span>batchNum<span class=\"token punctuation\">]</span>\nloss<span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>X_batch<span class=\"token punctuation\">,</span> y_batch<span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\nsumLoss <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\nsumAcr <span class=\"token operator\">+=</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>y_batch<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>‘test mean loss<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> accuracy<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>’<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\nsumLoss <span class=\"token operator\">/</span> testImgNum<span class=\"token punctuation\">,</span> sumAcr <span class=\"token operator\">/</span> testImgNum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nepoch <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\nS<span class=\"token punctuation\">.</span>save_hdf5<span class=\"token punctuation\">(</span>‘model’<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>epoch<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"学習結果\" style=\"position:relative;\"><a href=\"#%E5%AD%A6%E7%BF%92%E7%B5%90%E6%9E%9C\" aria-label=\"学習結果 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>学習結果</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>py27con<span class=\"token punctuation\">)</span> C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>tubone<span class=\"token punctuation\">\\</span>PycharmProjects<span class=\"token punctuation\">\\</span>anime-learn<span class=\"token operator\">></span>python train.py\nepoch: <span class=\"token number\">1</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:40:03.060000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">1.16183573621</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.619771432281</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">1.05560781558</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.506666666104</span>\nepoch: <span class=\"token number\">2</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:42:13.192000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.800489272901</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.69348571573</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.871727473206</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.577777779765</span>\nepoch: <span class=\"token number\">3</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:44:23.290000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.698785139833</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.743085714408</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.780110951927</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.631111116873</span>\nepoch: <span class=\"token number\">4</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:46:33.502000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.597107084649</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.786971424307</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.548737568988</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.83111111323</span>\nepoch: <span class=\"token number\">5</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:48:44.037000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.500077148761</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.82479999406</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.480820135938</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.857777780957</span>\nepoch: <span class=\"token number\">6</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:50:57.706000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.451180534618</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.841257137571</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.448005066978</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87555554178</span>\nepoch: <span class=\"token number\">7</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:53:09.992000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.405994535514</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.861028568063</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.472903796368</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.835555553436</span>\nepoch: <span class=\"token number\">8</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:55:22.262000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.358310819779</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87851428066</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.306394663122</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.911111103164</span>\nepoch: <span class=\"token number\">9</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:57:34.985000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.337241342791</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.880799995831</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.308397501707</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.902222216129</span>\nepoch: <span class=\"token number\">10</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">21</span>:59:47.595000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.324274266022</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.886742852415</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.323723706934</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.871111101574</span>\nepoch: <span class=\"token number\">11</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:01:59.865000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.296059874466</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.897142853737</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.390861597326</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.848888880677</span>\nepoch: <span class=\"token number\">12</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:04:12.384000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.28229231613</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.900799994469</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.381249505613</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.888888888889</span>\nepoch: <span class=\"token number\">13</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:06:25.189000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.242525527115</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.915771426473</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.304150695602</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666656335</span>\nepoch: <span class=\"token number\">14</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:08:37.995000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.231497560718</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919314283303</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.275258473224</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666662958</span>\nepoch: <span class=\"token number\">15</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:10:50.532000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.219778511652</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.923199997629</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.354618171851</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.91555554337</span>\nepoch: <span class=\"token number\">16</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:13:02.623000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.218345963359</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.926285712378</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.36049440172</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.897777775923</span>\nepoch: <span class=\"token number\">17</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:15:15.105000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.199432469181</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.933599996226</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.403067363633</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.87555554178</span>\nepoch: <span class=\"token number\">18</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:17:27.614000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.188562800608</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.936114283289</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.316384883391</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.911111109787</span>\nepoch: <span class=\"token number\">19</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:19:40.506000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.187215176012</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.933028570243</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.360161377324</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666676203</span>\nepoch: <span class=\"token number\">20</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:21:53.107000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.165474589265</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.94388571058</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.282101011939</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">21</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:24:05.521000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.153822022751</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.947999996117</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.33798650321</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">22</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:26:18.048000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.140677581344</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.952228568281</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.309250995517</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.924444450272</span>\nepoch: <span class=\"token number\">23</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:28:30.608000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.138967069973</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.951314284801</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.488151417838</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.871111101574</span>\nepoch: <span class=\"token number\">24</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:30:43.540000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.150780805051</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.945828568935</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.305154048734</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.924444450272</span>\nepoch: <span class=\"token number\">25</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:32:55.811000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.133075305953</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.952799998692</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.421937998798</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.906666662958</span>\nepoch: <span class=\"token number\">26</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:35:08.076000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.119467954348</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.954514285156</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.384507967366</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.902222222752</span>\nepoch: <span class=\"token number\">27</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:37:20.527000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.138162662153</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.949028568949</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.317712697718</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.928888883856</span>\nepoch: <span class=\"token number\">28</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:39:32.964000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.114523774907</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.961485714912</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.39709764719</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.919999996821</span>\nepoch: <span class=\"token number\">29</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:41:45.211000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.120365411943</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.958171426228</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.379737239745</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.93333334393</span>\nepoch: <span class=\"token number\">30</span>\n<span class=\"token number\">2017</span>-07-16 <span class=\"token number\">22</span>:43:57.336000\ntrain mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.110197391031</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.958742856298</span>\n<span class=\"token builtin class-name\">test</span> mean <span class=\"token assign-left variable\">loss</span><span class=\"token operator\">=</span><span class=\"token number\">0.401306927204</span>, <span class=\"token assign-left variable\">accuracy</span><span class=\"token operator\">=</span><span class=\"token number\">0.920000010067</span></code></pre></div>\n<p>計32エポックで学習終了です。</p>\n<h2 id=\"主要キャラの分類モデルを作成しイラストを読み込ませて判定する\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E8%A6%81%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AE%E5%88%86%E9%A1%9E%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B\" aria-label=\"主要キャラの分類モデルを作成しイラストを読み込ませて判定する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主要キャラの分類モデルを作成し、イラストを読み込ませて判定する</h2>\n<p>予測用のコードも以下からお借りしています。</p>\n<p><a href=\"https://www.mathgram.xyz/entry/chainer/bake/part5.5_1\" target=\"_blank\" rel=\"noopener noreferrer\">python: chainerを使って化物語キャラを認識させるよ！ 〜part5.5 主要キャラで多値分類(改良編)〜</a></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token keyword\">import</span> sys\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> six\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> os\n\n\n<span class=\"token keyword\">import</span> chainer\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> computational_graph <span class=\"token keyword\">as</span> c\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>functions <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> chainer<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">as</span> S\n\n<span class=\"token keyword\">from</span> chainer <span class=\"token keyword\">import</span> optimizers\n\n<span class=\"token keyword\">from</span> clf_hinako_model <span class=\"token keyword\">import</span> clf_hinako\n\n\nmodel <span class=\"token operator\">=</span> clf_hinako<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nS<span class=\"token punctuation\">.</span>load_hdf5<span class=\"token punctuation\">(</span><span class=\"token string\">'./model32'</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 32モデルだったので。</span>\n<span class=\"token comment\">#model = pickle.load(open('model30','rb'))</span>\n\nchara_name <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hinako\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Kuina\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Mayuki\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Yua\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Chiaki\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    x <span class=\"token operator\">=</span> chainer<span class=\"token punctuation\">.</span>Variable<span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> volatile<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>conv1<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>max_pooling_2d<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>conv2<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ksize <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pad <span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    h <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>dropout<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>l3<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    y <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>l4<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> y\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">detect</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cascade_file <span class=\"token operator\">=</span> <span class=\"token string\">\"./lbpcascade_animeface.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># アニメ顔抽出時使ったXMLを指定</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isfile<span class=\"token punctuation\">(</span>cascade_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> RuntimeError<span class=\"token punctuation\">(</span><span class=\"token string\">\"%s: not found\"</span> <span class=\"token operator\">%</span> cascade_file<span class=\"token punctuation\">)</span>\n\n    cascade <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>CascadeClassifier<span class=\"token punctuation\">(</span>cascade_file<span class=\"token punctuation\">)</span>\n    gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n    gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>equalizeHist<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">)</span>\n\n    faces <span class=\"token operator\">=</span> cascade<span class=\"token punctuation\">.</span>detectMultiScale<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span>\n                                     scaleFactor <span class=\"token operator\">=</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span>\n                                     minNeighbors <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                                     minSize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>faces<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> faces\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recognition</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    face_images <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> faces<span class=\"token punctuation\">:</span>\n        dst <span class=\"token operator\">=</span> image<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">]</span>\n        dst <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>dst<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        face_images<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>dst<span class=\"token punctuation\">)</span>\n\n    face_images <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>float32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span>\n\n    <span class=\"token comment\">#face_images = cuda.to_gpu(face_images)</span>\n\n    <span class=\"token keyword\">return</span> forward<span class=\"token punctuation\">(</span>face_images<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span> image\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">draw_result</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> faces<span class=\"token punctuation\">:</span>\n        classNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        result_data <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span>\n        classNum <span class=\"token operator\">=</span> result_data<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        recognized_class <span class=\"token operator\">=</span> chara_name<span class=\"token punctuation\">[</span>result_data<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        font <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_TRIPLEX <span class=\"token comment\"># 名前を入れたいので、OpenCVのFont機能を使います。</span>\n        font_size <span class=\"token operator\">=</span> <span class=\"token number\">1.1</span>\n        <span class=\"token keyword\">if</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 重ねたい画像を選択し、フォントサイズ等を指定</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> classNum <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> chara_name<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">,</span> font_size<span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        count<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n\n    <span class=\"token keyword\">return</span> image\n\n<span class=\"token comment\">#ファイル読み込み</span>\nimg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">\"test.jpg\"</span><span class=\"token punctuation\">)</span>\n\nfaces <span class=\"token operator\">=</span> detect<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span>\n\nresult<span class=\"token punctuation\">,</span> image <span class=\"token operator\">=</span> recognition<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">)</span>\n\nimage <span class=\"token operator\">=</span> draw_result<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> faces<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imwrite<span class=\"token punctuation\">(</span><span class=\"token string\">'out.png'</span><span class=\"token punctuation\">,</span>image<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"実際読み込ませる\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E9%9A%9B%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%82%8B\" aria-label=\"実際読み込ませる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実際、読み込ませる</h3>\n<p>実際読み込ませてみたものがこちら。</p>\n<ul>\n<li>水色はUnknown</li>\n<li>赤がひなこ</li>\n<li>青がくいな</li>\n<li>白がまゆき</li>\n<li>紫がゆあ</li>\n<li>オレンジがちあき</li>\n</ul>\n<p>です。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/1tudTrI.png\" alt=\"img\"></p>\n<p>大家さんだけがUnknownとなってしまいました。。。</p>\n<p>データ量が少なかったためでしょうね。</p>\n<h2 id=\"できあがったモデルでごちうさの画像を読み込ませてひなこのーとのキャラに分類されないことを確認する\" style=\"position:relative;\"><a href=\"#%E3%81%A7%E3%81%8D%E3%81%82%E3%81%8C%E3%81%A3%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%81%A7%E3%81%94%E3%81%A1%E3%81%86%E3%81%95%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%9B%E3%81%A6%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%A9%E3%81%AB%E5%88%86%E9%A1%9E%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\" aria-label=\"できあがったモデルでごちうさの画像を読み込ませてひなこのーとのキャラに分類されないことを確認する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>できあがったモデルでごちうさの画像を読み込ませて、ひなこのーとのキャラに分類されないことを確認する</h2>\n<p>いよいよオーラスです。これをやるためにつくったモデルです。</p>\n<p>さっそく読み込ませて見ます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/N909ILj.png\" alt=\"img\"></p>\n<p>むむっ。ココアさんがひなこに、シャロちゃんがまゆちゃんと認識されているではないか。</p>\n<p>ココアさんとひなこ、なんか似ているように感じなくもなくもない????？</p>\n<p>フルール・ド・ラパンの制服と、まゆちゃんの私服が似ているというのはあるが、髪色で判断しているわけではないよな??</p>\n<p>金髪で判断しているという可能性がぬぐいきれないので。これでもくらえ！きんモザ＆ごちうさのコラボじゃあああ。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/mWRGXtm.png\" alt=\"img\"></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/KLiwNQR.png\" alt=\"img\"></p>\n<p>金髪で判断しているというわけではなかった。</p>\n<p>それにしてもココアさん＝ひなこは覆らないな。</p>\n<h3 id=\"絵のタッチを変えてみる\" style=\"position:relative;\"><a href=\"#%E7%B5%B5%E3%81%AE%E3%82%BF%E3%83%83%E3%83%81%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"絵のタッチを変えてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>絵のタッチを変えてみる</h3>\n<p>こうなったら徹底討論じゃあ。絵のタッチを変えてどうなるか試してみましょう。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/GwUtdtM.png\" alt=\"img\"></p>\n<p><span style=\"font-size: 200%\">ココア、お前だったのか!!（結論）</span></p>\n<h3 id=\"おまけ１ひなこのーともイラストで認識させてみる\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%91%E3%81%B2%E3%81%AA%E3%81%93%E3%81%AE%E3%83%BC%E3%81%A8%E3%82%82%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%A7%E8%AA%8D%E8%AD%98%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"おまけ１ひなこのーともイラストで認識させてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ１　ひなこのーともイラストで認識させてみる</h3>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/85nBHnf.png\" alt=\"img\"></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/YQrn166.png\" alt=\"img\"></p>\n<p>どうやら、くいなちゃんの認識率が一番いい。くいなちゃんかわいいからね。</p>\n<h3 id=\"おまけ２-くいなちゃん某オタク少女に似ている説を確かめる\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%92-%E3%81%8F%E3%81%84%E3%81%AA%E3%81%A1%E3%82%83%E3%82%93%E6%9F%90%E3%82%AA%E3%82%BF%E3%82%AF%E5%B0%91%E5%A5%B3%E3%81%AB%E4%BC%BC%E3%81%A6%E3%81%84%E3%82%8B%E8%AA%AC%E3%82%92%E7%A2%BA%E3%81%8B%E3%82%81%E3%82%8B\" aria-label=\"おまけ２ くいなちゃん某オタク少女に似ている説を確かめる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ２ くいなちゃん、某オタク少女に似ている説を確かめる。</h3>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/DCkFvv2.png\" alt=\"img\"></p>\n<p>大丈夫でした!!!</p>","words":2222,"minutes":6}},"staticQueryHashes":["1319877725","2959249232"]}