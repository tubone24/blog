{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2017/7/23/elasticsearch-zabbix","result":{"data":{"content":{"edges":[{"node":{"id":"e9543aa8-2b6e-5727-9bef-715820ddbbb4","excerpt":"ZabbixでElasticsearchのクラスタを監視したい、したくない？ Elasticsearchのノードを先日1つ追加しましたので、ちょい傾向とかを確認しようと思いZabbixで監視できるテンプレートとかを作ってみました。 Elastic_zab Table of…","fields":{"slug":"2017/7/23/elasticsearch-zabbix"},"frontmatter":{"id":null,"title":"Elasticsearchのクラスタ監視をZabbixでする","slug":"2017/7/23/elasticsearch-zabbix","date":"2017-07-22T16:59:14.751Z","headerImage":"https://i.imgur.com/tE9cC6Q.png","tags":["Zabbix","Elasticsearch","forecast"]}}}]}},"pageContext":{"id":"e9543aa8-2b6e-5727-9bef-715820ddbbb4","index":100,"repHtml":"<p>ZabbixでElasticsearchのクラスタを監視したい、したくない？</p>\n<p>Elasticsearchのノードを先日1つ追加しましたので、ちょい傾向とかを確認しようと思いZabbixで監視できるテンプレートとかを作ってみました。</p>\n<p><a href=\"https://github.com/tubone24/Elastic_zab\" target=\"_blank\" rel=\"noopener noreferrer\">Elastic_zab</a></p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\">使い方</a></li>\n<li><a href=\"#zabbix%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">Zabbixにテンプレートをインストールする</a></li>\n<li><a href=\"#elasticsearch%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%BD%93%E3%81%A6%E3%82%8B\">Elasticsearchのノードにテンプレートを当てる</a></li>\n<li><a href=\"#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\">監視する</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-zabbix%E3%81%AE%E4%BA%88%E6%B8%AC%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\">おまけ Zabbixの予測関数を使ってみた</a></li>\n</ul>\n</div>\n<h2 id=\"使い方\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\" aria-label=\"使い方 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使い方</h2>\n<p>Elastic_zabに同梱しているelastic.shをZabbixサーバーのexternalscriptsディレクトリに配置します。実行権限もZabbixユーザーにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/tubone24/Elastic_zab\n\n$  cp -p Elastic_zab/elastic.sh /usr/lib/zabbix/externalscripts/\n\n$ chown zabbix. /usr/lib/zabbix/externalscripts/elastic.sh\n\n$ chmod 751 /usr/lib/zabbix/externalscripts/elastic.sh</code></pre></div>\n<h2 id=\"zabbixにテンプレートをインストールする\" style=\"position:relative;\"><a href=\"#zabbix%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"zabbixにテンプレートをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Zabbixにテンプレートをインストールする</h2>\n<p>Zabbix画面の設定のテンプレートから<a href=\"https://github.com/tubone24/Elastic_zab/blob/master/elasticsearch_zab.xml\" target=\"_blank\" rel=\"noopener noreferrer\">elasticsearch_zab.xml</a>をインポートします。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/cTG62da.png\" alt=\"img\"></p>\n<p>うまくインストールできれば、テンプレート一覧にElastic clusterが出現します。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/mzeLWwv.png\" alt=\"img\"></p>\n<h2 id=\"elasticsearchのノードにテンプレートを当てる\" style=\"position:relative;\"><a href=\"#elasticsearch%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%BD%93%E3%81%A6%E3%82%8B\" aria-label=\"elasticsearchのノードにテンプレートを当てる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elasticsearchのノードにテンプレートを当てる</h2>\n<p>Elasticsearchのノードにテンプレートを当てます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/zpTarcD.png\" alt=\"img\"></p>\n<p>合わせて、ElasticsearchのIPとポートをマクロで設定しておきます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/Vw5bbsA.png\" alt=\"img\"></p>\n<p>設定するマクロは以下の2つです。</p>\n<ul>\n<li><strong>{$ESIP}</strong> = ElasticsearchのIPもしくはDNSネームを設定します。</li>\n<li><strong>{$ESPORT}</strong> = Elasticsearchのポートを設定します。</li>\n</ul>\n<h2 id=\"監視する\" style=\"position:relative;\"><a href=\"#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\" aria-label=\"監視する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>監視する</h2>\n<p>うまく監視できるとこんなグラフができます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/tE9cC6Q.png\" alt=\"img\"></p>\n<h2 id=\"おまけ-zabbixの予測関数を使ってみた\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91-zabbix%E3%81%AE%E4%BA%88%E6%B8%AC%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\" aria-label=\"おまけ zabbixの予測関数を使ってみた permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おまけ Zabbixの予測関数を使ってみた</h2>\n<p>いくつかの監視アイテムはforecastやtimeleftといったZabbixの関数を利用しています。</p>\n<p>予測は線形としています。</p>\n<p>予測値はトリガー設定していないのでお好みでトリガーを設定するのもいいのではないでしょうか。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/ylKkzK6.png\" alt=\"img\"></p>\n<p>こんな感じで計算アイテムで簡単に実装できるのが魅力ですね。</p>","words":795,"minutes":2}},"staticQueryHashes":["1319877725","2959249232"]}