{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2017/06/16/grafana","result":{"data":{"content":{"edges":[{"node":{"id":"98b0e413-25a2-5bc0-85e9-b41671017490","excerpt":"どうも。GrafanaのUIは結構かっこいいことで有名で、自身もZabbix APIを活用してZabbixのメトリックをGrafanaで見れるようにしております。 img こんな感じ。Zabbixのスクリーンと全く同じ内容ですが、妙に「監視している感」がありますね。 Table…","fields":{"slug":"2017/06/16/grafana"},"frontmatter":{"id":null,"title":"Grafana&World Ping を活用して簡単な死活監視をしてみよう","slug":"2017/06/16/grafana","date":"2017-06-15T22:53:28.047Z","headerImage":"https://i.imgur.com/iLyWtZb.png","tags":["監視","Grafana","World Ping"]}}}]}},"pageContext":{"id":"98b0e413-25a2-5bc0-85e9-b41671017490","index":104,"repHtml":"<p>どうも。GrafanaのUIは結構かっこいいことで有名で、自身もZabbix APIを活用してZabbixのメトリックをGrafanaで見れるようにしております。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/N2pDM5D.png\" alt=\"img\"></p>\n<p>こんな感じ。Zabbixのスクリーンと全く同じ内容ですが、妙に「監視している感」がありますね。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#zabbix%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AFzabbix%E3%81%A7%E8%A6%8B%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\">ZabbixのデータはZabbixで見ればいいのでは？</a></li>\n<li><a href=\"#grafana%E3%81%AEworld-ping%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\">GrafanaのWorld Pingを使ってみよう</a></li>\n<li><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\">インストールしてみる</a></li>\n<li><a href=\"#grafananet-api%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97world-ping%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">Grafana.net APIを取得しWorld Pingが利用できるようにする</a></li>\n<li><a href=\"#%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\">エンドポイントを追加する</a></li>\n<li><a href=\"#%E7%94%BB%E9%9D%A2%E3%82%92%E8%A6%8B%E3%82%8B\">画面を見る</a></li>\n</ul>\n</div>\n<h2 id=\"zabbixのデータはzabbixで見ればいいのでは\" style=\"position:relative;\"><a href=\"#zabbix%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AFzabbix%E3%81%A7%E8%A6%8B%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\" aria-label=\"zabbixのデータはzabbixで見ればいいのでは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZabbixのデータはZabbixで見ればいいのでは？</h2>\n<p>はい。おっしゃるとおりです。そもそもそんな監視するほど重要なものがあるかと言われると。。</p>\n<p>でも、Grafanaにはもっと手軽にかっこいい画面を見る方法があります。</p>\n<h2 id=\"grafanaのworld-pingを使ってみよう\" style=\"position:relative;\"><a href=\"#grafana%E3%81%AEworld-ping%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\" aria-label=\"grafanaのworld pingを使ってみよう permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GrafanaのWorld Pingを使ってみよう</h2>\n<p>Grafanaの優秀な点はPlugin機能で簡単にデータソースやパネルを追加できる点です。</p>\n<p>もともと、GrafanaはInfluxDBの可視化用みたいな位置づけっぽいですが、データソースプラグインを追加することで、例えばElasticsearch・Graphiteや、CloudWatch、さらにはkubernetesやDatadogなどのコンテナの監視までできるという優れものです。</p>\n<p>また、データソースではないですが、World Pingという世界中のエンドポイントからPing・DNS・HTTPなどの死活監視を提供するサービスと連携させることで、簡単にかっちょいい画面を作ることができます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/4puZFgk.png\" alt=\"img\"></p>\n<p>こんな感じで好きなプラグインをコマンド一発でインストールできます。</p>\n<h2 id=\"インストールしてみる\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"インストールしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>インストールしてみる</h2>\n<p>まず、Grafanaの入ったサーバーでrootユーザーで、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">grafana-cli plugins install raintank-worldping-app</code></pre></div>\n<p>こうすることで、簡単にプラグインが導入されます。</p>\n<h2 id=\"grafananet-apiを取得しworld-pingが利用できるようにする\" style=\"position:relative;\"><a href=\"#grafananet-api%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97world-ping%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"grafananet apiを取得しworld pingが利用できるようにする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Grafana.net APIを取得しWorld Pingが利用できるようにする</h2>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/3jpOIzC.png\" alt=\"img\"></p>\n<p>Grafana Web画面の左側のメニューに「World Ping」が表示されていると思いますのでPlugin Configから、Grafana.netのAPIを発行しましょう。</p>\n<p>こうすることでWorld Pingが利用できます。無茶な監視をしない限り、無料版で事足りると思います。</p>\n<h2 id=\"エンドポイントを追加する\" style=\"position:relative;\"><a href=\"#%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\" aria-label=\"エンドポイントを追加する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>エンドポイントを追加する</h2>\n<p>監視対象のIPまたはドメイン名をエンドポイントと呼んでますが、エンドポイントを設定していきます。</p>\n<p>同じく、Grafana Web画面の左側のメニューに「World Ping」⇒「Endpoints」と進みます。</p>\n<p>エンドポイントは無料版だと最大3つです。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/JVyAD6w.png\" alt=\"img\"></p>\n<p>このようにEndpointにドメイン名を設定し、監視したいサービスを選びConfigureを押します。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/XCXFfBk.png\" alt=\"img\"></p>\n<p>細かい設定等でてきますから、設定していきます。</p>\n<p>監視間隔、死活監視を投げるインスタンスの国、ポート、HTTPメソッドなど細かく設定できます。</p>\n<p>また、閾値を超えた場合に決められたメールに通知できます。(あらかじめメールサーバーの設定をGrafana.iniでしておきます。)</p>\n<p>一応、無料版だと600万回/月しか監視できないようなので無茶な設定はやめましょう。</p>\n<p>アップデートボタンを押せば、設定が完了します。</p>\n<h2 id=\"画面を見る\" style=\"position:relative;\"><a href=\"#%E7%94%BB%E9%9D%A2%E3%82%92%E8%A6%8B%E3%82%8B\" aria-label=\"画面を見る permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>画面を見る</h2>\n<p>World Pingがすごいのは、あらかじめGrafana画面を提供している点で、設定さえすればすぐ可視化できることです。</p>\n<p>同じく、Grafana Web画面の左側のメニューに「World Ping」⇒「World Ping Home」と進むと、設定したエンドポイントが表示されますので、</p>\n<p>エンドポイント名もしくはハートマークのサービス名をクリックすると画面が表示されます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/iLyWtZb.png\" alt=\"img\"></p>\n<p>かっちょええ。</p>","words":1528,"minutes":4}},"staticQueryHashes":["1319877725","2959249232"]}