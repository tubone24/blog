{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2019/11/20/docopt-nim","result":{"data":{"content":{"edges":[{"node":{"id":"893e646d-2473-58b4-93ca-82ac118a0984","excerpt":"めっちゃ便利じゃんアゼルバイジャン Pythonで結構有名なdocoptがNimという言語でも使えたので喜びのあまり記事を書く運びになりました。 Table of Contents そもそもNim…","fields":{"slug":"2019/11/20/docopt-nim"},"frontmatter":{"id":null,"title":"docoptはNimでも使えたのお話","slug":"2019/11/20/docopt-nim","date":"2019-11-20T11:55:00.000Z","headerImage":"https://i.imgur.com/FeDnyEc.jpg","tags":["Nim","docopt","GitHub Action","CLI"]}}}]}},"pageContext":{"id":"893e646d-2473-58b4-93ca-82ac118a0984","index":65,"repHtml":"<p>めっちゃ便利じゃんアゼルバイジャン</p>\n<p>Pythonで結構有名なdocoptがNimという言語でも使えたので喜びのあまり記事を書く運びになりました。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82nim%E3%81%A8%E3%81%AF\">そもそもNimとは？</a></p>\n<ul>\n<li><a href=\"#%E6%97%A9%E3%81%84\">早い</a></li>\n<li><a href=\"#%E4%B8%80%E9%83%A8%E3%81%AE%E4%BA%BA%E3%81%AB%E4%BA%BA%E6%B0%97%E3%81%8C%E3%81%82%E3%82%8B\">一部の人に人気がある</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%81%98%E3%82%83%E3%81%82%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\">じゃあとりあえず使ってみる</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%9D%E3%81%93%E3%81%A7%E5%83%95%E3%81%AFdocopt\">そこで僕はdocopt</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"そもそもnimとは\" style=\"position:relative;\"><a href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82nim%E3%81%A8%E3%81%AF\" aria-label=\"そもそもnimとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>そもそもNimとは？</h2>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/kYsjLcW.png\" alt=\"img\"></p>\n<p>Nimとは、公式Doc <a href=\"https://nim-lang.org/\" target=\"_blank\" rel=\"noopener noreferrer\">https://nim-lang.org/</a>  によると、静的型付なコンパイラ言語でPython, Ada, modulaなどの成熟した言語のいいとこ取りをした<strong>能率的</strong>で、<strong>表現力豊か</strong>で、<strong>エレガント</strong>な言語とのこと。</p>\n<p><strong>大手化粧品メーカー</strong>ばりにうたい文句が多いですが、私なりに触っての特徴をお伝えしますと…</p>\n<h3 id=\"早い\" style=\"position:relative;\"><a href=\"#%E6%97%A9%E3%81%84\" aria-label=\"早い permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>早い</h3>\n<p>Nimはスクリプト言語でもVM上で動くわけでもなく、ネイティブな実行ファイルにコンパイルされます。</p>\n<p>よく、Pythonは遅い～的な小言をいう人にはこの手の言語が合ってると思いますが、そういう人に限って<strong>Go</strong>がいいと言ったりします。</p>\n<p><del>（私は<strong>Go大好き</strong>です!!ただ、世の中Goだけじゃないよ～と言いたいのと、<strong>社内に優秀なGoエンジニアが何名か居るので</strong>社内では<strong>Rust信者</strong>として今は活動中。。）</del></p>\n<p>Goとの優位差を見せつけるには、<strong>Nimのコンパイラ</strong>の優秀さを示すことかと思います。</p>\n<p>（構文が楽とかPythonライクで書きやすいとかそういった優位差を示す記事もありますが、個人的にはGoもNimもそんなに難しさは変わらないと思います。<del>Rustは難しいけど書いてて楽しいです。</del>）</p>\n<p>自分で検証してないので完全に他人の受け売りですが、<a href=\"http://h-miyako.hatenablog.com/entry/2015/01/23/060000\" target=\"_blank\" rel=\"noopener noreferrer\">こちらの記事</a>を確認すると、最適化オプションをがちゃがちゃしたC(いわゆる -O3オプション)には負けましたが、それでも他の言語と比較すると<strong>圧倒的に早い</strong>。</p>\n<p>(ちょっと古めの記事なので最新はわからん。)</p>\n<table>\n<thead>\n<tr>\n<th><strong>Language</strong></th>\n<th>sec(exec)</th>\n<th>sec(compile)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>c</td>\n<td>3.993</td>\n<td>0.02</td>\n</tr>\n<tr>\n<td>c (optimized -o2)</td>\n<td>2.062</td>\n<td>0.29</td>\n</tr>\n<tr>\n<td>go</td>\n<td>3.795</td>\n<td>0.313</td>\n</tr>\n<tr>\n<td>nim</td>\n<td>25.996</td>\n<td>0.795</td>\n</tr>\n<tr>\n<td><strong>nim(optimized)</strong></td>\n<td><strong>1.625</strong></td>\n<td>1.4</td>\n</tr>\n<tr>\n<td>rust</td>\n<td>4.692</td>\n<td>0.29</td>\n</tr>\n<tr>\n<td>rust(optimized)</td>\n<td>3.602</td>\n<td>0.303</td>\n</tr>\n</tbody>\n</table>\n<p>(引用: [この頃流行りの言語たち（他）でベンチマーク（Dart, Go, Julia, Nim, Python, Rust他）](<a href=\"http://h-miyako.hatenablog.com/entry/2015/01/23/060000\" target=\"_blank\" rel=\"noopener noreferrer\">http://h-miyako.hatenablog.com/entry/2015/01/23/060000</a>))</p>\n<p>詳しいことはわからないのですが、-o3オプションって、いいイメージないんですよね…。昔、-o3オプションで爆速な実行ファイルを作成しようとしたら、コンパイルは問題なく完了するのにいざ実行しようとするとコアダンプ吐いて落ちまくったんですよね。。</p>\n<p>そんな危険なオプションに匹敵するスピードがあるのはすごい。</p>\n<p>というのもNim自体がCを通してコンパイルするいわゆるトランスパイルな言語なのでまぁ相性がいいんでしょうね。</p>\n<p>（ちなみに、C++/Objective-C/JavaScriptなんかにもトランスパイルできるらしい。C言語からの実行ファイルビルドのためLinux,Mac,Windowsだけでなく、<a href=\"https://github.com/nim-lang/Nim/pull/8069\" target=\"_blank\" rel=\"noopener noreferrer\">Nitendo Switchでも動く実行ファイルを作れるみたいです。</a>作ったことないけど。）</p>\n<h3 id=\"一部の人に人気がある\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E9%83%A8%E3%81%AE%E4%BA%BA%E3%81%AB%E4%BA%BA%E6%B0%97%E3%81%8C%E3%81%82%E3%82%8B\" aria-label=\"一部の人に人気がある permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一部の人に人気がある</h3>\n<p>気がする、という感じですがNimの記事書いていてNimの悪口言っている人をあまり見ません。</p>\n<p>構文がエレガントという意見は個人的にはよくわかんなかったです・・・。~~クラスもまさにCの構造体チックだし。。~~が、悪い感じはしませんでした。<strong>マクロはやはり便利だよね</strong>という印象です。</p>\n<h2 id=\"じゃあとりあえず使ってみる\" style=\"position:relative;\"><a href=\"#%E3%81%98%E3%82%83%E3%81%82%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"じゃあとりあえず使ってみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>じゃあとりあえず使ってみる</h2>\n<p>ということで早速使ってみます。</p>\n<p>今回は毎回おなじみ<a href=\"https://github.com/tubone24/ebook_homebrew\" target=\"_blank\" rel=\"noopener noreferrer\">Ebook-homebrew</a>のクライアントCLIを作ってみます。</p>\n<p>CLIなので、コマンドラインから引数を受け取らなければなりません。</p>\n<p>ちょっと調べて出てきた <strong>parseopt</strong> がよいと思いこちらで実装進めてましたが、思いのほか新しい言語の学習コストと相まってめんどくさくてやる気がなくなりレポジトリをほったらかしにしてました。</p>\n<p>parseoptを使うとこんな感じです。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">import</span> parseopt2\n\n<span class=\"token keyword\">when</span> isMainModule<span class=\"token operator\">:</span>\n  <span class=\"token keyword\">for</span> kind<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> val <span class=\"token operator\">in</span> <span class=\"token function\">getopt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n    <span class=\"token keyword\">case</span> kind\n    <span class=\"token operator\">of</span> cmdArgument<span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span>\n        <span class=\"token function\">echo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token string\">\"upload\"</span><span class=\"token operator\">:</span>\n        <span class=\"token function\">echo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"upload\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">of</span> cmdLongOption<span class=\"token punctuation\">,</span> cmdShortOption<span class=\"token operator\">:</span>\n      <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token string\">\"h\"</span> <span class=\"token operator\">or</span> key <span class=\"token operator\">==</span> <span class=\"token string\">\"help\"</span><span class=\"token operator\">:</span>\n        <span class=\"token function\">echo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"help\"</span><span class=\"token punctuation\">)</span>\n      echo <span class=\"token string\">\"Options > \"</span><span class=\"token punctuation\">,</span>key<span class=\"token punctuation\">,</span><span class=\"token string\">\"=\"</span> <span class=\"token punctuation\">,</span>val\n    <span class=\"token operator\">of</span> cmdEnd<span class=\"token operator\">:</span>\n      echo <span class=\"token string\">\"end\"</span></code></pre></div>\n<p>直感的じゃない・・・。</p>\n<ul>\n<li>getoptからkind, key, valを逐次取り、それぞれ<strong>cmdArgument</strong>, <strong>cmdLongOption</strong>, <strong>cmdShortOption</strong>ごとにif文で判定して・・・。</li>\n</ul>\n<p>オプションが入っているときの位置引数の値をとりたい！みたいなときどないすんねんと・・。</p>\n<h2 id=\"そこで僕はdocopt\" style=\"position:relative;\"><a href=\"#%E3%81%9D%E3%81%93%E3%81%A7%E5%83%95%E3%81%AFdocopt\" aria-label=\"そこで僕はdocopt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>そこで僕はdocopt</h2>\n<p>Nimでも見つけちゃいました。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/FeDnyEc.jpg\" alt=\"img\"></p>\n<p><a href=\"http://docopt.org/\" target=\"_blank\" rel=\"noopener noreferrer\">docopt</a>はPythonで使ったことがあるのですが、CLIのUsageを書くだけでコマンドラインパーサーとして動く優れもの。</p>\n<p>Pythonだとこんな感じ、<a href=\"https://github.com/tubone24/ebook_homebrew/blob/master/examples/use_rest_api/src/main.py\" target=\"_blank\" rel=\"noopener noreferrer\">Client App with ebook-homebrew's rest API\n</a></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token triple-quoted-string string\">\"\"\"\nOverview:\n  Client App with ebook-homebrew's rest API\nUsage:\n  main.py [-h|--help] [-v|--version]\n  main.py upload &lt;directory> &lt;extension> [--host &lt;host>] [--port &lt;port>]\n  main.py convert &lt;id> &lt;extension> [--host &lt;host>] [--port &lt;port>]\n  main.py download &lt;id> &lt;file> [--host &lt;host>] [--port &lt;port>]\nOptions:\n  upload         : upload\n  convert        : convert\n  &lt;directory>    : directory\n  &lt;extension>    : extension\n  &lt;id>           : upload_id\n  &lt;file>         : filename\n  -h, --help     : show this help message and exit\n  -v, --version  : show version\n  --host         : API server host\n  --port         : API server port\n\"\"\"</span>\n\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> glob\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> docopt <span class=\"token keyword\">import</span> docopt\n\n__version__ <span class=\"token operator\">=</span> <span class=\"token string\">\"2.0.0\"</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"Call submodules\"\"\"</span>\n\n    <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"upload\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n        upload<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">elif</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"convert\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n        convert<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">elif</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"download\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n        download<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">elif</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"--version\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n        show_version<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>モジュールの先頭で文字列としてUsage書いてますね。</p>\n<p>Nimで使うとこんな感じになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"nim\"><pre class=\"language-nim\"><code class=\"language-nim\"><span class=\"token keyword\">const</span> doc <span class=\"token operator\">=</span> <span class=\"token string\">\"\"\"\nOverview:\n  Client App with ebook-homebrew's rest API for Nim\nUsage:\n  ebook_homebrew_nim_client status\n  ebook_homebrew_nim_client convert &lt;directory> &lt;contentType> [-o|--output=&lt;outputFile>]\nOptions:\n  status                Check API Status\n  convert               Upload Images, convert to PDF and download result.pdf\n  &lt;directory>           Specify directory with in images\n  &lt;contentType>         Image content Type such as \"image/jpeg\"\n  -o, --output=&lt;outputFile> Output Filename [default: result.pdf]\n\"\"\"</span>\n\n<span class=\"token keyword\">import</span> docopt\n<span class=\"token keyword\">import</span> ebook_homebrew_nim_clientpkg<span class=\"token operator\">/</span>submodule\n\n<span class=\"token keyword\">proc</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\n  <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> <span class=\"token function\">docopt</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">,</span> version <span class=\"token operator\">=</span> <span class=\"token string\">\"0.1.0\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>\n    echo <span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"convert\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">let</span> uploadId <span class=\"token operator\">=</span> <span class=\"token function\">extractUploadId</span><span class=\"token punctuation\">(</span><span class=\"token function\">uploadImgSeq</span><span class=\"token punctuation\">(</span><span class=\"token function\">listImgFiles</span><span class=\"token punctuation\">(</span><span class=\"token operator\">$</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;directory>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">$</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;contentType>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">discard</span> <span class=\"token function\">convertImg</span><span class=\"token punctuation\">(</span>uploadId<span class=\"token punctuation\">,</span> <span class=\"token operator\">$</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;contentType>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">[</span><span class=\"token string\">\"--output\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">convertPdfDownload</span><span class=\"token punctuation\">(</span>uploadId<span class=\"token punctuation\">,</span> <span class=\"token operator\">$</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"--output\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">convertPdfDownload</span><span class=\"token punctuation\">(</span>uploadId<span class=\"token punctuation\">,</span> <span class=\"token string\">\"result.pdf\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">when</span> isMainModule<span class=\"token operator\">:</span>\n  <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>先頭で <strong>const doc</strong> として、Overview, Usage, Optionsを書きます。</p>\n<p>よく見かける書き方ですね。</p>\n<ul>\n<li>サブコマンドは<strong>status</strong>, <strong>convert</strong> のように直接指定します。</li>\n<li>位置引数は<hoge> と&#x3C;>カッコで囲みます。位置引数は特性上必須パラメーターと任意パラメーター(後述しますが[]で囲む)を併用する場合は必須パラメーターを先に書かなければなりません。</li>\n<li>オプションは --hogeとします。また、[]で囲むことで任意なパラメーターになります。また、ショートオプション（-h）とロングオプション両方使いたい場合は**|**(パイプ)を使います。</li>\n<li>-h, --helpもしくは間違ったパラメータ指定の場合はconst docの内容を出力します。(help表示)</li>\n</ul>\n<p>引数の取り出しかたは、</p>\n<ul>\n<li>let args = docopt(doc) する</li>\n<li>args[\"hoge\"]でサブコマンド取得(Bool)</li>\n<li>args[\"<hoge>\"]で位置引数の有無取得 **$**で文字列化され値が取得可能に</li>\n<li>args[\"--output\"]でオプションの判定、 **$**で文字列化されオプション設定時の位置引数値が取得可能</li>\n</ul>\n<p>わーお簡単。</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>んで出来上がったものがこちら<a href=\"https://github.com/tubone24/ebook-homebrew-nim-client\" target=\"_blank\" rel=\"noopener noreferrer\">ebook-homebrew-nim-client\n</a></p>\n<p>ちゃっかり上記レポジトリはGitHub ActionでCI化してます。(参考: <a href=\"https://qiita.com/jiro4989/items/809f2a520c2e40d65bd3\" target=\"_blank\" rel=\"noopener noreferrer\">Nim用のGitHub Actionsを作ってみた\n</a>)</p>\n<p>docoptのおかげでNimが好きになったような気がします。</p>\n<p>NimはほかにもGUIフレームワークのnimx, WebフレームワークのJester, Nimで書かれたカーネルのnimkernelなど触ってみたいものがたくさんあります。</p>\n<p>時間を見つけて少しずつ触っていきたいですね。</p>","words":2761,"minutes":7}},"staticQueryHashes":["1319877725","2959249232"]}