{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2019/1/3/go-jaeger","result":{"data":{"content":{"edges":[{"node":{"id":"16dc5d27-32c0-5d2e-8332-47dd43b234ea","excerpt":"Goの勉強をしておかないと社内でニートになってしまうので、お勉強を兼ねてGoのWebフレームワークのEchoを使ったアプリケーションを作成中です。 そのなかでボトルネック調査をする必要があったので、Opentracing形式のトレースアプリケーションであるJaeger…","fields":{"slug":"2019/1/3/go-jaeger"},"frontmatter":{"id":null,"title":"GoのEchoでJaegerを使ってボトルネックを調査する","slug":"2019/1/3/go-jaeger","date":"2020-01-03T08:07:30.122Z","headerImage":"https://i.imgur.com/69WEZfu.png","tags":["Go","Echo","Jaeger","ボトルネック調査"]}}}]}},"pageContext":{"id":"16dc5d27-32c0-5d2e-8332-47dd43b234ea","index":48,"repHtml":"<p>Goの勉強をしておかないと社内でニートになってしまうので、お勉強を兼ねてGoのWebフレームワークのEchoを使ったアプリケーションを作成中です。</p>\n<p>そのなかでボトルネック調査をする必要があったので、Opentracing形式のトレースアプリケーションであるJaegerをローカル環境で使ってみたいと思います。</p>\n<h2 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h2>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82echo%E3%81%A8%E3%81%AF\">そもそもEchoとは？</a></p>\n<ul>\n<li><a href=\"#%E3%81%AF%E3%82%84%E3%81%84\">はやい</a></li>\n<li><a href=\"#%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E5%84%AA%E7%A7%80\">公式ドキュメントが優秀</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#jaeger%E3%81%A8%E3%81%AF\">jaegerとは？</a></p>\n</li>\n<li>\n<p><a href=\"#jaeger-tracing\">jaeger tracing</a></p>\n</li>\n<li>\n<p><a href=\"#child-span%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B\">child spanを記録する</a></p>\n</li>\n<li>\n<p><a href=\"#jaeger%E3%81%A7%E7%B5%90%E6%9E%9C%E3%82%92%E8%A6%8B%E3%82%8B\">jaegerで結果を見る</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%B5%90%E8%AB%96\">結論</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"そもそもechoとは\" style=\"position:relative;\"><a href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82echo%E3%81%A8%E3%81%AF\" aria-label=\"そもそもechoとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>そもそもEchoとは？</h2>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/3ZjGzeX.png\" alt=\"img\"></p>\n<p>EchoとはGoのWAF(Web Framework)です。</p>\n<p>特徴として公式によると、<strong>High performance</strong>で<strong>extensible</strong>で<strong>minimalist</strong>な <strong>Go web framework</strong>だそうです。</p>\n<p>よくわかりませんね。ちょっと特徴を洗い出してみます。</p>\n<h3 id=\"はやい\" style=\"position:relative;\"><a href=\"#%E3%81%AF%E3%82%84%E3%81%84\" aria-label=\"はやい permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>はやい</h3>\n<p>Goのなかでもパフォーマンスがいいと言われている<a href=\"https://gin-gonic.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Gin</a>に比べても<strong>十分な速度がでている</strong>ことが公式のGitHubにのってました。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://camo.githubusercontent.com/d8800e2ee37115207efc1f3e937a28fb49d90e22/68747470733a2f2f692e696d6775722e636f6d2f49333256644d4a2e706e67\" alt=\"img\"></p>\n<p>Ginより早いならEcho使っておけばええんや！と思いますが、</p>\n<p>GitHubレポジトリのスター数はEchoは<strong>16.1k</strong>, Ginは<strong>34.4k</strong>とGinの方が人気なのは間違いありませんので、プロジェクトによって見極める必要はありそうです。</p>\n<p>また、Goの場合は標準のnet/httpライブラリがそこそこ優秀なので簡単なAPI作成であれば<strong>WAF不要論</strong>もあります。</p>\n<h3 id=\"公式ドキュメントが優秀\" style=\"position:relative;\"><a href=\"#%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E5%84%AA%E7%A7%80\" aria-label=\"公式ドキュメントが優秀 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>公式ドキュメントが優秀</h3>\n<p>Echoの場合、Ginに比べて<strong>公式のドキュメントが充実</strong>しているような気がしました。気のせいかもしれません。</p>\n<p>Ginの方はドキュメントに<a href=\"https://disqus.com/\" target=\"_blank\" rel=\"noopener noreferrer\">DISQUS</a>のコメント欄があります。これはいいアイディアですね。</p>\n<p><a href=\"https://echo.labstack.com/guide\" target=\"_blank\" rel=\"noopener noreferrer\">Echoの公式ドキュメント</a></p>\n<p><a href=\"https://gin-gonic.com/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">Ginの公式ドキュメント</a></p>\n<p>さて、Echoがいいという話はこんなところにして早速jaegerの実装してみます。</p>\n<h2 id=\"jaegerとは\" style=\"position:relative;\"><a href=\"#jaeger%E3%81%A8%E3%81%AF\" aria-label=\"jaegerとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jaegerとは？</h2>\n<p><a href=\"https://www.jaegertracing.io/docs/1.16/\" target=\"_blank\" rel=\"noopener noreferrer\">jeager</a>は<a href=\"https://uber.github.io/#/\" target=\"_blank\" rel=\"noopener noreferrer\">Uber Technologies Inc.</a>が<strong>OSS</strong>として公開した<strong>分散トレーシングシステム</strong>です。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/69WEZfu.png\" alt=\"img\"></p>\n<p>マイクロサービスなアーキテクチャを横串で監視できる強みと<strong>Go, Java, Node, Python, C++</strong> でクライアントが提供されていることが魅力です。</p>\n<p>また、トレーシングの結果収集も<a href=\"https://opentracing.io/\" target=\"_blank\" rel=\"noopener noreferrer\">OpenTracing</a>としてドキュメントがありますので、別言語にも移植できそうです。</p>\n<p>(Nimに移植しますかね・・・。)</p>\n<p>ともかく、かっこいいですね。今回はマイクロサービスな作り方をしていないので、そこまでかっこよくはなりませんが、さっそく使っていきましょう!</p>\n<h2 id=\"jaeger-tracing\" style=\"position:relative;\"><a href=\"#jaeger-tracing\" aria-label=\"jaeger tracing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jaeger tracing</h2>\n<p><strong>Jaegerの実装と関係ないコードは省いてます。</strong></p>\n<p>まずは、<strong>main.go</strong> エントリーポイントから、</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token comment\">// main.go</span>\n\n<span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"github.com/labstack/echo/v4\"</span>\n\t<span class=\"token string\">\"github.com/tubone24/what-is-your-color/handler\"</span>\n\t<span class=\"token string\">\"github.com/labstack/echo-contrib/jaegertracing\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\te <span class=\"token operator\">:=</span> echo<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tc <span class=\"token operator\">:=</span> jaegertracing<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">defer</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\te<span class=\"token punctuation\">.</span><span class=\"token function\">GET</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/get/:username\"</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">.</span><span class=\"token function\">GetColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":9090\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>echo.New()したあとに、<a href=\"https://github.com/labstack/echo-contrib\" target=\"_blank\" rel=\"noopener noreferrer\">echo-contrib</a>で提供されている<strong>jaegerteacing</strong>を呼びます。</p>\n<p>これだけで、各APIの呼び出しをrouterごとに記録できるようになっています。\n簡単ですね！便利ですね！</p>\n<h2 id=\"child-spanを記録する\" style=\"position:relative;\"><a href=\"#child-span%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B\" aria-label=\"child spanを記録する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>child spanを記録する</h2>\n<p>さらにAPI内部の動き、例えばDBの書き込みスピードなどを計測する場合には<strong>child span</strong>という機能を使うことで実現できます。</p>\n<p><strong>/get/:username</strong>というAPIのハンドラーを見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> handler\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"github.com/labstack/echo-contrib/jaegertracing\"</span>\n\t<span class=\"token string\">\"github.com/labstack/echo/v4\"</span>\n\t<span class=\"token string\">\"net/http\"</span>\n\n\t<span class=\"token string\">\"github.com/tubone24/what-is-your-color/api\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">GetColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> echo<span class=\"token punctuation\">.</span>HandlerFunc <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>c echo<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n\t\tusername <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span>\n\t\tgithub <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>api<span class=\"token punctuation\">.</span>GitHub<span class=\"token punctuation\">{</span>Client<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>api<span class=\"token punctuation\">.</span>GithubClientImpl<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\t\tsp <span class=\"token operator\">:=</span> jaegertracing<span class=\"token punctuation\">.</span><span class=\"token function\">CreateChildSpan</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Call API\"</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">defer</span> sp<span class=\"token punctuation\">.</span><span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\tsp<span class=\"token punctuation\">.</span><span class=\"token function\">SetBaggageItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Func\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GetColor\"</span><span class=\"token punctuation\">)</span>\n\t\tsp<span class=\"token punctuation\">.</span><span class=\"token function\">SetTag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Func\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GetColor\"</span><span class=\"token punctuation\">)</span>\n\t\terr<span class=\"token punctuation\">,</span> langs <span class=\"token operator\">:=</span> github<span class=\"token punctuation\">.</span><span class=\"token function\">DoGetColor</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> echo<span class=\"token punctuation\">.</span><span class=\"token function\">NewHTTPError</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusInternalServerError<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Internal Error\"</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">JSON</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusOK<span class=\"token punctuation\">,</span> langs<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>このコード例では、GitHubのAPIからの結果を<strong>github.DoGetColor(username)</strong> で取得していますが、手前で<strong>CreateChildSpan</strong> でchildspanを指定してます。</p>\n<h2 id=\"jaegerで結果を見る\" style=\"position:relative;\"><a href=\"#jaeger%E3%81%A7%E7%B5%90%E6%9E%9C%E3%82%92%E8%A6%8B%E3%82%8B\" aria-label=\"jaegerで結果を見る permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jaegerで結果を見る</h2>\n<p>jaegerを起動します。起動には<a href=\"https://www.jaegertracing.io/docs/1.9/getting-started/#all-in-one\" target=\"_blank\" rel=\"noopener noreferrer\">公式ドキュメント</a>にのっている<strong>all-in-one docker</strong>を使います。(あらかじめDockerコンテナが動く環境を作っておきます。)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run -d --name jaeger <span class=\"token punctuation\">\\</span>\n  -e <span class=\"token assign-left variable\">COLLECTOR_ZIPKIN_HTTP_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">9411</span> <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">5775</span>:5775/udp <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">6831</span>:6831/udp <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">6832</span>:6832/udp <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">5778</span>:5778 <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">16686</span>:16686 <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">14268</span>:14268 <span class=\"token punctuation\">\\</span>\n  -p <span class=\"token number\">9411</span>:9411 <span class=\"token punctuation\">\\</span>\n  jaegertracing/all-in-one:1.9\n</code></pre></div>\n<p><del>不要な開放ポートがありますが、めんどくさいのでドキュメントそのままです。</del></p>\n<p>起動すると、jaegerUIが<a href=\"http://localhost:16686/\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:16686/</a>で立ち上がります。</p>\n<p>さきほど作ったEchoサーバーも立ち上げます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run main.go</code></pre></div>\n<p>APIをコールしてみるとTracingされているのがわかります。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/CRKvFq6.png\" alt=\"img\"></p>\n<p><strong>/get/:username</strong>というAPIのコールも出ています。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/1uQdmdX.png\" alt=\"img\"></p>\n<p>こまかく見ていきますと、:usernameはpath parameterなのですが、APIコール時に<strong>tubone24</strong>というユーザー名を設定しコールしたことがわかります。</p>\n<p><strong>1.04sかかってますね・・・。</strong></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/c0y81lE.png\" alt=\"img\"></p>\n<p>また、childspanも無事記録してます。</p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/1uQdmdX.png\" alt=\"img\"></p>\n<p><img class=\"lozad\" src=\"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7\" data-src=\"https://i.imgur.com/dh3WfC2.png\" alt=\"img\"></p>\n<p>どうやらバックエンド(GitHub)へのコールはそこまで<strong>0.48ms</strong>とそこまで遅くはないみたいです。</p>\n<p>別のところにボトルネックがあるんですかね・・。</p>\n<h2 id=\"結論\" style=\"position:relative;\"><a href=\"#%E7%B5%90%E8%AB%96\" aria-label=\"結論 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>結論</h2>\n<p>jaegerでトレーシングが簡単にできましたが、ボトルネック発見は難しいということがよくわかりました。</p>","words":1960,"minutes":5}},"staticQueryHashes":["1319877725","2959249232"]}