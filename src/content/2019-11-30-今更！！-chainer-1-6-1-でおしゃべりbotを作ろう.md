---
slug: 2017/06/04/chainer-chieri-bot
title: 今更！！ Chainer 1.6.1 でおしゃべりBotを作ろう
date: 2017-06-04T02:45:59.982Z
description: 緒方智恵理ちゃんボットなるものを2017年に作った過去記事の移植
tags:
  - Chainer
  - RNN
  - LSTM
  - BOT
  - アイマス
  - デレマス
headerImage: 'https://i.imgur.com/DJL1fwu.png'
templateKey: blog-post
---
(過去ブログからの移転した記事です)

# なるべくコードはかかない。

何の気なしに機械学習とかの仕事はないものかと、ネットの海をさまよっていたら、

[LSTMで自然な受け答えができるボットをつくった](https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/) という記事を見つけ、何となく読んで、やってみようかなと思ってやってみましたが、Chianer周りとか色々上手くいかなかった。というのがそもそもの始まりです。

Chainer周りで日本語の受け答えができますよ、的な記事は2015年頃のものが多く、Chainerがバージョンアップしたため、色々動かないことがありましたので、少しそちらに修正を加えてChainer 1.6.1でもまともに動くように修正していこうと思います。

自分でコードを一から書くのは嫌なので、あくまでもコードは書かない。

微修正にとどめるをモットーにがんばるぞい。

## 参考にさせていただいたコードやサイト

- [LSTMで自然な受け答えができるボットをつくった](https://sekailab.com/wp/2015/11/02/lstm-general-responce-bot/)
  - このコードを元にあらかじめ作成したChainerモデルでおしゃべりBotに命を吹き込みます。

- [yusuketomoto/chainer-char-rnn](https://github.com/yusuketomoto/chainer-char-rnn)　
  - Chainer・日本語界隈では知らない人はいないだろうChainerの言語モデル作成コード。こちらを用いてChainerモデルを作成していきます。

- [Chainerで学習した対話用のボットをSlackで使用+Twitterから学習データを取得してファインチューニング](https://qiita.com/GushiSnow/items/79ca7deeb976f50126d7)
  - 学習に必要なコーパスを取得するために一部のスクリプトを使用します。

## サーバを用意する。

学習にも、会話にも自宅サーバを用います。

ああ、電気代。

## 学習に必要なPython環境とコーパスを整える

Chainer界隈のコードはなぜかPython2 が多く、Python3 は少ないので、直接Python2をインストールしてもいいのですが…。

なんかOS環境を変に汚したくないので今回はPyenvとVirtualenvを使って実施していきます。

学習用のコーパスをダウンロードするスクリプトはどうやらPython 3.4.1で実装されているようなので Python 3.4.1 と Python2.7 の2種類の環境を作っていきたいと思います。

そして、3.4.1の環境にて学習用のコーパスをダウンロードします。

PyenvとVirtualenvはあらかじめインストール済みとしてすすめます。

PyenvとVirtualenvのインストール方法はこちらの記事が参考になると思います。[（pyenvとvirtualenvで環境構築）](https://qiita.com/Kodaira_/items/feadfef9add468e3a85b)

まず、Pythonの環境を作ります。

```bash
$ pyenv install 3.4.1
$ pyenv install 2.7
$ pyenv rehash
$ virtualenv -p ~/.pyenv/versions/3.4.1/bin/python3.4 my_env3.4.1
$ virtualenv -p ~/.pyenv/versions/2.7/bin/python2.7 my_env2.7
```

続いてコーパスをダウンロードします。

今回は[Chainerで学習した対話用のボットをSlackで使用+Twitterから学習データを取得してファインチューニング](https://qiita.com/GushiSnow/items/79ca7deeb976f50126d7)を参考にダウンロードします。

コーパスデータはたぶん二次配布とかNGだと思うので、何とか自分でダウンロードしてください。

[対話破綻検出チャレンジ](https://sites.google.com/site/dialoguebreakdowndetection/)

ダウンロードしたあとは展開したJSONデータ全部、devフォルダを作成してその中に入れて、listファイル(JSONファイルのパスを記載したやつ)をdata_load.pyと同じところに作っておきます。

こんな感じでlistファイルを作ります。

```
../dev/1404365812.log.json
../dev/1407143708.log.json
../dev/1407143981.log.json
../dev/1407149923.log.json
../dev/1407208809.log.json
../dev/1407209083.log.json
…… 
```
